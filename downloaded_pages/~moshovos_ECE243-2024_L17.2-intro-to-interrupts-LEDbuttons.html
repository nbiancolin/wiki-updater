<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml"
xmlns:st1="urn:schemas-microsoft-com:office:smarttags"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1253">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 15">
<meta name=Originator content="Microsoft Word 15">
<link rel=File-List
href="L17.2-intro-to-interrupts-LEDbuttons_files/filelist.xml">
<title>Lecture 2</title>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="place"/>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Andreas Moshovos</o:Author>
  <o:LastAuthor>Andreas Moshovos</o:LastAuthor>
  <o:Revision>7</o:Revision>
  <o:TotalTime>76</o:TotalTime>
  <o:Created>2024-02-05T04:29:00Z</o:Created>
  <o:LastSaved>2024-02-09T15:35:00Z</o:LastSaved>
  <o:Pages>13</o:Pages>
  <o:Words>4203</o:Words>
  <o:Characters>23963</o:Characters>
  <o:Lines>199</o:Lines>
  <o:Paragraphs>56</o:Paragraphs>
  <o:CharactersWithSpaces>28110</o:CharactersWithSpaces>
  <o:Version>16.00</o:Version>
 </o:DocumentProperties>
</xml><![endif]-->
<link rel=themeData
href="L17.2-intro-to-interrupts-LEDbuttons_files/themedata.thmx">
<link rel=colorSchemeMapping
href="L17.2-intro-to-interrupts-LEDbuttons_files/colorschememapping.xml">
<!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:View>Print</w:View>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:TrackMoves>false</w:TrackMoves>
  <w:TrackFormatting/>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:DoNotPromoteQF/>
  <w:LidThemeOther>EN-US</w:LidThemeOther>
  <w:LidThemeAsian>X-NONE</w:LidThemeAsian>
  <w:LidThemeComplexScript>X-NONE</w:LidThemeComplexScript>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
   <w:SplitPgBreakAndParaMark/>
   <w:DontVertAlignCellWithSp/>
   <w:DontBreakConstrainedForcedTables/>
   <w:DontVertAlignInTxbx/>
   <w:Word11KerningPairs/>
   <w:CachedColBalance/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
  <m:mathPr>
   <m:mathFont m:val="Cambria Math"/>
   <m:brkBin m:val="before"/>
   <m:brkBinSub m:val="&#45;-"/>
   <m:smallFrac m:val="off"/>
   <m:dispDef/>
   <m:lMargin m:val="0"/>
   <m:rMargin m:val="0"/>
   <m:defJc m:val="centerGroup"/>
   <m:wrapIndent m:val="1440"/>
   <m:intLim m:val="subSup"/>
   <m:naryLim m:val="undOvr"/>
  </m:mathPr></w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" DefUnhideWhenUsed="false"
  DefSemiHidden="false" DefQFormat="false" LatentStyleCount="376">
  <w:LsdException Locked="false" QFormat="true" Name="Normal"/>
  <w:LsdException Locked="false" QFormat="true" Name="heading 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 4"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 5"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 6"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 7"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 8"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 9"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="caption"/>
  <w:LsdException Locked="false" QFormat="true" Name="Title"/>
  <w:LsdException Locked="false" Priority="1" Name="Default Paragraph Font"/>
  <w:LsdException Locked="false" QFormat="true" Name="Subtitle"/>
  <w:LsdException Locked="false" QFormat="true" Name="Strong"/>
  <w:LsdException Locked="false" QFormat="true" Name="Emphasis"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Normal Table"/>
  <w:LsdException Locked="false" Priority="99" Name="No List"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Simple 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Simple 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Simple 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Classic 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Classic 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Classic 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Classic 4"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Colorful 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Colorful 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Colorful 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Columns 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Columns 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Columns 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Columns 4"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Columns 5"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Grid 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Grid 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Grid 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Grid 4"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Grid 5"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Grid 6"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Grid 7"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Grid 8"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table List 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table List 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table List 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table List 4"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table List 5"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table List 6"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table List 7"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table List 8"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table 3D effects 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table 3D effects 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table 3D effects 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Contemporary"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Elegant"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Professional"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Subtle 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Subtle 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Web 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Web 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Web 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Theme"/>
  <w:LsdException Locked="false" Priority="99" SemiHidden="true"
   Name="Placeholder Text"/>
  <w:LsdException Locked="false" Priority="1" QFormat="true" Name="No Spacing"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 1"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="99" SemiHidden="true" Name="Revision"/>
  <w:LsdException Locked="false" Priority="34" QFormat="true"
   Name="List Paragraph"/>
  <w:LsdException Locked="false" Priority="29" QFormat="true" Name="Quote"/>
  <w:LsdException Locked="false" Priority="30" QFormat="true"
   Name="Intense Quote"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 1"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 1"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 1"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 2"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 2"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 2"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 2"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 3"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 3"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 3"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 3"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 4"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 4"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 4"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 4"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 5"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 5"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 5"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 5"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 6"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 6"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 6"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 6"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="19" QFormat="true"
   Name="Subtle Emphasis"/>
  <w:LsdException Locked="false" Priority="21" QFormat="true"
   Name="Intense Emphasis"/>
  <w:LsdException Locked="false" Priority="31" QFormat="true"
   Name="Subtle Reference"/>
  <w:LsdException Locked="false" Priority="32" QFormat="true"
   Name="Intense Reference"/>
  <w:LsdException Locked="false" Priority="33" QFormat="true" Name="Book Title"/>
  <w:LsdException Locked="false" Priority="37" SemiHidden="true"
   UnhideWhenUsed="true" Name="Bibliography"/>
  <w:LsdException Locked="false" Priority="39" SemiHidden="true"
   UnhideWhenUsed="true" QFormat="true" Name="TOC Heading"/>
  <w:LsdException Locked="false" Priority="41" Name="Plain Table 1"/>
  <w:LsdException Locked="false" Priority="42" Name="Plain Table 2"/>
  <w:LsdException Locked="false" Priority="43" Name="Plain Table 3"/>
  <w:LsdException Locked="false" Priority="44" Name="Plain Table 4"/>
  <w:LsdException Locked="false" Priority="45" Name="Plain Table 5"/>
  <w:LsdException Locked="false" Priority="40" Name="Grid Table Light"/>
  <w:LsdException Locked="false" Priority="46" Name="Grid Table 1 Light"/>
  <w:LsdException Locked="false" Priority="47" Name="Grid Table 2"/>
  <w:LsdException Locked="false" Priority="48" Name="Grid Table 3"/>
  <w:LsdException Locked="false" Priority="49" Name="Grid Table 4"/>
  <w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark"/>
  <w:LsdException Locked="false" Priority="51" Name="Grid Table 6 Colorful"/>
  <w:LsdException Locked="false" Priority="52" Name="Grid Table 7 Colorful"/>
  <w:LsdException Locked="false" Priority="46"
   Name="Grid Table 1 Light Accent 1"/>
  <w:LsdException Locked="false" Priority="47" Name="Grid Table 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="48" Name="Grid Table 3 Accent 1"/>
  <w:LsdException Locked="false" Priority="49" Name="Grid Table 4 Accent 1"/>
  <w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark Accent 1"/>
  <w:LsdException Locked="false" Priority="51"
   Name="Grid Table 6 Colorful Accent 1"/>
  <w:LsdException Locked="false" Priority="52"
   Name="Grid Table 7 Colorful Accent 1"/>
  <w:LsdException Locked="false" Priority="46"
   Name="Grid Table 1 Light Accent 2"/>
  <w:LsdException Locked="false" Priority="47" Name="Grid Table 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="48" Name="Grid Table 3 Accent 2"/>
  <w:LsdException Locked="false" Priority="49" Name="Grid Table 4 Accent 2"/>
  <w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark Accent 2"/>
  <w:LsdException Locked="false" Priority="51"
   Name="Grid Table 6 Colorful Accent 2"/>
  <w:LsdException Locked="false" Priority="52"
   Name="Grid Table 7 Colorful Accent 2"/>
  <w:LsdException Locked="false" Priority="46"
   Name="Grid Table 1 Light Accent 3"/>
  <w:LsdException Locked="false" Priority="47" Name="Grid Table 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="48" Name="Grid Table 3 Accent 3"/>
  <w:LsdException Locked="false" Priority="49" Name="Grid Table 4 Accent 3"/>
  <w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark Accent 3"/>
  <w:LsdException Locked="false" Priority="51"
   Name="Grid Table 6 Colorful Accent 3"/>
  <w:LsdException Locked="false" Priority="52"
   Name="Grid Table 7 Colorful Accent 3"/>
  <w:LsdException Locked="false" Priority="46"
   Name="Grid Table 1 Light Accent 4"/>
  <w:LsdException Locked="false" Priority="47" Name="Grid Table 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="48" Name="Grid Table 3 Accent 4"/>
  <w:LsdException Locked="false" Priority="49" Name="Grid Table 4 Accent 4"/>
  <w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark Accent 4"/>
  <w:LsdException Locked="false" Priority="51"
   Name="Grid Table 6 Colorful Accent 4"/>
  <w:LsdException Locked="false" Priority="52"
   Name="Grid Table 7 Colorful Accent 4"/>
  <w:LsdException Locked="false" Priority="46"
   Name="Grid Table 1 Light Accent 5"/>
  <w:LsdException Locked="false" Priority="47" Name="Grid Table 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="48" Name="Grid Table 3 Accent 5"/>
  <w:LsdException Locked="false" Priority="49" Name="Grid Table 4 Accent 5"/>
  <w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark Accent 5"/>
  <w:LsdException Locked="false" Priority="51"
   Name="Grid Table 6 Colorful Accent 5"/>
  <w:LsdException Locked="false" Priority="52"
   Name="Grid Table 7 Colorful Accent 5"/>
  <w:LsdException Locked="false" Priority="46"
   Name="Grid Table 1 Light Accent 6"/>
  <w:LsdException Locked="false" Priority="47" Name="Grid Table 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="48" Name="Grid Table 3 Accent 6"/>
  <w:LsdException Locked="false" Priority="49" Name="Grid Table 4 Accent 6"/>
  <w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark Accent 6"/>
  <w:LsdException Locked="false" Priority="51"
   Name="Grid Table 6 Colorful Accent 6"/>
  <w:LsdException Locked="false" Priority="52"
   Name="Grid Table 7 Colorful Accent 6"/>
  <w:LsdException Locked="false" Priority="46" Name="List Table 1 Light"/>
  <w:LsdException Locked="false" Priority="47" Name="List Table 2"/>
  <w:LsdException Locked="false" Priority="48" Name="List Table 3"/>
  <w:LsdException Locked="false" Priority="49" Name="List Table 4"/>
  <w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark"/>
  <w:LsdException Locked="false" Priority="51" Name="List Table 6 Colorful"/>
  <w:LsdException Locked="false" Priority="52" Name="List Table 7 Colorful"/>
  <w:LsdException Locked="false" Priority="46"
   Name="List Table 1 Light Accent 1"/>
  <w:LsdException Locked="false" Priority="47" Name="List Table 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="48" Name="List Table 3 Accent 1"/>
  <w:LsdException Locked="false" Priority="49" Name="List Table 4 Accent 1"/>
  <w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark Accent 1"/>
  <w:LsdException Locked="false" Priority="51"
   Name="List Table 6 Colorful Accent 1"/>
  <w:LsdException Locked="false" Priority="52"
   Name="List Table 7 Colorful Accent 1"/>
  <w:LsdException Locked="false" Priority="46"
   Name="List Table 1 Light Accent 2"/>
  <w:LsdException Locked="false" Priority="47" Name="List Table 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="48" Name="List Table 3 Accent 2"/>
  <w:LsdException Locked="false" Priority="49" Name="List Table 4 Accent 2"/>
  <w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark Accent 2"/>
  <w:LsdException Locked="false" Priority="51"
   Name="List Table 6 Colorful Accent 2"/>
  <w:LsdException Locked="false" Priority="52"
   Name="List Table 7 Colorful Accent 2"/>
  <w:LsdException Locked="false" Priority="46"
   Name="List Table 1 Light Accent 3"/>
  <w:LsdException Locked="false" Priority="47" Name="List Table 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="48" Name="List Table 3 Accent 3"/>
  <w:LsdException Locked="false" Priority="49" Name="List Table 4 Accent 3"/>
  <w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark Accent 3"/>
  <w:LsdException Locked="false" Priority="51"
   Name="List Table 6 Colorful Accent 3"/>
  <w:LsdException Locked="false" Priority="52"
   Name="List Table 7 Colorful Accent 3"/>
  <w:LsdException Locked="false" Priority="46"
   Name="List Table 1 Light Accent 4"/>
  <w:LsdException Locked="false" Priority="47" Name="List Table 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="48" Name="List Table 3 Accent 4"/>
  <w:LsdException Locked="false" Priority="49" Name="List Table 4 Accent 4"/>
  <w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark Accent 4"/>
  <w:LsdException Locked="false" Priority="51"
   Name="List Table 6 Colorful Accent 4"/>
  <w:LsdException Locked="false" Priority="52"
   Name="List Table 7 Colorful Accent 4"/>
  <w:LsdException Locked="false" Priority="46"
   Name="List Table 1 Light Accent 5"/>
  <w:LsdException Locked="false" Priority="47" Name="List Table 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="48" Name="List Table 3 Accent 5"/>
  <w:LsdException Locked="false" Priority="49" Name="List Table 4 Accent 5"/>
  <w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark Accent 5"/>
  <w:LsdException Locked="false" Priority="51"
   Name="List Table 6 Colorful Accent 5"/>
  <w:LsdException Locked="false" Priority="52"
   Name="List Table 7 Colorful Accent 5"/>
  <w:LsdException Locked="false" Priority="46"
   Name="List Table 1 Light Accent 6"/>
  <w:LsdException Locked="false" Priority="47" Name="List Table 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="48" Name="List Table 3 Accent 6"/>
  <w:LsdException Locked="false" Priority="49" Name="List Table 4 Accent 6"/>
  <w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark Accent 6"/>
  <w:LsdException Locked="false" Priority="51"
   Name="List Table 6 Colorful Accent 6"/>
  <w:LsdException Locked="false" Priority="52"
   Name="List Table 7 Colorful Accent 6"/>
  <w:LsdException Locked="false" Priority="99" SemiHidden="true"
   UnhideWhenUsed="true" Name="Mention"/>
  <w:LsdException Locked="false" Priority="99" SemiHidden="true"
   UnhideWhenUsed="true" Name="Smart Hyperlink"/>
  <w:LsdException Locked="false" Priority="99" SemiHidden="true"
   UnhideWhenUsed="true" Name="Hashtag"/>
  <w:LsdException Locked="false" Priority="99" SemiHidden="true"
   UnhideWhenUsed="true" Name="Unresolved Mention"/>
  <w:LsdException Locked="false" Priority="99" SemiHidden="true"
   UnhideWhenUsed="true" Name="Smart Link"/>
 </w:LatentStyles>
</xml><![endif]--><!--[if !mso]><object
 classid="clsid:38481807-CA0E-42D2-BF39-B33AF135CC4D" id=ieooui></object>
<style>
st1\:*{behavior:url(#ieooui) }
</style>
<![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Batang;
	panose-1:2 3 6 0 0 1 1 1 1 1;
	mso-font-alt:Batang;
	mso-font-charset:129;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:-1342176593 1775729915 48 0 524447 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:-536869121 1107305727 33554432 0 415 0;}
@font-face
	{font-family:Consolas;
	panose-1:2 11 6 9 2 2 4 3 2 4;
	mso-font-charset:0;
	mso-generic-font-family:modern;
	mso-font-pitch:fixed;
	mso-font-signature:-536869121 64767 1 0 415 0;}
@font-face
	{font-family:"\@Batang";
	panose-1:2 3 6 0 0 1 1 1 1 1;
	mso-font-charset:129;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:-1342176593 1775729915 48 0 524447 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-parent:"";
	margin:0in;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman",serif;
	mso-fareast-font-family:Batang;}
p.MsoPlainText, li.MsoPlainText, div.MsoPlainText
	{mso-style-unhide:no;
	mso-style-link:"Plain Text Char";
	margin:0in;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:Batang;}
p.msonormal0, li.msonormal0, div.msonormal0
	{mso-style-name:msonormal;
	mso-style-unhide:no;
	mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman",serif;
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;}
span.PlainTextChar
	{mso-style-name:"Plain Text Char";
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"Plain Text";
	mso-ansi-font-size:10.5pt;
	mso-bidi-font-size:10.5pt;
	font-family:Consolas;
	mso-ascii-font-family:Consolas;
	mso-fareast-font-family:Batang;
	mso-hansi-font-family:Consolas;
	mso-bidi-font-family:Consolas;}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
.MsoChpDefault
	{mso-style-type:export-only;
	mso-default-props:yes;
	font-size:10.0pt;
	mso-ansi-font-size:10.0pt;
	mso-bidi-font-size:10.0pt;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 65.95pt 1.0in 65.95pt;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 @list l0
	{mso-list-id:9071247;
	mso-list-type:hybrid;
	mso-list-template-ids:1929250320 -471969160 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l0:level1
	{mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1
	{mso-list-id:50812066;
	mso-list-type:hybrid;
	mso-list-template-ids:403194906 -471969160 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l1:level1
	{mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2
	{mso-list-id:92668893;
	mso-list-type:hybrid;
	mso-list-template-ids:-854019194 -2100923078 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l2:level1
	{mso-level-tab-stop:.75in;
	mso-level-number-position:left;
	margin-left:.75in;
	text-indent:-.25in;}
@list l2:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3
	{mso-list-id:333192905;
	mso-list-type:hybrid;
	mso-list-template-ids:1871354388 67698703 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l3:level1
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level2
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level3
	{mso-level-number-format:roman-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:right;
	text-indent:-9.0pt;}
@list l3:level4
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level5
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level6
	{mso-level-number-format:roman-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:right;
	text-indent:-9.0pt;}
@list l3:level7
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level8
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level9
	{mso-level-number-format:roman-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:right;
	text-indent:-9.0pt;}
@list l4
	{mso-list-id:457770837;
	mso-list-type:hybrid;
	mso-list-template-ids:879819590 1016510748 952824422 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l4:level1
	{mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l5
	{mso-list-id:1036927624;
	mso-list-type:hybrid;
	mso-list-template-ids:-1673097046 67698703 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l5:level1
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l5:level2
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l5:level3
	{mso-level-number-format:roman-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:right;
	text-indent:-9.0pt;}
@list l5:level4
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l5:level5
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l5:level6
	{mso-level-number-format:roman-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:right;
	text-indent:-9.0pt;}
@list l5:level7
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l5:level8
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l5:level9
	{mso-level-number-format:roman-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:right;
	text-indent:-9.0pt;}
@list l6
	{mso-list-id:1082990651;
	mso-list-type:hybrid;
	mso-list-template-ids:-776307898 -5740834 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l6:level1
	{mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	mso-ansi-font-weight:bold;}
@list l6:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l6:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l6:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l6:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l6:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l6:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l6:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l6:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l7
	{mso-list-id:1460611562;
	mso-list-type:hybrid;
	mso-list-template-ids:1221885972 -471969160 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l7:level1
	{mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l7:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l7:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l7:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l7:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l7:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l7:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l7:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l7:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman",serif;}
table.MsoTableGrid
	{mso-style-name:"Table Grid";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-unhide:no;
	border:solid windowtext 1.0pt;
	mso-border-alt:solid windowtext .5pt;
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-border-insideh:.5pt solid windowtext;
	mso-border-insidev:.5pt solid windowtext;
	mso-para-margin:0in;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman",serif;}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="1026"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body lang=EN-US style='tab-interval:.5in;word-wrap:break-word'>

<div class=WordSection1>

<p class=MsoPlainText>Lecture 17.1</p>

<p class=MsoPlainText>Revised Feb 2024</p>

<p class=MsoPlainText>Andreas Moshovos</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'>Introduction to
Interrupts/Exceptions: Using Interrupts with the Buttons<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoPlainText>In the previous lecture we saw a way to interface (programmatically)
with the serial device. For this <span class=GramE>purpose</span> we used
“polling”, that is busy-waiting; any time we wanted to communicate with the
serial device we had to first probe the status register to see if it is
available (if we wanted to send a character) or whether a character has been
received. We had to keep probing the status register until the desired
condition was met. This is completely counter-productive as we consumed all our
processing power just waiting. Moreover, while we have not seen a concrete
example of this, it turns out that if we have to communicate with multiple
devices, writing code that uses polling for all devices simultaneously is at
the very least complicated and in some <span class=GramE>cases</span> it will
be virtually impossible. We use this discussion as a motivation for another way
for communicating with devices called <b style='mso-bidi-font-weight:normal'>interrupts.
</b>Interrupts are a very powerful mechanism that can be used to support
multitasking, handling of exceptional conditions (i.e., unexpected results
during calculation such as a division with zero or overflow), emulation of
unimplemented (in hardware) instructions, single-step execution for debugging,
and operating system calls/protection among others. So, while for the time we
will focus on a very specific application of interrupts please keep in mind
that this is just a stepping stone towards explaining the diverse applications
of interrupts.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>(A note on terminology: the terms <b style='mso-bidi-font-weight:
normal'>interrupt</b> and <b style='mso-bidi-font-weight:normal'>exception</b>
are commonly used to refer to the same concept, often interrupts <span
class=GramE>is</span> used for external device induced requests whereas
exception is used for interrupts that are caused by instruction execution.
There is no common usage of these terms. Here, we will use the two terms
interchangeably to refer to the same concept and we will not make an attempt to
differentiate between external of program induced interrupts.)</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>As we have seen, polling is almost the equivalent of a
real-life scenario where you hand-off to work to someone and then you keep
bugging them all the time asking whether they are done. Interrupts on the other
hand are quite different. When we hand-off some work to someone <span
class=GramE>else</span> we also ask them to let us know when they are done.
This way we do not need to keep asking them all the time whether they are done.
When the work is <span class=GramE>finished</span> they will come back and
notify us, and since we are talking about computers, we can rely on them: they
will come back and tell us.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Here’s a high-level view of the interrupt mechanism:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l1 level1 lfo2;
tab-stops:list .5in'><![if !supportLists]><span style='mso-fareast-font-family:
"Courier New"'><span style='mso-list:Ignore'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>Say the processor is executing instructions. </p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l1 level1 lfo2;
tab-stops:list .5in'><![if !supportLists]><span style='mso-fareast-font-family:
"Courier New"'><span style='mso-list:Ignore'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>At some point in time, a device requests an
interrupt.</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l1 level1 lfo2;
tab-stops:list .5in'><![if !supportLists]><span style='mso-fareast-font-family:
"Courier New"'><span style='mso-list:Ignore'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>Later <span class=GramE>on</span> the processor
decides to grant that request. This amounts to completing the execution of the
current instruction and then <i style='mso-bidi-font-style:normal'>inducing </i>a
call to a specialized routine that is called an interrupt handler. The call to
the interrupt handler is also a special call in that it must save sufficient
information so when eventually the interrupt handler finishes, the processor
can resume executing instructions immediately after the instruction that
finished prior to inducing the call to the interrupt handler. </p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>There are several requirements that must be met for
interrupts to work.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l0 level1 lfo4;
tab-stops:list .5in'><![if !supportLists]><span style='mso-fareast-font-family:
"Courier New"'><span style='mso-list:Ignore'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>We need a mechanism for devices to request
interrupts.</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l0 level1 lfo4;
tab-stops:list .5in'><![if !supportLists]><span style='mso-fareast-font-family:
"Courier New"'><span style='mso-list:Ignore'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>We need a mechanism for inducing calls to the
interrupt handler. </p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l0 level1 lfo4;
tab-stops:list .5in'><![if !supportLists]><span style='mso-fareast-font-family:
"Courier New"'><span style='mso-list:Ignore'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>We need a mechanism to let the device know that
its interrupt request was handled.</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l0 level1 lfo4;
tab-stops:list .5in'><![if !supportLists]><span style='mso-fareast-font-family:
"Courier New"'><span style='mso-list:Ignore'>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>We need a way of determining where is the
interrupt handler (that is where in memory its instructions reside).</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l0 level1 lfo4;
tab-stops:list .5in'><![if !supportLists]><span style='mso-fareast-font-family:
"Courier New"'><span style='mso-list:Ignore'>5.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>We need a mechanism for saving and restoring all
appropriate machine state (registers plus memory) that may be affected across
an interrupt handler call.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>The solutions to all these requirements entail hardware
units, software and several conventions that must be followed for everything to
work as expected. In what follows we explain the NIOS II interrupt model. NIOS
II’s interrupt model is simple and representative of that of many other
load/store architectures that were designed after the mid-80’s (e.g., SPARC,
MIPS, PowerPC). Other processor families have more elaborate models. Given time
we may touch upon some of the more elaborate mechanisms.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Let’s us first look at the requirements. </p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'>REQUIREMENTS #1
and #3: ASKING FOR AN INTERRUPT AND GRANTING THE REQUEST<o:p></o:p></b></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>The device asks for an interrupt, the processor grants
that request at a convenient time and informs the device. One straightforward
mechanism uses two wires at the physical level. One wire is directed from the
device to the CPU (we can call it the Interrupt-Request - IRQ) whereas the second
is directed from the CPU to the device (we can call it Interrupt-Granted or
Interrupt-Acknowledge IACK). When the device wants to request an interrupt it
asserts the interrupt-request signal. When the CPU grants the interrupt, it
responds by asserting the Interrupt-Granted signal. This process of “asking”
and “granting” is often called a <b style='mso-bidi-font-weight:normal'><u>hand-shake</u></b>.
</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'>REQUIREMENTS #2
and #4: INDUCING A CALL TO THE INTERRUPT HANDLER – WHERE IS THE INTERRUPT
HANDLER?<o:p></o:p></b></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>With these in place, we next consider covering requirement
3, that is how to induce a call to an interrupt handler. How do we know where
in memory is the interrupt handler)? One straightforward solution to this would
be to use a hardwired (i.e., decided at designed time and built into the CPU
design) address. For example, we could have the interrupt handler to be at
address 0x90000 for all interrupt requests. In fact, some CPUs, including NIOS
II, do exactly that. So, all external devices share a common interrupt handler.
The interrupt handler then probes all appropriate devices to figure out which
device actually requested the interrupt. This probing is done in software.
Inducing a call to the interrupt handler is straightforward: change the PC to
the interrupt handler’s start address (0x90000 in our example) after we have
saved somewhere (e.g., on the stack) the current value of the PC so that we can
return back to it once the interrupt handler has finished.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'>REQUIREMENT #5:
SAVING/RESTORING STATE<o:p></o:p></b></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>As an interrupt appears to be just like a <span
class=GramE>call</span> we can always use the stack to save and restore state
as needed. This can be done automatically by the hardware or we can simply rely
on software. There may be odd bits of state that have to be stored depending on
the implementation. These may require special hardware support. We’ll return to
this discussion with the specific case of NIOS II.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'>HOW NIOS II MEETS
THE 5 REQUIREMENTS<o:p></o:p></b></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>With this high-level understanding of a straightforward
solution for the aforementioned requirements we can now start discussing the
way NIOS II handles these requirements. </p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l6 level1 lfo6;
tab-stops:list .5in'><![if !supportLists]><b style='mso-bidi-font-weight:normal'><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span></b><![endif]><b
style='mso-bidi-font-weight:normal'>How Devices Request Interrupts: </b>Instead
of just one interrupt request wire, NIOS II provides 32, IRQ0 through IRQ31.
These request lines are not prioritized in hardware and thus they all have
equal priority.</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l6 level1 lfo6;
tab-stops:list .5in'><![if !supportLists]><b style='mso-bidi-font-weight:normal'><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span></b><![endif]><b
style='mso-bidi-font-weight:normal'>How the CPU informs a device that its
interrupt request has been granted:</b> NIOS II does not rely on hardware for
this. Instead, it is left up to software to notify the device. That is, there
is some register in the device that has to be accessed to notify the device
that the interrupt has been granted. The exact process is device specific.</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l6 level1 lfo6;
tab-stops:list .5in'><![if !supportLists]><b style='mso-bidi-font-weight:normal'><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span></b><![endif]><b
style='mso-bidi-font-weight:normal'>How the CPU determines where is the
interrupt handler:</b> NIOS II uses a pre-configured address for this. All
interrupt requests result into executing code starting at location <b
style='mso-bidi-font-weight:normal'><span style='color:red'>0x0000020</span></b>.
In assembly you can use the directive <span class=GramE>‘.section</span>
exceptions, “ax”‘ to assign code to that part of memory. The interrupt handler
must then interrogate all devices to figure out which one was the one that
caused the interrupt. If there is more than one device requesting an interrupt,
it is up to the interrupt handler to determine in what order these requests
will be handled.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Before we can review how NIOS II handles interrupts we
need to take a closer look at some of the control registers.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'>CONTROL REGISTERS<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><u>Ctl0:</u></b>
Control register 0 is the master interrupt enable switch. <span class=SpellE>Bit</span>
0 of this register controls whether NIOS II will respond to interrupt requests.
If bit 0 is 1 then interrupts will be serviced. Otherwise, NIOS II silently
ignores all requests. </p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><u>Ctl1:</u></b> Control
register 1 is used by NIOS II to preserve the current state of ctl0 upon
accepting an interrupt. More on this soon.</p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><u><o:p><span
 style='text-decoration:none'>&nbsp;</span></o:p></u></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><u>Ctl3:</u></b>
Control register 3 is the equivalent of a switch board for each IRQ line. Each
bit controls whether NIOS II will respond interrupt requests from the specific
IRQ line. This register allows us to selectively enable interrupt handling per
device. Interrupts are accepted for <span class=SpellE>IRQi</span> if bit I of
ctl3 is 1 <u>and</u> bit 0 of ctl0 is 1.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>The only way to access control registers is through two specialized
instructions:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='margin-left:1.0in;text-indent:-.25in;mso-list:
l1 level2 lfo2;tab-stops:list 1.0in'><st1:city w:st="on"><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><st1:place
w:st="on">Reading</st1:place></st1:city> from a control register: <span
class=SpellE>rdctl</span> <span class=SpellE>control_register</span>, <span
class=SpellE>general_purpose_register</span>. Example: “<span class=SpellE>rdctl</span>
ctl0, r8” reads the value of ctl0 and stores it in r8.</p>

<p class=MsoPlainText style='margin-left:1.0in;text-indent:-.25in;mso-list:
l1 level2 lfo2;tab-stops:list 1.0in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Writing
to a control register: <span class=SpellE>wrctl</span> <span class=SpellE>control_register</span>,
<span class=SpellE>general_purpose</span> register. Example: “<span
class=SpellE>wrctl</span> ctl0, r8” writes the value of r8 into control
register ctl0.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>In addition to the registers, register r29 also
participates in the interrupt sequence. It’s used to store the PC of the
instruction following the one that was interrupted. R29 has an alias which is <span
class=SpellE>ea</span> for exception address.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoPlainText>Now we can review <b style='mso-bidi-font-weight:normal'>the
complete interrupt request/acknowledge/interrupt handler calling/return
sequence:<o:p></o:p></b></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l7 level1 lfo8;
tab-stops:list .5in'><![if !supportLists]><span style='mso-fareast-font-family:
"Courier New"'><span style='mso-list:Ignore'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>The device requests an interrupt by asserting
one of the <span class=SpellE>IRQi</span> lines. Say, this is line IRQ1.</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l7 level1 lfo8;
tab-stops:list .5in'><![if !supportLists]><span style='mso-fareast-font-family:
"Courier New"'><span style='mso-list:Ignore'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>The processor completes execution of the current
instruction.</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l7 level1 lfo8;
tab-stops:list .5in'><![if !supportLists]><span style='mso-fareast-font-family:
"Courier New"'><span style='mso-list:Ignore'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>The processor disables interrupts, but before
doing so, it saves the current interrupt enable bit. Specifically, the
processor saves the current value of control register 0 (ctl0) in control
register 1 (ctl1) and then updates ctl0 disabling further responses to
interrupts. In more detail:</p>

<p class=MsoPlainText style='margin-left:1.0in;text-indent:-.25in;mso-list:
l7 level2 lfo8;tab-stops:list 1.0in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>ctl1
= ctl0</p>

<p class=MsoPlainText style='margin-left:1.0in;text-indent:-.25in;mso-list:
l7 level2 lfo8;tab-stops:list 1.0in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
class=SpellE>bit</span> 0 of ctl0 = 0</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l7 level1 lfo8;
tab-stops:list .5in'><![if !supportLists]><span style='mso-fareast-font-family:
"Courier New"'><span style='mso-list:Ignore'>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>r29 = PC + 4. This is the PC immediately
following the instruction that would have executed.</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l7 level1 lfo8;
tab-stops:list .5in'><![if !supportLists]><span style='mso-fareast-font-family:
"Courier New"'><span style='mso-list:Ignore'>5.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>PC = <b style='mso-bidi-font-weight:normal'>0x20</b>,
so that execution now continues in the interrupt handler.</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l7 level1 lfo8;
tab-stops:list .5in'><![if !supportLists]><span style='mso-fareast-font-family:
"Courier New"'><span style='mso-list:Ignore'>6.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>The handler terminates by executing the special
instruction <span class=SpellE><b style='mso-bidi-font-weight:normal'><u>eret</u></b></span>.
This instruction restores ctl0 from ctl1 and PC from register r29 (<span
class=SpellE>ea</span>). The net effect is that execution resumes by executing
the instruction that was interrupted.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'>USING INTERRUPTS
WITH THE BUTTONS:<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoPlainText>Let’s us now discuss how we can use interrupts with the
buttons. For our example, the “regular” program will be an infinite loop that
toggles LED 0. The loop calls two “helper” functions. <span class=SpellE>Ledtoggle</span>()
toggles bit 0 of the LED DR register (which is at address 0xff200000). The <span
class=SpellE>timerdelay</span>() uses polling to wait for 100M clock ticks. We
have discussed the functionality of the LED PIT and the timer in previous
notes. The functions follow the NIOS II calling conventions. </p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Here’s the code for this main program:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>.text</p>

<p class=MsoPlainText>.global _start</p>

<p class=MsoPlainText>_start:</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movia</span> <span class=SpellE>sp</span>, 0x200000</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span></p>

<p class=MsoPlainText><b>fever:<o:p></o:p></b></p>

<p class=MsoPlainText><b><span style='mso-tab-count:1'>      </span>call <span
class=SpellE>ledtoggle</span><o:p></o:p></b></p>

<p class=MsoPlainText><b><span style='mso-tab-count:1'>      </span>call <span
class=SpellE>timerdelay</span><o:p></o:p></b></p>

<p class=MsoPlainText><b><span style='mso-tab-count:1'>      </span><span
class=SpellE>br</span> fever<o:p></o:p></b></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span class=SpellE><b>ledtoggle</b></span><b>: <o:p></o:p></b></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movia</span> r5, 0xff200000</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>ldwio</span> r2, 0(r5)</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>xori</span> r2, r2, 1</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>stwio</span> r2, 0(r5)</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span>ret</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span class=SpellE><b>timerdelay</b></span><b>:<o:p></o:p></b></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movia</span> r4, 0xff202000</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movia</span> r5, 100000000</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movi</span> r2, 0x8</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>stwio</span> r0, 0(r4) # clear TO</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>stwio</span> r2, 4(r4) # stop timer</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>stwio</span> r5, 8(r4) # <span class=SpellE>periodlo</span></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>srli</span> r5, r5, 16</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>stwio</span> r5, 12(r4) # <span class=SpellE>periodhi</span></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movi</span> r2, 0x4</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>stwio</span> r2, 4(r4)</p>

<p class=MsoPlainText><span class=SpellE>bwait</span>:</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>ldwio</span> r2, 0(r4)</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>andi</span> r2, r2, 0x1 # check TO</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>beq</span> r2, r0, <span class=SpellE>bwait</span></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span>ret</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>To illustrate interrupts we will enable interrupts for
button 0 and have the interrupt handler (aka interrupt service routine) toggle
LED 4. The expected behavior is as follows:</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l5 level1 lfo10'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>LED
0 will turn on and off with a delay of roughly 100M ticks. This is done by the
main program.</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l5 level1 lfo10'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>LED
3 will toggle any time we pressed button 0. This is done by the interrupt
handler.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>We can now write the interrupt handler (at the end we
will write the initialization code which will cause this interrupt handler to
be called when button 0 is pressed and released.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=GramE>.section</span> .exceptions, “ax”</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=GramE>.align</span> 2</p>

<p class=MsoPlainText><span class=SpellE>ihandler</span>:</p>

<p class=MsoPlainText><b><span style='mso-spacerun:yes'>      </span>#LED
TOGGLE<o:p></o:p></b></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movia</span> r10, 0xff200000<span style='mso-spacerun:yes'> 
</span>#base of LED PIT</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>ldwio</span> r11, 0(r10)<span style='mso-spacerun:yes'>     
</span># r11<span style='mso-spacerun:yes'>  </span>= DR of LED PIT</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>xori</span> r11, r11, 0x8<span style='mso-spacerun:yes'>    
</span># invert bit 3 (4th)</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>stwio</span> r11, 0(r10)<span style='mso-spacerun:yes'>     
</span># write DR of LED PIT </p>

<p class=MsoPlainText><span
style='mso-spacerun:yes'>                             </span># LED 3 changes
stage (on to off or vice versa)</p>

<p class=MsoPlainText><b><span style='mso-tab-count:1'>      </span># RESET INT
CAUSE<o:p></o:p></b></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movia</span> r10, 0xff200050<span style='mso-spacerun:yes'> 
</span># button PIT base</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movi</span> r11, 1<span style='mso-spacerun:yes'>           
</span># reset EDGE bit 0</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>stwio</span> r11, 12(r10)<span style='mso-spacerun:yes'>    
</span># reset edge for button 0</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b><span style='mso-tab-count:1'>      </span># RETURN
FROM INT<span style='mso-tab-count:1'> </span><o:p></o:p></b></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>subi</span><span style='mso-tab-count:1'>  </span><span
class=SpellE>ea</span>, <span class=SpellE>ea</span>, 4<span style='mso-tab-count:
2'>         </span><span style='mso-tab-count:1'>      </span># make sure we
execute the instruction that was interrupted. <span class=SpellE>Ea</span>/r29
points to the instruction after it</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>eret</span><span style='mso-tab-count:4'>                    </span><span
style='mso-tab-count:1'>      </span># return from interrupt</p>

<p class=MsoPlainText><span style='mso-tab-count:5'>                              </span><span
style='mso-tab-count:1'>      </span># this restores ctl0 to <span
class=SpellE>it’s</span> previous state that was saved in ctl1</p>

<p class=MsoPlainText><span style='mso-tab-count:5'>                              </span><span
style='mso-tab-count:1'>      </span># and does pc = <span class=SpellE>ea</span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>To make sure that the handler gets placed at address <b>0x0000020</b>
use “.section .exceptions, “ax””.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>The first part of the handler (LED TOGGLE) toggles bit 3
of the DR of the LED PIT effectively making the 4<sup>th</sup> LED blink.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>The second part of the handler (RESET INT CAUSE) resets
bit 0 of the EDGE register of the Button PIT. This is necessary so that the
interrupt handler confirms that the interrupt request was granted and handled.
The button PIT will as a result <span class=SpellE>deassert</span> IRQ1. If we
do not clear the EDGE bit that caused the interrupt, the moment the interrupt
handler returns using <span class=SpellE>eret</span>, the CPU will find the
IRQ1 is still on and will, as part of normal operation, grant the request and
the interrupt handler will run again, and again, and again…</p>

<p class=MsoPlainText>The third part (RETURN FROM INT) decrements <span
class=SpellE>ea</span> by 4 and uses <span class=SpellE>eret</span> to return
to the interrupted program which will resume <span class=SpellE>execuction</span>
at the instruction that was interrupted and never go to execute. Later on we
will explain that having the EA point to PC+4 instead of the actual PC of the
instruction probably simplifies the hardware implementation. This
simplification is exposed to the programmer who has to explicitly decrement the
PC to point to the right instruction.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'>Initialization
Code: Setting up NIOS II to accept interrupts and the Button 0 to request them<o:p></o:p></b></p>

<p class=MsoPlainText><span style='mso-tab-count:2'>            </span></p>

<p class=MsoPlainText>Now we can write the initialization code. There are
several things that we need to do and writing this code requires that we discuss
the MASK register of the Buttons PIT.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>The MASK register has 32b out of which only the 4 <span
class=SpellE>LSb</span> are in use. Setting bit 0 of the MASK register to 1
enables button 0 to request an interrupt from NIOS II anytime the EDGE register
bit 0 is set to 1. As a result, any time button 0 is pressed and released, an
interrupt request will be sent to NIOS II. The buttons </p>

<p class=MsoPlainText>are connected to <b>IRQ1. </b>This is not programmable on
our system. It was etched on stone at design time.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>When NIOS II accepts an interrupt it can read the EDGE
register to determine whether it was the button 0 that caused the interrupt. In
our case, button 0 will be the only possible cause of an interrupt.
Accordingly, our interrupt handler will not have to check why it started
executing. </p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>So, now we can write the initialization code. Here’s the
complete code. The initialization code is shown in red.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>button0EnableInt:</p>

<p class=MsoPlainText><b><span style='mso-spacerun:yes'>      </span># DEVICE
SIDE<o:p></o:p></b></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movia</span> r2, 0xff200050 #buttons</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movi</span> r4, 0xF<span style='mso-spacerun:yes'>   </span>#
first make sure the EDGE register is all clear</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>stwio</span> r4, 12(r2) # reset EDGE bits</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movi</span> r4, 0x1<span style='mso-spacerun:yes'>   </span># set
MASK bit 0 to 1, enable int requests for button 0</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>stwio</span> r4, 8(r2)</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b><span style='mso-tab-count:1'>      </span># CPU SIDE<o:p></o:p></b></p>

<p class=MsoPlainText><span style='mso-spacerun:yes'>      </span><b>#CTL3<o:p></o:p></b></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movi</span> r5, 0x2<span style='mso-spacerun:yes'>   </span>#
button are connected to IRQ1 (2<sup>nd</sup> bit of ctl3)</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>wrctl</span> ctl3, r5 # enable <span class=SpellE>ints</span> for
IRQ1/buttons</p>

<p class=MsoPlainText><span style='mso-spacerun:yes'>      </span><b>#CTL0<o:p></o:p></b></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movi</span> r4, 0x1</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>wrctl</span> ctl0, r4 # enable <span class=SpellE>ints</span>
globally (bit 0)</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span>ret</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>The “DEVICE SIDE” code enables interrupts requests on the
Buttons PIT. First it clears the EDGE register (this is a precaution to start
from a known state).</p>

<p class=MsoPlainText>Then it sets bit 0 of the EDGE register to 1. From this
moment on, pressing and releasing button 0 will not only set the EDGE register
bit 0 to 1, but will also raise the IRQ1 effectively requesting an interrupt
from the CPU.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>The “CPU SIDE” code programs the CPU to accept interrupts
(ctl0) and specifically from the buttons (ctl3). The control register ctl0 is
the global interrupt enable. Its bit 0 controls whether the CPU will accept <i>any
</i>IRQ request (when it is 1) or none (when it is 0). The control register
ctl3 controls which IRQs are allowed to request interrupts. Bit 1 (the 2<sup>nd</sup>
bit) corresponds to IRQ1. Setting it to 1 allows IRQ1 to go through.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Our main program can now be modified to include a call to
button0EnableInt() prior to the infinite loop:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>.text</p>

<p class=MsoPlainText>.global _start</p>

<p class=MsoPlainText>_start:</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movia</span> <span class=SpellE>sp</span>, 0x200000</p>

<p class=MsoPlainText><b><span style='mso-tab-count:1'>      </span>call
button0EnableInt<o:p></o:p></b></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span></p>

<p class=MsoPlainText>loop:</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span>call <span
class=SpellE>ledtoggle</span></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span>call <span
class=SpellE>waitasec</span></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>br</span> loop</p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'>Completing the
interrupt handler<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoPlainText>As it stands there are two issues with the interrupt
handler:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l4 level1 lfo12;
tab-stops:list .5in'><![if !supportLists]><span style='mso-fareast-font-family:
"Courier New"'><span style='mso-list:Ignore'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>It uses registers that may be used by the
program that is interrupted.</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l4 level1 lfo12;
tab-stops:list .5in'><![if !supportLists]><span style='mso-fareast-font-family:
"Courier New"'><span style='mso-list:Ignore'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>It assumes that the reason the interrupt
occurred because button 0 was pressed and released.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Both of these are not problems for the example code
because:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='margin-left:1.0in;text-indent:-.25in;mso-list:
l4 level2 lfo12;tab-stops:list 1.0in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>The
example code does not use the registers used by the interrupt handler. The
example code uses r2-r5, while the interrupt handler uses r10 and r11.</p>

<p class=MsoPlainText style='margin-left:1.0in;text-indent:-.25in;mso-list:
l4 level2 lfo12;tab-stops:list 1.0in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>The
example only enables interrupts for when button 0 is pressed and released.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'>Preserving
registers in the interrupt handler<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoPlainText>Let’s first see how we avoid overwriting registers in the
interrupt handler. <b>An interrupt may happen at any point of time.</b> It’s an
induced call that can happen in between <i>any </i>instructions of our program.
This is different that a call our program makes. Those calls we place at
specific points and we can insert code before and after to preserve registers
as needed. </p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>The interrupt handler must assume that any register any
register other <span class=SpellE><b>ea</b></span> could be holding a value
that might be of use by the interrupted program. So, the interrupt handler must
treat all registers (except <span class=SpellE>ea</span>) as “callee-saved” and
itself as the “callee”.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>The interrupt handler must make sure that the interrupt
handler does not change any register other than ea. Again, the solution is to
make sure that any registers that are changed during the execution of the
interrupt handler have their values saved and restored by the handler. We are
going to use the stack for this purpose. </p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Returning to a discussion we had when we first commented
about how subroutines are supposed to use the stack: This is why we can never
assume that values that are outside the stack will remain unchanged: an
interrupt handler may run, and use the stack temporarily to preserve register
values.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Here’s the interrupt handler. For illustration purposes
we changed the handler to use r2 and r4. The additions are shown in blue.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span>.section
.exceptions, &quot;ax&quot;</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><b><span style='color:#0070C0'>addi</span></b></span><b><span
style='color:#0070C0'> <span class=SpellE>sp</span>, <span class=SpellE>sp</span>,
-8<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#0070C0'><span style='mso-tab-count:
1'>      </span><span class=SpellE>stw</span> r2, 0(<span class=SpellE>sp</span>)<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#0070C0'><span style='mso-tab-count:
1'>      </span><span class=SpellE>stw</span> r4, 4(<span class=SpellE>sp</span>)<o:p></o:p></span></b></p>

<p class=MsoPlainText><span style='color:#0070C0'><span style='mso-tab-count:
1'>      </span><o:p></o:p></span></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movia</span> r2, 0xff200000</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>ldwio</span> r4, 0(r2)</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>xori</span> r4, r4, 0x8</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>stwio</span> r4, 0(r2)</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movia</span> r2, 0xff200050</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movi</span> r4, 1</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>stwio</span> r4, 12(r2) #clear edge for button 0</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><b><span style='color:#0070C0'>ldw</span></b></span><b><span
style='color:#0070C0'> r4, 4(<span class=SpellE>sp</span>)<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#0070C0'><span style='mso-tab-count:
1'>      </span><span class=SpellE>ldw</span> r2, 0(<span class=SpellE>sp</span>)<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#0070C0'><span style='mso-tab-count:
1'>      </span><span class=SpellE>addi</span> <span class=SpellE>sp</span>, <span
class=SpellE>sp</span>, 8<o:p></o:p></span></b></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>addi</span> <span class=SpellE>ea</span>, <span class=SpellE>ea</span>,
-4</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>eret</span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b><span lang=FR style='mso-ansi-language:FR'>COMPLETE <span
class=GramE>CODE:</span><o:p></o:p></span></b></p>

<p class=MsoPlainText><span lang=FR style='mso-ansi-language:FR'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
class=GramE><b><span lang=FR style='font-size:11.0pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#ED7D31;mso-themecolor:accent2;
mso-ansi-language:FR'>.section</span></b></span><b><span lang=FR
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2;mso-ansi-language:FR'> .exceptions, &quot;<span
class=SpellE>ax</span>&quot;<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
lang=FR style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#ED7D31;mso-themecolor:accent2;mso-ansi-language:FR'><span
style='mso-tab-count:1'>     </span></span></b><span class=SpellE><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'>addi</span></b></span><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'> <span class=SpellE>sp</span>, <span
class=SpellE>sp</span>, -8<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>stw</span> r2, 0(<span class=SpellE>sp</span>)<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>stw</span> r4, 4(<span class=SpellE>sp</span>)<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>movia</span> r2, 0xff200000<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>ldwio</span> r4, 0(r2)<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>xori</span> r4, r4, 0x8<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>stwio</span> r4, 0(r2)<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>movia</span> r2, 0xff200050<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>movi</span> r4, 1<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>stwio</span> r4, 12(r2) #clear edge for button 0<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>ldw</span> r4, 4(<span class=SpellE>sp</span>)<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>ldw</span> r2, 0(<span class=SpellE>sp</span>)<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>addi</span> <span class=SpellE>sp</span>, <span class=SpellE>sp</span>,
8<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>addi</span> <span class=SpellE>ea</span>, <span class=SpellE>ea</span>,
-4<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>eret</span><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'>.text<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
class=GramE><b><span style='font-size:11.0pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#ED7D31;mso-themecolor:accent2'>.global</span></b></span><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'> _start<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'>_start:<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>movia</span> <span class=SpellE>sp</span>, 0x200000<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span>call
button0EnableInt<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'>loop:<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span>call
<span class=SpellE>ledtoggle</span><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span>call
<span class=SpellE>waitasec</span><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>br</span> loop<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
class=SpellE><b><span style='font-size:11.0pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#ED7D31;mso-themecolor:accent2'>ledtoggle</span></b></span><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'>: <o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>movia</span> r5, 0xff200000<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>ldwio</span> r2, 0(r5)<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>xori</span> r2, r2, 1<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>stwio</span> r2, 0(r5)<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span>ret<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
class=SpellE><b><span style='font-size:11.0pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#ED7D31;mso-themecolor:accent2'>waitasec</span></b></span><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'>:<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>movia</span> r4, 0xff202000<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>movia</span> r5, 100000000<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>movi</span> r2, 0x8<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>stwio</span> r0, 0(r4) # clear TO<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>stwio</span> r2, 4(r4) # stop <span class=GramE>timer</span><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>stwio</span> r5, 8(r4) # <span class=SpellE>periodlo</span><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>srli</span> r5, r5, 16<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>stwio</span> r5, 12(r4) # <span class=SpellE>periodhi</span><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>movi</span> r2, 0x4<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>stwio</span> r2, 4(r4)<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
class=SpellE><b><span style='font-size:11.0pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#ED7D31;mso-themecolor:accent2'>bwait</span></b></span><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'>:<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>ldwio</span> r2, 0(r4)<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>andi</span> r2, r2, 0x1 # check TO<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>beq</span> r2, r0, <span class=SpellE>bwait</span><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span>ret<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'>button0EnableInt:<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>movia</span> r2, 0xff200050 #buttons<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>movi</span> r4, 0x1<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>stwio</span> r4, 12(r2) # reset EDGE bit<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>stwio</span> r4, 8(r2)<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>movi</span> r5, 0x2<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>wrctl</span> ctl3, r5 # enable <span class=SpellE>ints</span> for
IRQ1/buttons<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span><span
class=SpellE>wrctl</span> ctl0, r4 # enable <span class=SpellE>ints</span>
globally<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b><span
style='font-size:11.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#ED7D31;mso-themecolor:accent2'><span style='mso-tab-count:1'>     </span>ret<o:p></o:p></span></b></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'>Determining the
interrupt cause<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoPlainText>Let’s now augment our handler to check whether the
interrupt was caused by the button 0 of the Button PIT. To do so, we need to check
whether bit 0 of the button PIT EDGE is 1. Here’s the code – additions shown in
red:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span>.section
.exceptions, &quot;ax&quot;</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><b><span style='color:#0070C0'>addi</span></b></span><b><span
style='color:#0070C0'> <span class=SpellE>sp</span>, <span class=SpellE>sp</span>,
-8<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#0070C0'><span style='mso-tab-count:
1'>      </span><span class=SpellE>stw</span> r2, 0(<span class=SpellE>sp</span>)<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#0070C0'><span style='mso-tab-count:
1'>      </span><span class=SpellE>stw</span> r4, 4(<span class=SpellE>sp</span>)<o:p></o:p></span></b></p>

<p class=MsoPlainText><span style='color:#0070C0'><span style='mso-tab-count:
1'>      </span><o:p></o:p></span></p>

<p class=MsoPlainText><span style='color:red'><span style='mso-tab-count:1'>      </span>#
CHECK EDGE bit 0 (buttons)<o:p></o:p></span></p>

<p class=MsoPlainText><span style='color:red'><span style='mso-tab-count:1'>      </span><span
class=SpellE>movia</span> r2, 0xff200050 <o:p></o:p></span></p>

<p class=MsoPlainText><span style='color:red'><span style='mso-tab-count:1'>      </span><span
class=SpellE>ldwio</span> r2, 12(r2)<o:p></o:p></span></p>

<p class=MsoPlainText><span style='color:red'><span style='mso-tab-count:1'>      </span><span
class=SpellE>andi</span> r2, r2, 1<o:p></o:p></span></p>

<p class=MsoPlainText><span style='color:red'><span style='mso-tab-count:1'>      </span><span
class=SpellE>beq</span> r2, r0, NOTBUTTON0<o:p></o:p></span></p>

<p class=MsoPlainText><span style='color:#0070C0'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movia</span> r2, 0xff200000</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>ldwio</span> r4, 0(r2)</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>xori</span> r4, r4, 0x8</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>stwio</span> r4, 0(r2)</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movia</span> r2, 0xff200050</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movi</span> r4, 1</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>stwio</span> r4, 12(r2) #clear edge for button 0</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>br</span> <span class=SpellE>iepi</span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='color:red'>NOTBUTTON0:<o:p></o:p></span></p>

<p class=MsoPlainText><span style='color:red'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='color:red'><span style='mso-tab-count:1'>      </span>CODE
TO HANDLER OTHER POSSIBLE INTERRUPTS (not used here)<o:p></o:p></span></p>

<p class=MsoPlainText><span class=SpellE>iepi</span>:<span style='mso-tab-count:
1'> </span></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><b><span style='color:#0070C0'>ldw</span></b></span><b><span
style='color:#0070C0'> r4, 4(<span class=SpellE>sp</span>)<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#0070C0'><span style='mso-tab-count:
1'>      </span><span class=SpellE>ldw</span> r2, 0(<span class=SpellE>sp</span>)<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#0070C0'><span style='mso-tab-count:
1'>      </span><span class=SpellE>addi</span> <span class=SpellE>sp</span>, <span
class=SpellE>sp</span>, 8<o:p></o:p></span></b></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>addi</span> <span class=SpellE>ea</span>, <span class=SpellE>ea</span>,
-4</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>eret</span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'>Nested Interrupts<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoPlainText>What happens when an interrupt request is received when a
previous interrupt request is still handled by the interrupt handler?</p>

<p class=MsoPlainText>In the example code we discussed thus far, interrupts
remain disabled while the interrupt handler is running and are only re-enabled
by the <span class=SpellE>eret</span> instruction when the interrupt handler exits.
So there is no possibility of interrupting the handler to service another
interrupt request. In some cases however, it is desirable to enable interrupts
as soon as possible. This would be the case for example, when we are servicing
an interrupt handler that takes a long time to complete. For example, copying
data from a hard drive to memory or from a network interface to memory. In this
case, we would like to enable interrupt even while we are still running the
interrupt handler. To do this safely we must take the following actions:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='margin-left:.75in;text-indent:-.25in;mso-list:
l2 level1 lfo14;tab-stops:list .75in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Save
the value of <span class=SpellE>ea</span> on the stack</p>

<p class=MsoPlainText style='margin-left:.75in;text-indent:-.25in;mso-list:
l2 level1 lfo14;tab-stops:list .75in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Save
the value of ctl2 on the stack.</p>

<p class=MsoPlainText style='margin-left:.75in;text-indent:-.25in;mso-list:
l2 level1 lfo14;tab-stops:list .75in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Make
sure to tell the device that is currently being serviced to stop requesting
interrupts.</p>

<p class=MsoPlainText style='margin-left:.75in;text-indent:-.25in;mso-list:
l2 level1 lfo14;tab-stops:list .75in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>4.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Re-enable
interrupts in ctl0.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Actions 1 and 2 are necessary because once we enable
interrupts, one might occur immediately and these two registers will be
automatically overwritten. If things are to work correctly, we must make sure
that the current interrupt handler sees the right values for those two registers.
<span class=SpellE>Ea</span> contains the address of the instruction this
interrupt handler must resume execution at, and ctl1 contains the original
state of ctl0 which must be restored.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Action 3 is necessary so that we make sure that the
interrupt handler will not be called for ever before it had a chance of
servicing the current request. If we do not disable the request, the moment
interrupts are enabled, the very same request will cause another invocation of
the interrupt handler.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Here’s the modified interrupt handler that enables
interrupts inside the interrupt handler. However, we cannot enable them
immediately upon entry to the handler. Instead, we have to first check whether
it was the button 0 that caused this interrupt and clear the edge register. If
we don’t, the moment we enable interrupts the CPU will be faced with the
following scenario:</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l3 level1 lfo16'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>I am
about to execute an instruction.</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l3 level1 lfo16'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>IRQ1
is 1</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l3 level1 lfo16'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Interrupts
are enabled</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l3 level1 lfo16'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>4.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>What
should do? Service the interrupt.</p>

<p class=MsoPlainText style='margin-left:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Hence, the CPU will call the interrupt handler again, and
we will essentially have an infinite loop where we start the interrupt handler
every time we enter it and get to the instruction that re-enables interrupts.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>So, unless we acknowledge one IRQ, unfortunately, the
interrupt handler enters an infinite loop allocating more and more space on the
stack until the stack overwrites the code. What goes wrong? Well, our interrupt
handler saves a few values on the stack and then immediately re-enables
interrupts using these two instructions. The reason we are executing the
interrupt handler in the first place is that a device requested the interrupt.
However, unless the processor *explicitly* goes and notifies the device that it
is handling the interrupt, the device will keep asking. In this case, as soon
as the processor enables interrupts, the hardware finds the same interrupt
request on the IRQ lines, and then triggers another interrupt call. To avoid
having the same interrupt request continuously triggering interrupts, the
processor must notify the device that its interrupt is being handled. </p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='margin-left:.5in'>Additions are shown in green.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>handler:<span style='mso-tab-count:1'>    </span></p>

<p class=MsoPlainText><span style='color:blue'><span style='mso-tab-count:1'>      </span>#
PROLOGUE<o:p></o:p></span></p>

<p class=MsoPlainText><span style='color:blue'><span style='mso-tab-count:1'>      </span><span
class=SpellE>subi</span><span style='mso-tab-count:1'>  </span><span
class=SpellE>sp</span>, <span class=SpellE>sp</span>, 16<span style='mso-tab-count:
2'>        </span><span style='mso-tab-count:1'>      </span># we will be
saving four registers on the stack<o:p></o:p></span></p>

<p class=MsoPlainText><span style='color:blue'><span style='mso-tab-count:1'>      </span><span
class=SpellE>stw</span><span style='mso-tab-count:1'>   </span>r2, 0(<span
class=SpellE>sp</span>)<span style='mso-tab-count:2'>         </span><span
style='mso-tab-count:1'>      </span># save r2 <o:p></o:p></span></p>

<p class=MsoPlainText><span style='color:blue'><span style='mso-tab-count:1'>      </span><span
class=SpellE>stw</span><span style='mso-spacerun:yes'>   </span>r4, 4(<span
class=SpellE>sp</span>)<span style='mso-tab-count:2'>         </span><span
style='mso-tab-count:1'>      </span># save r5<o:p></o:p></span></p>

<p class=MsoPlainText><b><span style='color:green'><span
style='mso-spacerun:yes'>      </span># save <span class=SpellE>ea</span> -- we
will enable <span class=SpellE>ints</span> while this handler has not yet
returns<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:green'><span style='mso-tab-count:
1'>      </span><span class=SpellE>stw</span><span style='mso-spacerun:yes'>  
</span><span class=SpellE>ea</span>, 8(<span class=SpellE>sp</span>)<span
style='mso-tab-count:2'>         </span><span style='mso-tab-count:1'>      </span><o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:green'><span
style='mso-spacerun:yes'>      </span><o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:green'><span style='mso-tab-count:
1'>      </span><o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:green'><span
style='mso-spacerun:yes'>      </span># preserve ctl1 <o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:green'><span
style='mso-spacerun:yes'>      </span># used when ctl0 and ctl1 have more info
in them besides the int enable<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:green'><span
style='mso-spacerun:yes'>      </span># not applicable on our system<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:green'><span style='mso-tab-count:
1'>      </span><span class=SpellE>rdctl</span> r2, ctl1<span style='mso-tab-count:
2'>          </span><span style='mso-tab-count:1'>      </span><o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:green'><span
style='mso-spacerun:yes'>      </span><span class=SpellE>stw</span><span
style='mso-spacerun:yes'>   </span>r2, 12(<span class=SpellE>sp</span>)<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:green'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#7C7C7C;mso-themecolor:accent3;
mso-themeshade:191;mso-style-textfill-fill-color:#7C7C7C;mso-style-textfill-fill-themecolor:
accent3;mso-style-textfill-fill-alpha:100.0%;mso-style-textfill-fill-colortransforms:
lumm=75000'><span style='mso-tab-count:1'>      </span># CHECK EDGE bit 0
(buttons) and clear<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#7C7C7C;mso-themecolor:accent3;
mso-themeshade:191;mso-style-textfill-fill-color:#7C7C7C;mso-style-textfill-fill-themecolor:
accent3;mso-style-textfill-fill-alpha:100.0%;mso-style-textfill-fill-colortransforms:
lumm=75000'><span style='mso-tab-count:1'>      </span><span class=SpellE>movia</span>
r2, 0xff200050 <o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#7C7C7C;mso-themecolor:accent3;
mso-themeshade:191;mso-style-textfill-fill-color:#7C7C7C;mso-style-textfill-fill-themecolor:
accent3;mso-style-textfill-fill-alpha:100.0%;mso-style-textfill-fill-colortransforms:
lumm=75000'><span style='mso-tab-count:1'>      </span><span class=SpellE>ldwio</span>
r4, 12(r2)<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#7C7C7C;mso-themecolor:accent3;
mso-themeshade:191;mso-style-textfill-fill-color:#7C7C7C;mso-style-textfill-fill-themecolor:
accent3;mso-style-textfill-fill-alpha:100.0%;mso-style-textfill-fill-colortransforms:
lumm=75000'><span style='mso-tab-count:1'>      </span><span class=SpellE>andi</span>
r4, r4, 1<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#7C7C7C;mso-themecolor:accent3;
mso-themeshade:191;mso-style-textfill-fill-color:#7C7C7C;mso-style-textfill-fill-themecolor:
accent3;mso-style-textfill-fill-alpha:100.0%;mso-style-textfill-fill-colortransforms:
lumm=75000'><span style='mso-tab-count:1'>      </span><span class=SpellE>beq</span>
r4, r0, NORESETEDGE<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:green'><span style='mso-tab-count:
1'>      </span><o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:green'><span style='mso-tab-count:
1'>      </span><span class=SpellE>stwio</span> r4, 12(r2) # clear EDGE<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:green'>NORESETEDGE:<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:green'><span style='mso-tab-count:
1'>      </span><span class=SpellE>addi</span> <span style='mso-tab-count:1'> </span>r2,
r2, 0x1<span style='mso-tab-count:2'>       </span><span style='mso-tab-count:
1'>      </span># enable interrupts<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:green'><span style='mso-tab-count:
1'>      </span><span class=SpellE>wrctl</span> ctl0, r2<o:p></o:p></span></b></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span>#interrupts
may happen from this point on</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b><span style='color:#0070C0'><span
style='mso-spacerun:yes'>      </span># r4 will be 1 if it was the button that
caused the INT<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#0070C0'><span style='mso-tab-count:
1'>      </span><span class=SpellE>beq</span> r4, r0, NOTBUTTON0<o:p></o:p></span></b></p>

<p class=MsoPlainText><span style='color:#0070C0'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movia</span> r2, 0xff200000</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>ldwio</span> r4, 0(r2)</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>xori</span> r4, r4, 0x8</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>stwio</span> r4, 0(r2)</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movia</span> r2, 0xff200050</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movi</span> r4, 1</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>stwio</span> r4, 12(r2) #clear edge for button 0</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>br</span> <span class=SpellE>iepi</span></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>NOTBUTTON0:</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span>CODE HERE FOR
CHECKING OTHER INTERRUPT SOURCES</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span class=SpellE>iepi</span>:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='color:blue'><span style='mso-tab-count:1'>      </span>#
EPILOGUE<o:p></o:p></span></p>

<p class=MsoPlainText><b><span style='color:green'><span style='mso-tab-count:
1'>      </span><span class=SpellE>ldw</span><span style='mso-spacerun:yes'>  
</span>r2, 12(<span class=SpellE>sp</span>)<span style='mso-tab-count:2'>        </span><span
style='mso-tab-count:1'>      </span># restore ctl1<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:green'><span style='mso-tab-count:
1'>      </span><span class=SpellE>wrctl</span> ctl1, r2<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:green'><span style='mso-tab-count:
1'>      </span><span class=SpellE>ldw</span><span style='mso-spacerun:yes'>  
</span><span class=SpellE>ea</span>, 8(<span class=SpellE>sp</span>)<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:blue'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><span style='color:blue'><span style='mso-tab-count:1'>      </span><span
class=SpellE>ldw</span><span style='mso-spacerun:yes'>   </span>r4, 4(<span
class=SpellE>sp</span>)<span style='mso-tab-count:2'>         </span><span
style='mso-tab-count:1'>      </span># restore r5<o:p></o:p></span></p>

<p class=MsoPlainText><span style='color:blue'><span style='mso-tab-count:1'>      </span><span
class=SpellE>ldw</span> <span style='mso-tab-count:1'>  </span>r2, 0(<span
class=SpellE>sp</span>)<span style='mso-tab-count:2'>         </span><span
style='mso-tab-count:1'>      </span># restore r2 <o:p></o:p></span></p>

<p class=MsoPlainText><span style='color:blue'><span style='mso-tab-count:1'>      </span><span
class=SpellE>addi</span><span style='mso-tab-count:1'>  </span><span
class=SpellE>sp</span>, <span class=SpellE>sp</span>, 16<span style='mso-tab-count:
2'>        </span><span style='mso-tab-count:1'>      </span># we will be
saving two registers on the stack<o:p></o:p></span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>subi</span><span style='mso-tab-count:1'>  </span><span
class=SpellE>ea</span>, <span class=SpellE>ea</span>, 4<span style='mso-tab-count:
2'>         </span><span style='mso-tab-count:1'>      </span># make sure we
execute the instruction that was interrupted. <span class=SpellE>Ea</span>/r29
points to the instruction after it</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>eret</span><span style='mso-tab-count:4'>                    </span><span
style='mso-tab-count:1'>      </span># return from interrupt</p>

<p class=MsoPlainText><span style='mso-tab-count:5'>                              </span><span
style='mso-tab-count:1'>      </span># this restores ctl0 to <span
class=SpellE>it’s</span> previous state that was saved in ctl1</p>

<p class=MsoPlainText><span style='mso-tab-count:5'>                              </span><span
style='mso-tab-count:1'>      </span># and does pc = <span class=SpellE>ea</span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b><span style='font-family:"Times New Roman",serif;
color:#44546A;mso-themecolor:text2'>Using C to access the PIT devices<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b><span style='font-family:"Times New Roman",serif;
color:#44546A;mso-themecolor:text2'>We do not have to write code in assembly to
program devices. We can use a high-level programming language. Here we explain
how this can be done using C. Here’s a first example that uses a C pointer to
access the LED DR:<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='font-family:"Times New Roman",serif;
color:#44546A;mso-themecolor:text2'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'>void<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'>LEDtoggle0()
{<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><span
style='mso-spacerun:yes'>    </span>volatile unsigned int *const <span
class=SpellE>ledp</span> = 0xFF200000;<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><span
style='mso-spacerun:yes'>    </span>unsigned int v;<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><span
style='mso-spacerun:yes'>    </span>int delay;<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><span
style='mso-spacerun:yes'>    </span><o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><span
style='mso-spacerun:yes'>    </span>while (1) {<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><span
style='mso-spacerun:yes'>  </span><span
style='mso-spacerun:yes'>          </span>v = *<span class=SpellE>ledp</span>;
v = v^0x1; *<span class=SpellE>ledp</span> = v; // toggle LED 0 <span
style='mso-spacerun:yes'>      </span><o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><span
style='mso-spacerun:yes'>            </span>for (delay = 1000000; delay &gt; 0;
delay--);<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><span
style='mso-spacerun:yes'>    </span>}<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'>}<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='font-family:"Times New Roman",serif;
color:#44546A;mso-themecolor:text2'>The declaration of pointer “<span
class=SpellE>ledp</span>” is for a pointer to a word in memory that is at
address 0xff200000. The “const” qualifier states that this pointer value (the
address) will never change and allows the compiler to use it directly any time
the code <span class=SpellE>deferences</span> “<span class=SpellE>ledp</span>”.
Please do read the timer notes for more details on this. The “volatile”
qualifier also instructs the compiler to always perform all accesses to the
pointer address using <span class=SpellE>ldwio</span> and <span class=SpellE>stwio</span>.
The pointer will not be register allocated. <o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='font-family:"Times New Roman",serif;
color:#44546A;mso-themecolor:text2'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b><span style='font-family:"Times New Roman",serif;
color:#44546A;mso-themecolor:text2'>The above code works correctly, however, if
we wanted to program for example the buttons PIT or the GPIO PIT, we would need
to declare three or four separate pointers for the DR, DIR (not used for
buttons), MASK and EDGE registers. Subjective as it might be, to improve code
readability and maintainability, we can use C structures to expose the devices
structure to the program as follows:<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='font-family:"Times New Roman",serif;
color:#44546A;mso-themecolor:text2'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'>struct
<span class=SpellE>PIT_t</span> {<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><span
style='mso-spacerun:yes'>      </span>volatile unsigned int<span
style='mso-spacerun:yes'>      </span>DR;<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><span
style='mso-spacerun:yes'>      </span>volatile unsigned int<span
style='mso-spacerun:yes'>      </span>DIR;<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><span
style='mso-spacerun:yes'>      </span>volatile unsigned int<span
style='mso-spacerun:yes'>      </span>MASK;<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><span
style='mso-spacerun:yes'>      </span>volatile unsigned int<span
style='mso-spacerun:yes'>      </span>EDGE;<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><span
style='mso-spacerun:yes'>      </span>};<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'>//
The LED pit is at this base address<o:p></o:p></span></b></p>

<p class=MsoPlainText><span class=SpellE><span class=GramE><b><span lang=FR
style='color:#44546A;mso-themecolor:text2;mso-ansi-language:FR'>struct</span></b></span></span><b><span
lang=FR style='color:#44546A;mso-themecolor:text2;mso-ansi-language:FR'> <span
class=SpellE>PIT_t</span><span style='mso-spacerun:yes'>      </span>*<span
class=SpellE>const</span> <span class=SpellE>ledp</span> = ((<span
class=SpellE>struct</span> <span class=SpellE>PIT_t</span> *) 0xFF200000);<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'>//
The BUTTONS pit is at this base address<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'>struct
<span class=SpellE>PIT_t</span><span style='mso-spacerun:yes'>     
</span>*const <span class=SpellE>buttonp</span> = ((struct <span class=SpellE>PIT_t</span>
*) 0xFF200050);<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'>void<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'>LEDButton0Toggle(void)
{<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><span
style='mso-spacerun:yes'>   </span><span class=SpellE>ledp</span>-&gt;DR = 0;
// turn off all <span class=SpellE>leds</span><o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><span
style='mso-spacerun:yes'>   </span>while (1) {<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><span
style='mso-spacerun:yes'>       </span>// check if the first button was pressed
and released<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><span
style='mso-spacerun:yes'>      </span>if (<span class=SpellE>buttonp</span>-&gt;EDGE
&amp; 0x1) {<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><span
style='mso-spacerun:yes'>         </span><span class=SpellE>ledp</span>-&gt;DR
= <span class=SpellE>ledp</span>-&gt;DR ^ 0x1; // toggle bit 0 of the <span
class=SpellE>leds</span><o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><span
style='mso-spacerun:yes'>         </span><span class=SpellE>buttonp</span>-&gt;EDGE
= 0x1; // reset bit 0 of the BUTTON EDGE<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><span
style='mso-spacerun:yes'>      </span>}<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><span
style='mso-spacerun:yes'>   </span>}<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'>}<span
style='mso-tab-count:1'>     </span><o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b><span style='font-family:"Times New Roman",serif;
color:#44546A;mso-themecolor:text2'>The code declares first a structure containing
four words one per register in the PIT devices. Then the <span class=SpellE>ledp</span>
and button declarations define two constants that can be used to directly
access the corresponding PITs (LEDs and buttons).<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='font-family:"Times New Roman",serif;
color:#44546A;mso-themecolor:text2'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b><span style='font-family:"Times New Roman",serif;
color:#44546A;mso-themecolor:text2'>The function first turns off all LEDS and
then polls the EDGE register of the buttons waiting for button 0 to be pressed
and released. Then, toggles LED 0, clears bit 0 of the EDGE register for the
buttons, and repeats.<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='color:#44546A;mso-themecolor:text2'><span
style='mso-spacerun:yes'> </span><o:p></o:p></span></b></p>

</div>

</body>

</html>
