<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml"
xmlns:st1="urn:schemas-microsoft-com:office:smarttags"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1253">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 15">
<meta name=Originator content="Microsoft Word 15">
<link rel=File-List href="l15.1-introduction-to-IO-the-PIT_files/filelist.xml">
<link rel=Edit-Time-Data
href="l15.1-introduction-to-IO-the-PIT_files/editdata.mso">
<!--[if !mso]>
<style>
v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style>
<![endif]-->
<title>Lecture 2</title>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="place"/>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="address"/>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Name</o:Author>
  <o:LastAuthor>Andreas Moshovos</o:LastAuthor>
  <o:Revision>6</o:Revision>
  <o:TotalTime>585</o:TotalTime>
  <o:Created>2024-01-30T01:58:00Z</o:Created>
  <o:LastSaved>2024-02-01T02:21:00Z</o:LastSaved>
  <o:Pages>17</o:Pages>
  <o:Words>5387</o:Words>
  <o:Characters>30709</o:Characters>
  <o:Company>Organization</o:Company>
  <o:Lines>255</o:Lines>
  <o:Paragraphs>72</o:Paragraphs>
  <o:CharactersWithSpaces>36024</o:CharactersWithSpaces>
  <o:Version>16.00</o:Version>
 </o:DocumentProperties>
</xml><![endif]-->
<link rel=themeData href="l15.1-introduction-to-IO-the-PIT_files/themedata.thmx">
<link rel=colorSchemeMapping
href="l15.1-introduction-to-IO-the-PIT_files/colorschememapping.xml">
<!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:View>Print</w:View>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:TrackMoves>false</w:TrackMoves>
  <w:TrackFormatting/>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:DoNotPromoteQF/>
  <w:LidThemeOther>EN-US</w:LidThemeOther>
  <w:LidThemeAsian>X-NONE</w:LidThemeAsian>
  <w:LidThemeComplexScript>X-NONE</w:LidThemeComplexScript>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
   <w:SplitPgBreakAndParaMark/>
   <w:DontVertAlignCellWithSp/>
   <w:DontBreakConstrainedForcedTables/>
   <w:DontVertAlignInTxbx/>
   <w:Word11KerningPairs/>
   <w:CachedColBalance/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
  <m:mathPr>
   <m:mathFont m:val="Cambria Math"/>
   <m:brkBin m:val="before"/>
   <m:brkBinSub m:val="&#45;-"/>
   <m:smallFrac m:val="off"/>
   <m:dispDef/>
   <m:lMargin m:val="0"/>
   <m:rMargin m:val="0"/>
   <m:defJc m:val="centerGroup"/>
   <m:wrapIndent m:val="1440"/>
   <m:intLim m:val="subSup"/>
   <m:naryLim m:val="undOvr"/>
  </m:mathPr></w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" DefUnhideWhenUsed="false"
  DefSemiHidden="false" DefQFormat="false" LatentStyleCount="376">
  <w:LsdException Locked="false" QFormat="true" Name="Normal"/>
  <w:LsdException Locked="false" QFormat="true" Name="heading 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 4"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 5"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 6"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 7"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 8"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 9"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="caption"/>
  <w:LsdException Locked="false" QFormat="true" Name="Title"/>
  <w:LsdException Locked="false" Priority="1" Name="Default Paragraph Font"/>
  <w:LsdException Locked="false" QFormat="true" Name="Subtitle"/>
  <w:LsdException Locked="false" QFormat="true" Name="Strong"/>
  <w:LsdException Locked="false" QFormat="true" Name="Emphasis"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Normal Table"/>
  <w:LsdException Locked="false" Priority="99" Name="No List"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Simple 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Simple 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Simple 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Classic 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Classic 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Classic 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Classic 4"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Colorful 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Colorful 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Colorful 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Columns 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Columns 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Columns 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Columns 4"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Columns 5"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Grid 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Grid 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Grid 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Grid 4"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Grid 5"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Grid 6"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Grid 7"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Grid 8"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table List 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table List 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table List 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table List 4"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table List 5"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table List 6"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table List 7"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table List 8"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table 3D effects 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table 3D effects 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table 3D effects 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Contemporary"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Elegant"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Professional"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Subtle 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Subtle 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Web 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Web 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Web 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Theme"/>
  <w:LsdException Locked="false" Priority="99" SemiHidden="true"
   Name="Placeholder Text"/>
  <w:LsdException Locked="false" Priority="1" QFormat="true" Name="No Spacing"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 1"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="99" SemiHidden="true" Name="Revision"/>
  <w:LsdException Locked="false" Priority="34" QFormat="true"
   Name="List Paragraph"/>
  <w:LsdException Locked="false" Priority="29" QFormat="true" Name="Quote"/>
  <w:LsdException Locked="false" Priority="30" QFormat="true"
   Name="Intense Quote"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 1"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 1"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 1"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 2"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 2"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 2"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 2"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 3"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 3"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 3"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 3"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 4"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 4"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 4"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 4"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 5"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 5"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 5"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 5"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 6"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 6"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 6"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 6"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="19" QFormat="true"
   Name="Subtle Emphasis"/>
  <w:LsdException Locked="false" Priority="21" QFormat="true"
   Name="Intense Emphasis"/>
  <w:LsdException Locked="false" Priority="31" QFormat="true"
   Name="Subtle Reference"/>
  <w:LsdException Locked="false" Priority="32" QFormat="true"
   Name="Intense Reference"/>
  <w:LsdException Locked="false" Priority="33" QFormat="true" Name="Book Title"/>
  <w:LsdException Locked="false" Priority="37" SemiHidden="true"
   UnhideWhenUsed="true" Name="Bibliography"/>
  <w:LsdException Locked="false" Priority="39" SemiHidden="true"
   UnhideWhenUsed="true" QFormat="true" Name="TOC Heading"/>
  <w:LsdException Locked="false" Priority="41" Name="Plain Table 1"/>
  <w:LsdException Locked="false" Priority="42" Name="Plain Table 2"/>
  <w:LsdException Locked="false" Priority="43" Name="Plain Table 3"/>
  <w:LsdException Locked="false" Priority="44" Name="Plain Table 4"/>
  <w:LsdException Locked="false" Priority="45" Name="Plain Table 5"/>
  <w:LsdException Locked="false" Priority="40" Name="Grid Table Light"/>
  <w:LsdException Locked="false" Priority="46" Name="Grid Table 1 Light"/>
  <w:LsdException Locked="false" Priority="47" Name="Grid Table 2"/>
  <w:LsdException Locked="false" Priority="48" Name="Grid Table 3"/>
  <w:LsdException Locked="false" Priority="49" Name="Grid Table 4"/>
  <w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark"/>
  <w:LsdException Locked="false" Priority="51" Name="Grid Table 6 Colorful"/>
  <w:LsdException Locked="false" Priority="52" Name="Grid Table 7 Colorful"/>
  <w:LsdException Locked="false" Priority="46"
   Name="Grid Table 1 Light Accent 1"/>
  <w:LsdException Locked="false" Priority="47" Name="Grid Table 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="48" Name="Grid Table 3 Accent 1"/>
  <w:LsdException Locked="false" Priority="49" Name="Grid Table 4 Accent 1"/>
  <w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark Accent 1"/>
  <w:LsdException Locked="false" Priority="51"
   Name="Grid Table 6 Colorful Accent 1"/>
  <w:LsdException Locked="false" Priority="52"
   Name="Grid Table 7 Colorful Accent 1"/>
  <w:LsdException Locked="false" Priority="46"
   Name="Grid Table 1 Light Accent 2"/>
  <w:LsdException Locked="false" Priority="47" Name="Grid Table 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="48" Name="Grid Table 3 Accent 2"/>
  <w:LsdException Locked="false" Priority="49" Name="Grid Table 4 Accent 2"/>
  <w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark Accent 2"/>
  <w:LsdException Locked="false" Priority="51"
   Name="Grid Table 6 Colorful Accent 2"/>
  <w:LsdException Locked="false" Priority="52"
   Name="Grid Table 7 Colorful Accent 2"/>
  <w:LsdException Locked="false" Priority="46"
   Name="Grid Table 1 Light Accent 3"/>
  <w:LsdException Locked="false" Priority="47" Name="Grid Table 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="48" Name="Grid Table 3 Accent 3"/>
  <w:LsdException Locked="false" Priority="49" Name="Grid Table 4 Accent 3"/>
  <w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark Accent 3"/>
  <w:LsdException Locked="false" Priority="51"
   Name="Grid Table 6 Colorful Accent 3"/>
  <w:LsdException Locked="false" Priority="52"
   Name="Grid Table 7 Colorful Accent 3"/>
  <w:LsdException Locked="false" Priority="46"
   Name="Grid Table 1 Light Accent 4"/>
  <w:LsdException Locked="false" Priority="47" Name="Grid Table 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="48" Name="Grid Table 3 Accent 4"/>
  <w:LsdException Locked="false" Priority="49" Name="Grid Table 4 Accent 4"/>
  <w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark Accent 4"/>
  <w:LsdException Locked="false" Priority="51"
   Name="Grid Table 6 Colorful Accent 4"/>
  <w:LsdException Locked="false" Priority="52"
   Name="Grid Table 7 Colorful Accent 4"/>
  <w:LsdException Locked="false" Priority="46"
   Name="Grid Table 1 Light Accent 5"/>
  <w:LsdException Locked="false" Priority="47" Name="Grid Table 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="48" Name="Grid Table 3 Accent 5"/>
  <w:LsdException Locked="false" Priority="49" Name="Grid Table 4 Accent 5"/>
  <w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark Accent 5"/>
  <w:LsdException Locked="false" Priority="51"
   Name="Grid Table 6 Colorful Accent 5"/>
  <w:LsdException Locked="false" Priority="52"
   Name="Grid Table 7 Colorful Accent 5"/>
  <w:LsdException Locked="false" Priority="46"
   Name="Grid Table 1 Light Accent 6"/>
  <w:LsdException Locked="false" Priority="47" Name="Grid Table 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="48" Name="Grid Table 3 Accent 6"/>
  <w:LsdException Locked="false" Priority="49" Name="Grid Table 4 Accent 6"/>
  <w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark Accent 6"/>
  <w:LsdException Locked="false" Priority="51"
   Name="Grid Table 6 Colorful Accent 6"/>
  <w:LsdException Locked="false" Priority="52"
   Name="Grid Table 7 Colorful Accent 6"/>
  <w:LsdException Locked="false" Priority="46" Name="List Table 1 Light"/>
  <w:LsdException Locked="false" Priority="47" Name="List Table 2"/>
  <w:LsdException Locked="false" Priority="48" Name="List Table 3"/>
  <w:LsdException Locked="false" Priority="49" Name="List Table 4"/>
  <w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark"/>
  <w:LsdException Locked="false" Priority="51" Name="List Table 6 Colorful"/>
  <w:LsdException Locked="false" Priority="52" Name="List Table 7 Colorful"/>
  <w:LsdException Locked="false" Priority="46"
   Name="List Table 1 Light Accent 1"/>
  <w:LsdException Locked="false" Priority="47" Name="List Table 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="48" Name="List Table 3 Accent 1"/>
  <w:LsdException Locked="false" Priority="49" Name="List Table 4 Accent 1"/>
  <w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark Accent 1"/>
  <w:LsdException Locked="false" Priority="51"
   Name="List Table 6 Colorful Accent 1"/>
  <w:LsdException Locked="false" Priority="52"
   Name="List Table 7 Colorful Accent 1"/>
  <w:LsdException Locked="false" Priority="46"
   Name="List Table 1 Light Accent 2"/>
  <w:LsdException Locked="false" Priority="47" Name="List Table 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="48" Name="List Table 3 Accent 2"/>
  <w:LsdException Locked="false" Priority="49" Name="List Table 4 Accent 2"/>
  <w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark Accent 2"/>
  <w:LsdException Locked="false" Priority="51"
   Name="List Table 6 Colorful Accent 2"/>
  <w:LsdException Locked="false" Priority="52"
   Name="List Table 7 Colorful Accent 2"/>
  <w:LsdException Locked="false" Priority="46"
   Name="List Table 1 Light Accent 3"/>
  <w:LsdException Locked="false" Priority="47" Name="List Table 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="48" Name="List Table 3 Accent 3"/>
  <w:LsdException Locked="false" Priority="49" Name="List Table 4 Accent 3"/>
  <w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark Accent 3"/>
  <w:LsdException Locked="false" Priority="51"
   Name="List Table 6 Colorful Accent 3"/>
  <w:LsdException Locked="false" Priority="52"
   Name="List Table 7 Colorful Accent 3"/>
  <w:LsdException Locked="false" Priority="46"
   Name="List Table 1 Light Accent 4"/>
  <w:LsdException Locked="false" Priority="47" Name="List Table 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="48" Name="List Table 3 Accent 4"/>
  <w:LsdException Locked="false" Priority="49" Name="List Table 4 Accent 4"/>
  <w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark Accent 4"/>
  <w:LsdException Locked="false" Priority="51"
   Name="List Table 6 Colorful Accent 4"/>
  <w:LsdException Locked="false" Priority="52"
   Name="List Table 7 Colorful Accent 4"/>
  <w:LsdException Locked="false" Priority="46"
   Name="List Table 1 Light Accent 5"/>
  <w:LsdException Locked="false" Priority="47" Name="List Table 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="48" Name="List Table 3 Accent 5"/>
  <w:LsdException Locked="false" Priority="49" Name="List Table 4 Accent 5"/>
  <w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark Accent 5"/>
  <w:LsdException Locked="false" Priority="51"
   Name="List Table 6 Colorful Accent 5"/>
  <w:LsdException Locked="false" Priority="52"
   Name="List Table 7 Colorful Accent 5"/>
  <w:LsdException Locked="false" Priority="46"
   Name="List Table 1 Light Accent 6"/>
  <w:LsdException Locked="false" Priority="47" Name="List Table 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="48" Name="List Table 3 Accent 6"/>
  <w:LsdException Locked="false" Priority="49" Name="List Table 4 Accent 6"/>
  <w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark Accent 6"/>
  <w:LsdException Locked="false" Priority="51"
   Name="List Table 6 Colorful Accent 6"/>
  <w:LsdException Locked="false" Priority="52"
   Name="List Table 7 Colorful Accent 6"/>
  <w:LsdException Locked="false" Priority="99" SemiHidden="true"
   UnhideWhenUsed="true" Name="Mention"/>
  <w:LsdException Locked="false" Priority="99" SemiHidden="true"
   UnhideWhenUsed="true" Name="Smart Hyperlink"/>
  <w:LsdException Locked="false" Priority="99" SemiHidden="true"
   UnhideWhenUsed="true" Name="Hashtag"/>
  <w:LsdException Locked="false" Priority="99" SemiHidden="true"
   UnhideWhenUsed="true" Name="Unresolved Mention"/>
  <w:LsdException Locked="false" Priority="99" SemiHidden="true"
   UnhideWhenUsed="true" Name="Smart Link"/>
 </w:LatentStyles>
</xml><![endif]--><!--[if !mso]><object
 classid="clsid:38481807-CA0E-42D2-BF39-B33AF135CC4D" id=ieooui></object>
<style>
st1\:*{behavior:url(#ieooui) }
</style>
<![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Batang;
	panose-1:2 3 6 0 0 1 1 1 1 1;
	mso-font-alt:Batang;
	mso-font-charset:129;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:-1342176593 1775729915 48 0 524447 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:-536869121 1107305727 33554432 0 415 0;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:-520081665 -1073717157 41 0 66047 0;}
@font-face
	{font-family:Consolas;
	panose-1:2 11 6 9 2 2 4 3 2 4;
	mso-font-charset:0;
	mso-generic-font-family:modern;
	mso-font-pitch:fixed;
	mso-font-signature:-536869121 64767 1 0 415 0;}
@font-face
	{font-family:"\@Batang";
	panose-1:2 3 6 0 0 1 1 1 1 1;
	mso-font-charset:129;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:-1342176593 1775729915 48 0 524447 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-parent:"";
	margin:0in;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman",serif;
	mso-fareast-font-family:Batang;}
p.MsoPlainText, li.MsoPlainText, div.MsoPlainText
	{mso-style-unhide:no;
	mso-style-link:"Plain Text Char";
	margin:0in;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:Batang;}
p.MsoAcetate, li.MsoAcetate, div.MsoAcetate
	{mso-style-unhide:no;
	mso-style-link:"Balloon Text Char";
	margin:0in;
	mso-pagination:widow-orphan;
	font-size:8.0pt;
	font-family:"Tahoma",sans-serif;
	mso-fareast-font-family:Batang;}
p.msonormal0, li.msonormal0, div.msonormal0
	{mso-style-name:msonormal;
	mso-style-unhide:no;
	mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman",serif;
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;}
span.PlainTextChar
	{mso-style-name:"Plain Text Char";
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"Plain Text";
	mso-ansi-font-size:10.5pt;
	mso-bidi-font-size:10.5pt;
	font-family:Consolas;
	mso-ascii-font-family:Consolas;
	mso-fareast-font-family:Batang;
	mso-hansi-font-family:Consolas;
	mso-bidi-font-family:Consolas;}
span.BalloonTextChar
	{mso-style-name:"Balloon Text Char";
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"Balloon Text";
	mso-ansi-font-size:8.0pt;
	mso-bidi-font-size:8.0pt;
	font-family:"Tahoma",sans-serif;
	mso-ascii-font-family:Tahoma;
	mso-fareast-font-family:Batang;
	mso-hansi-font-family:Tahoma;
	mso-bidi-font-family:Tahoma;}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
.MsoChpDefault
	{mso-style-type:export-only;
	mso-default-props:yes;
	font-size:10.0pt;
	mso-ansi-font-size:10.0pt;
	mso-bidi-font-size:10.0pt;
	mso-font-kerning:0pt;
	mso-ligatures:none;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 65.95pt 1.0in 65.95pt;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.WordSection1
	{page:WordSection1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman",serif;}
table.MsoTableGrid
	{mso-style-name:"Table Grid";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-unhide:no;
	border:solid windowtext 1.0pt;
	mso-border-alt:solid windowtext .5pt;
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-border-insideh:.5pt solid windowtext;
	mso-border-insidev:.5pt solid windowtext;
	mso-para-margin:0in;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman",serif;}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="1026"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body lang=EN-US style='tab-interval:.5in;word-wrap:break-word'>

<div class=WordSection1>

<p class=MsoPlainText>ECE243</p>

<p class=MsoPlainText>Andreas Moshovos</p>

<p class=MsoPlainText>Revised Oct. 2015</p>

<p class=MsoPlainText>Revised Jan 2024</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b><span style='font-family:"Times New Roman",serif'>Introduction
to Devices – General Concepts – Memory Mapped I/O<o:p></o:p></span></b></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'>Having discussed
instructions and how these can be used to manipulate data in memory and
registers we now move on to how a processor can interact with the physical
world via Devices. If you recall in our first <span class=GramE>lecture</span>
we explained that what makes computers really useful is that they can, with the
help of specialized devices, interact with the physical world.<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-family:"Times New Roman",serif'>Following
the same approach as the one we used for explaining machine instructions,
memory and registers we will first discuss the <b>programming model </b>for a
specific device. That is, initially we will ignore <b>how the device works, </b>and
focus <b>on how it behaves. </b>Initially, for us the device will be a <b>black
box</b> which we can program following the programming model. Later <span
class=GramE>on</span> we will discuss the <b>implementation </b>of the device.
This <span class=GramE><b>how</b></span><b> it works </b>and as we explained
earlier, there may be many different implementations that adhere to the
programming model.<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-family:"Times New Roman",serif'>The
difficulty with devices is that there isn’t a universal programming model that
can be applied to all devices. While there may be some minor <span class=GramE>similarities</span>
for the most part most devices are specialized <span class=GramE>units</span>
and their programming model differs significantly from those of other devices.
For this reason, we will start with a specific example and then point to some
underlying principles that are used by most devices. The example we will use is
a <b>parallel interface (PIT) </b><span style='mso-bidi-font-weight:bold'>or
the <span class=GramE><b>General Purpose</b></span><b> Input/Output </b>ports
(we’ll stick to the term PIT in this note)<b>. </b></span><o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-family:"Times New Roman",serif'>Before
we proceed to discuss the PITs as they <span class=GramE>is</span> used in the
DE2 board we will first discuss how the processor can talk to a PIT and read or
write data from/to it. For this <span class=GramE>purpose</span> let us first
define the term <b>name space. </b>A name space is a set of names that the
processor can access (read from or write to) using instructions. Thus far we
have seen two name spaces: memory and registers. In NIOS II the memory name
space (the address space) comprises 4G different addresses while the register
name space includes r0-r31 plus the control registers. \<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-family:"Times New Roman",serif'>In
many processors and computers that exist today, including the NIOS II, the
memory name space is also used to communicate with devices. That is, some
memory addresses are reserved at design time for accessing I/O (input/output)
devices. This way, we can access devices using the same instructions that
access memory (e.g., <span class=SpellE>ldwio</span> or <span class=SpellE>stwio</span>).
The semantics of the resulting “memory” reads and writes are device specific as
we are no longer accessing memory.<span style='mso-spacerun:yes'>  </span>In
this note we will see that by writing to one of the PITs we can turn on and off
LEDs (lights), whereas reading from another PIT we can detect whether a user <span
class=GramE>pressing</span> some of the buttons on the board.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-family:"Times New Roman",serif'>As
a side note, please do be aware that some processors have a third, separate
name space, for accessing devices. A notable example is the x86 family (Core
Duo belongs in this family) where there are three name spaces: (1) registers,
(2) memory, and (3) devices. In such machines, there are additional
instructions for accessing devices (called IN and OUT in x86). However, most
processors and computers today use <b>MEMORY MAPPED I/O. </b>In memory mapped
I/O devices appear as memory addresses and can be accessed using the same
instructions that access memory. We will later explain how memory mapped I/O
works at the physical level. For the time being suffices to consider that some
addresses are NOT mapped to memory elements but to I/O devices.<o:p></o:p></span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b><span style='font-family:"Times New Roman",serif'>The
Parallel Interface<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><o:p>&nbsp;</o:p></b></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-family:"Times New Roman",serif'>On
the DE2 board there are several PIT devices. <span class=GramE>Let’s us</span>
first the general form of a PIT device and then we will consider the two PIT
devices used to access the LEDs and the button switches.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-family:"Times New Roman",serif'>In
general, each PIT can provide up to 32 external connections which can be
INPUTS, OUTPUTS, or BI-DIRECTIONAL. A bi-directional connection is one which we
can program to act as input or output, this in contrast to connections that are
hard-wired as inputs or outputs whose directionality is etched on stone at
design time.<span style='mso-spacerun:yes'>  </span>Each connection is used as
digital input or output. At the physical level what we can read or write is the
voltage level. At the time of this writing, a wire is considered by NIOS II to
be a logical 0 if it is at 0v, and it is perceived as logical 1 if it is at
3.3v.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><b><span style='font-family:
"Times New Roman",serif'>General Form of a PIT: </span></b><span
style='font-family:"Times New Roman",serif'>In the most general form a PIT
comprises 4 words in memory. We will refer to these words as “registers” and
you will often see literature for devices referring to registers comprising the
device. I am placing the word “register” in quotes as it is important to note
that sometimes these will be actual registers (as in a collection of flip-flops
you can read and write) and in other cases they might not be. Let us try to
clarify this a bit more: we would expect when we write a value v to a register,
to also be able to read back the value from it. That is, we would expect
registers to behave as storage: we write a value v, then we can read back the
value v, identical to memory values. This is not always true for device
“registers”. We shall see an example shortly.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-family:"Times New Roman",serif'>OK,
back to the general form of a PIT device. The PIT device programmatically
appears as 4 32b registers mapped onto memory. Say the base address for the PIT
was 0x1000 (this is an example, there is <span class=GramE>not</span> PIT there
in our system). Then there would be the following four registers:<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none;mso-border-alt:solid windowtext .5pt;
 mso-yfti-tbllook:1184;mso-padding-alt:0in 5.4pt 0in 5.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes'>
  <td width=54 valign=top style='width:40.25pt;border:none;border-right:solid windowtext 1.0pt;
  mso-border-right-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText style='text-align:justify'>+0</p>
  </td>
  <td width=270 valign=top style='width:202.5pt;border:solid windowtext 1.0pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText align=center style='text-align:center'><b>DR<o:p></o:p></b></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1'>
  <td width=54 valign=top style='width:40.25pt;border:none;border-right:solid windowtext 1.0pt;
  mso-border-right-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText style='text-align:justify'>+4</p>
  </td>
  <td width=270 valign=top style='width:202.5pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText align=center style='text-align:center'><b>DIR<o:p></o:p></b></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2'>
  <td width=54 valign=top style='width:40.25pt;border:none;border-right:solid windowtext 1.0pt;
  mso-border-right-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText style='text-align:justify'>+8</p>
  </td>
  <td width=270 valign=top style='width:202.5pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText align=center style='text-align:center'><b>MASK<o:p></o:p></b></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:3;mso-yfti-lastrow:yes'>
  <td width=54 valign=top style='width:40.25pt;border:none;border-right:solid windowtext 1.0pt;
  mso-border-right-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText style='text-align:justify'>+12</p>
  </td>
  <td width=270 valign=top style='width:202.5pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText align=center style='text-align:center'><b>EDGE<o:p></o:p></b></p>
  </td>
 </tr>
</table>

<p class=MsoPlainText style='text-align:justify'><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'>At offset
+0 from the base address is the DR, the DATA Register, which provides a direct
connection to the wires. By reading this register NIOS II gets a snapshot of
the voltages that are present, at that moment on the wires. This is for
connections (wires) that are configured as inputs. By writing to DR, NIOS II
can force the corresponding wires to either 0v (logical 0) or <span
class=SpellE>Vdd</span> (logical 1).<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'>DIR is
the DIRECTION register. For those PITs whose connections are bidirectional,
NIOS II can write to this register and configure the connections to be either
inputs (set the bit to 0) or outputs (set the bit to 1). We <span class=GramE>discuss</span>
these PITs later in this note.<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'>The
MASK register is used in conjunction with the EDGE register to trigger
interrupts (we have not yet discussed what interrupts are) when an input
connection transitions from 0 to 1. We will return to the MASK registers and
interrupts later in the notes. So, we <span class=GramE>leave</span> this for
the time being.<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'>Finally,
the EDGE register is used to capture transitions of 0 to 1 in an input. They
are <span class=GramE>designed like</span> to capture events of interest and we
will discuss they use in the context of the button switches. Before we do so,
let’s look at a simple example.<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'>On our
system there is PIT whose connections are outputs and are connected to the
LEDs. The LED PIT is at base address 0xFF200000. On our boards there are only
10 LEDS, so only bits 0 through 9 are connected. By writing the DR of this PIT,
NIOS II can turn on and off the LEDs. For example, the code below, turns on the
right most 5 LEDS:<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText>LED5off5on: </p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movia</span> r8, 0xFF200000</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movi</span> r2, 0x1F # bits 4-0 are 1, all others are <span
class=GramE>0</span></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>stwio</span> r2, 0(r8)<span style='mso-tab-count:1'>   </span>#
write the DR of the LED PIT</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>ldwio</span> r4, 0(r8) # no needed, illustrates that we can also
read the <span class=GramE>DR</span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-family:"Times New Roman",serif'>The
last instruction (<span class=SpellE>ldwio</span>) reads the DR of the LED PIT.
While the PIT is configured as an output, it is legal to read DR and what we
get back is effectively the value that corresponds to the voltages on the
connections. In this case, these match exactly the ones we set with the earlier
<span class=SpellE>stwio</span>. So, in this case, the DR behaves like a
register that we can simply read and write.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-family:"Times New Roman",serif'>There
is no DIR register that we need to access and configure since the LED PIT is to
be used as an OUTPUT PIT.<o:p></o:p></span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span class=SpellE><b><span style='font-family:"Times New Roman",serif'>Stwio</span></b></span><b><span
style='font-family:"Times New Roman",serif'> and <span class=SpellE>ldwio</span>
vs <span class=SpellE>stw</span> and <span class=SpellE>ldw</span>: </span></b><span
style='font-family:"Times New Roman",serif'>Notice that we used <span
class=SpellE>stwio</span> and not a plan <span class=SpellE>stw</span>. We will
explain the reason why in more detail when we talk about caches. For the time
being suffices to say that <span class=SpellE>stwio</span> instructs the
hardware to send a write request all the way to the actual memory or device.
Regular <span class=SpellE>stw</span> and <span class=SpellE>ldw</span> may not
necessarily reach all the way to memory as the processor has a “clever” piece
of hardware that may defer sending the request to memory or device. By using <span
class=SpellE>stwio</span> or <span class=SpellE>ldwio</span> we are asking the
hardware to send the request all the way to memory or the device.<o:p></o:p></span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b><span style='font-family:"Times New Roman",serif'>The
Push-Button PIT:<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'>There
is another INPUT PIT starting at address 0xFF200050 which can be used to access
the four push buttons on the board. By accessing the DR register of this PIT
NIOS II can get a snapshot of which buttons are pressed. Since there are only
four buttons only bits 0 through 3 are meaningful. When a button is pressed,
the corresponding DR bit will read as 1, otherwise it will read as 0. The
following code reads the DR of the BUTTON PIT and displays the status of the
four buttons using the LED PIT<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText>BUTTONS: </p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movia</span> r8, 0xFF200000 #LED PIT/OUTPUT</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movia</span> r9, 0xFF200050 #BUTTON PIT/INPUT</p>

<p class=MsoPlainText>FEVER:</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>ldwio</span> r2, 0(r9) #read BUTTON PIT DR</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>stwio</span> r2, 0(r8) # write the DR of the LED PIT</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>br</span> FEVER</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b><span style='font-family:"Times New Roman",serif'>Stop
lying… How many times did you press it?<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'>Time to
dive deeper into the realities of mechanical buttons and switches. The physical
circuit with the buttons is shown below:<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif;
mso-no-proof:yes'><!--[if gte vml 1]><v:shapetype id="_x0000_t75" coordsize="21600,21600"
 o:spt="75" o:preferrelative="t" path="m@4@5l@4@11@9@11@9@5xe" filled="f"
 stroked="f">
 <v:stroke joinstyle="miter"/>
 <v:formulas>
  <v:f eqn="if lineDrawn pixelLineWidth 0"/>
  <v:f eqn="sum @0 1 0"/>
  <v:f eqn="sum 0 0 @1"/>
  <v:f eqn="prod @2 1 2"/>
  <v:f eqn="prod @3 21600 pixelWidth"/>
  <v:f eqn="prod @3 21600 pixelHeight"/>
  <v:f eqn="sum @0 0 1"/>
  <v:f eqn="prod @6 1 2"/>
  <v:f eqn="prod @7 21600 pixelWidth"/>
  <v:f eqn="sum @8 21600 0"/>
  <v:f eqn="prod @7 21600 pixelHeight"/>
  <v:f eqn="sum @10 21600 0"/>
 </v:formulas>
 <v:path o:extrusionok="f" gradientshapeok="t" o:connecttype="rect"/>
 <o:lock v:ext="edit" aspectratio="t"/>
</v:shapetype><v:shape id="_x0000_i1033" type="#_x0000_t75" alt="A diagram of a circuit&#10;&#10;Description automatically generated"
 style='width:243.75pt;height:222.75pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="l15.1-introduction-to-IO-the-PIT_files/image002.png"
  o:title="A diagram of a circuit&#10;&#10;Description automatically generated"/>
</v:shape><![endif]--><![if !vml]><img width=325 height=297
src="l15.1-introduction-to-IO-the-PIT_files/image004.gif"
alt="A diagram of a circuit&#10;&#10;Description automatically generated"
v:shapes="_x0000_i1033"><![endif]></span><span style='font-family:"Times New Roman",serif'><o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'>Each
button has two terminals. One of the terminals is permanently connected to <span
class=GramE>ground</span> (0v). The other terminal is connected via a resistor
to VDD (VCC in the diagram). What NIOS II accesses when it reads the DR, is the
state of the <span class=SpellE>KEYx</span> wires in the diagram (more on this
shortly). The 74HC245 chip shown contains 4 inverters (with special electrical
characteristics that are not as important to our discussion for the moment). <o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'>Let us
return to the button switches now. When a switch is not pressed, its two
terminals are not electrically connected, so the right terminal’s voltage is
“pulled up” to VDD via the resistor. The corresponding <span class=SpellE>KEYx</span>
output will then read as 0 since <span class=GramE>the 74HC245</span> passes it
through an inverter. However, when NIOS II reads the BUTTON PIT DR register,
there is one more inverter that is not shown on the diagram and as a result
NIOS II reads the inverted state of the <span class=SpellE>KEYx</span> wires.
That is, when the button is not pressed it will read as 0 to NIOS II.<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'>When we
press a button, its two terminals are then electrically connected by the metal
plate on the underside of the button. In this case, the inputs to the 74HC245
go to 0v, and the <span class=SpellE>KEYx</span> output goes to 1. Since this
is inverted once more, NIOS II will read it as a 0.<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'>Once we
depress the button, a spring (or an equivalent contraption, pushes the button
and the metal plate up, and the electrical connection between the two terminals
seizes. The output pulls up at <span class=SpellE>Vdd</span> again, and NIOS II
will now again read a 0 for the button (not pressed). Side note, the actual
mechanism used by the button may be different (simpler <span class=GramE>actually
as</span> having one terminal being a simple metal plate that bends and touches
the other terminal when pressed by the button cover, and that springs back into
place on its own) but the concept holds.<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><b><span style='font-family:"Times New Roman",serif'>The
idealized Button behavior:<o:p></o:p></span></b></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'>As per
the preceding description, one would naturally expect the output seen on the
right terminals to be as follows in time. In the diagram below we show the
voltage on the right terminal of one of the buttons. At rest, when the button
is not pressed, it is at <span class=SpellE>Vdd</span>, the moment we press the
button, it goes to 0v, and then the moment we release the button, it jumps up
at <span class=SpellE>Vdd</span>:<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif;
mso-no-proof:yes'><!--[if gte vml 1]><v:shape id="_x0000_i1032" type="#_x0000_t75"
 alt="A diagram of a button and time&#10;&#10;Description automatically generated"
 style='width:231pt;height:137.25pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="l15.1-introduction-to-IO-the-PIT_files/image003.png"
  o:title="A diagram of a button and time&#10;&#10;Description automatically generated"/>
</v:shape><![endif]--><![if !vml]><img width=308 height=183
src="l15.1-introduction-to-IO-the-PIT_files/image006.gif"
alt="A diagram of a button and time&#10;&#10;Description automatically generated"
v:shapes="_x0000_i1032"><![endif]></span><span style='font-family:"Times New Roman",serif'><o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'>However,
this is not what happens <span class=GramE>in reality when</span> we press the
button. The pieces of metal that are supposed to touch to create the electrical
connection between the two terminals bounce as they touch. Mind you, this
happens over a very short <span class=GramE>period of time</span> (think
microsecs to milliseconds). So, it is not something we can perceive as humans.
However, recall that NIOS II operates at the MHz range and other processors at
the GHz range, so there could be thousands to millions of instructions that
execute during this bouncing event. If we write a program that simply reads the
DR register with the intention being for example to count how many times the
key is pressed, it will not work well for us. Each time the button is pressed
and depressed, the program will “see” the DR bits changing from 0 to 1 multiple
times.<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'>What happens
<span class=GramE>in reality when</span> keys are pressed is shown in the below
diagram in the “before Debouncing” diagram:<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif;
mso-no-proof:yes'><!--[if gte vml 1]><v:shape id="Picture_x0020_1" o:spid="_x0000_i1031"
 type="#_x0000_t75" alt="A diagram of a building&#10;&#10;Description automatically generated"
 style='width:6in;height:132.4pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="l15.1-introduction-to-IO-the-PIT_files/image005.png"
  o:title="A diagram of a building&#10;&#10;Description automatically generated"/>
</v:shape><![endif]--><![if !vml]><img width=576 height=177
src="l15.1-introduction-to-IO-the-PIT_files/image010.gif"
alt="A diagram of a building&#10;&#10;Description automatically generated"
v:shapes="Picture_x0020_1"><![endif]></span><span style='font-family:"Times New Roman",serif'><o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'>The
74HC254 inverters “filters” the signal and we get the “Schmitt Trigger
Debounced” signal on the <span class=SpellE>KEYx</span> wires. This is what an
ideal switch would behave like. If <span class=GramE>interested</span> you can
read more about the “Schmitt Trigger” inverters that are inside the 74HC245.
These are inverters whose characteristic curve (what the output given the
input) <span class=GramE>different</span> depending on how the input is
changing, meaning whether the input is moving from 0v to VDD or vice versa. For
a regular inverter, the direction of change matters little or <span
class=GramE>none at all</span>. For these inverters however, the direction of
change matters. In simple terms, the threshold voltage for considering the
input as 0 or 1 changes depending on the direction of change. However, knowing
how these inverters work is not needed for us to program and use the button
PIT. So, we leave it at that.<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'>Returning
to our discussion, we note that effectively the 74HC245 chip “debounces” the
button switches. Debouncing can also be done in software (it costs having the
extra chips just for debouncing and the costs grow with the number of buttons
we have). Debouncing in software is explained <span class=GramE>later on</span>
in these notes and in the context of the general purpose I/O PIT. <o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><b><span style='font-family:"Times New Roman",serif'>Using
the EDGE register: An example Toggling a LED<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-family:"Times New Roman",serif'>Now,
we can discuss the use of the EDGE register. The EDGE register captures the
0-&gt;1 edge on the <span class=SpellE>KEYx</span> wires. Each <span
class=GramE>bit<span style='mso-spacerun:yes'>  </span>of</span> the EDGE
register corresponds to one of the <span class=SpellE>KEYx</span> wires. It is
normally at 0. When the 0-&gt;1 edge is detected, the corresponding EDGE
register bit is set to 1. This is a <b>sticky bit, </b>that is, it will stay at
1 until we explicitly go and reset it. So, an EDGE register bit gives us the
following information when it reads as 1. At some point in time before we read
it, the button was pressed AND released. <o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-family:"Times New Roman",serif'>How
do we reset an EDGE bit that was set to 1 by pressing a button? We do that by
writing 1 to it. Here’s an example code that illustrates the use of EDGE bits.
The code is an infinite loop that checks whether the first button was pressed
and turns the first LED on and off. Every time we press the button, the LED
will toggle.<o:p></o:p></span></p>

<p class=MsoPlainText style='text-align:justify'><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span class=SpellE>ButtonToggleLED</span>: </p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movia</span> r8, 0xFF200000 #LED PIT/OUTPUT</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movia</span> r9, 0xFF200050 #BUTTON PIT/INPUT</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>stwio</span> r0, 0(r8) # turn off all LEDs, write 0 to LED PIT DR</p>

<p class=MsoPlainText>FEVER:</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>ldwio</span> r2, 12(r9) #read BUTTON PIT EDGE</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>andi</span> r2, r2, 1 # check bit 0</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>beq</span> r2, r0, FEVER<span style='mso-tab-count:1'> </span>#
not pressed yet, keep <span class=GramE>checking</span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span># button has
been pressed and released at some point </p>

<p class=MsoPlainText>pressed:<span style='mso-tab-count:1'>    </span></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>ldwio</span> r4, 0(r8) # read LED DR (<span class=GramE>current
status</span>)</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>xori</span> r4, r4, 1 # toggle led <span class=GramE>0</span></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>stwio</span> r4, 0(r8) # change the LEDs (write to LED PIT DR)</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>movi</span> r2, 1 #<span style='mso-tab-count:1'>      </span>RESET
bit 0 of BUTTON PIT EDGE</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>stwio</span> r2, 12(<b>r9</b>) # write the DR of the LED PIT</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE>br</span> FEVER</p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><b><span style='font-family:"Times New Roman",serif'>Using
C To Program the PITs<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'>We do
not necessarily need to write assembly to communicate with the PITs.<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'>The
following C code for example turns on all LEDs by accessing the LED PIT DR
using a pointer:<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><b><span style='font-size:9.0pt'>#define<span
style='mso-spacerun:yes'>     </span>LED_DR <span class=GramE><span
style='mso-spacerun:yes'>   </span>(</span>(volatile unsigned int *)
0xFF200000)<o:p></o:p></span></b></p>

<p class=MsoPlainText><span style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-size:9.0pt'>void<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-size:9.0pt'>main (void)<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-size:9.0pt'>{<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-size:9.0pt'><span
style='mso-spacerun:yes'> </span><o:p></o:p></span></p>

<p class=MsoPlainText><b><span style='font-size:9.0pt'><span
style='mso-spacerun:yes'>     </span>*LED_DR = <span class=GramE>0x3F;</span><o:p></o:p></span></b></p>

<p class=MsoPlainText><span style='font-size:9.0pt'>}<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'>The
volatile keyword tells the compiler not to use a register to hold the value at any
point. <span class=GramE>Instead</span> all <span class=GramE>reads</span> and
writes should be done by following the point and accessing “memory” using <span
class=SpellE>stwio</span> or <span class=SpellE>ldwio</span>.<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'>Recall
the PIT, in its general form, contains 4 registers. We can use a C structure to
make our code easier to maintain and to understand:<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-size:9.0pt'>// A PIT appears as four
consecutive words in memory<o:p></o:p></span></p>

<p class=MsoPlainText><b><span style='font-size:9.0pt'>struct <span
class=SpellE>PIT_t</span> {<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='font-size:9.0pt'><span
style='mso-spacerun:yes'>      </span>volatile unsigned int<span
style='mso-spacerun:yes'>      </span><span class=GramE>DR;</span><o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='font-size:9.0pt'><span
style='mso-spacerun:yes'>      </span>volatile unsigned int<span
style='mso-spacerun:yes'>      </span><span class=GramE>DIR;</span><o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='font-size:9.0pt'><span
style='mso-spacerun:yes'>      </span>volatile unsigned int<span
style='mso-spacerun:yes'>      </span><span class=GramE>MASK;</span><o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='font-size:9.0pt'><span
style='mso-spacerun:yes'>      </span>volatile unsigned int<span
style='mso-spacerun:yes'>      </span><span class=GramE>EDGE;</span><o:p></o:p></span></b></p>

<p class=MsoPlainText><b><span style='font-size:9.0pt'><span
style='mso-spacerun:yes'>      </span>};<o:p></o:p></span></b></p>

<p class=MsoPlainText><span style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-size:9.0pt'><span
style='mso-spacerun:yes'> </span><o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-size:9.0pt'>// The LED pit is at this
base address<o:p></o:p></span></p>

<p class=MsoPlainText><span class=SpellE><span class=GramE><b><span lang=FR
style='font-size:9.0pt;mso-ansi-language:FR'>struct</span></b></span></span><b><span
lang=FR style='font-size:9.0pt;mso-ansi-language:FR'> <span class=SpellE>PIT_t</span><span
style='mso-spacerun:yes'>      </span>*<span class=SpellE>ledp</span> = ((<span
class=SpellE>struct</span> <span class=SpellE>PIT_t</span> *) 0xFF200000);<o:p></o:p></span></b></p>

<p class=MsoPlainText><span style='font-size:9.0pt'>// The BUTTONS pit is at
this base address<o:p></o:p></span></p>

<p class=MsoPlainText><span class=SpellE><span class=GramE><b><span lang=FR
style='font-size:9.0pt;mso-ansi-language:FR'>struct</span></b></span></span><b><span
lang=FR style='font-size:9.0pt;mso-ansi-language:FR'> <span class=SpellE>PIT_t</span><span
style='mso-spacerun:yes'>      </span>*<span class=SpellE>buttonp</span> = ((<span
class=SpellE>struct</span> <span class=SpellE>PIT_t</span> *) 0xFF200050);<o:p></o:p></span></b></p>

<p class=MsoPlainText><span lang=FR style='font-size:9.0pt;mso-ansi-language:
FR'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-size:9.0pt'>void<o:p></o:p></span></p>

<p class=MsoPlainText><span class=SpellE><span style='font-size:9.0pt'>LEDtoggle</span></span><span
style='font-size:9.0pt'>(void) {<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-size:9.0pt'><span
style='mso-spacerun:yes'>   </span><span class=SpellE><b>ledp</b></span><b>-&gt;DR
= 0;</b> // turn off all <span class=SpellE>leds</span> <o:p></o:p></span></p>

<p class=MsoPlainText><b><span style='font-size:9.0pt'><span
style='mso-spacerun:yes'>   </span>while (1) </span></b><span style='font-size:
9.0pt'>{<b><o:p></o:p></b></span></p>

<p class=MsoPlainText><span style='font-size:9.0pt'><span style='mso-tab-count:
1'>       </span>// check if the first button was pressed and released<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-size:9.0pt'><span
style='mso-spacerun:yes'>      </span><b>if (<span class=SpellE>buttonp</span>-&gt;EDGE
&amp; 0x1) { <o:p></o:p></b></span></p>

<p class=MsoPlainText><b><span style='font-size:9.0pt'><span
style='mso-spacerun:yes'>         </span><span class=SpellE>ledp</span>-&gt;DR
= <span class=SpellE>ledp</span>-&gt;DR ^ 0x1;</span></b><span
style='font-size:9.0pt'> // toggle bit 0 of the <span class=SpellE>leds</span><o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-size:9.0pt'><span
style='mso-spacerun:yes'>         </span><span class=SpellE><b>buttonp</b></span><b>-&gt;EDGE
= 0x1;</b> // reset bit 0 of the BUTTON EDGE<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-size:9.0pt'><span
style='mso-spacerun:yes'>      </span>}<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-size:9.0pt'><span
style='mso-spacerun:yes'>   </span>}<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-size:9.0pt'>}<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-size:9.0pt;font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b><span style='font-family:"Times New Roman",serif'>The <span
class=GramE>General<span style='mso-spacerun:yes'>  </span>Purpose</span> PITs
(GPIO)<o:p></o:p></span></b></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='color:black'>On the DE2 board there are two
PIT devices called GPIO 1 and GPIO 2. Each provides 32 external connections
named as D0 through D31. These connections are called&nbsp;</span><b
style='font-variant-ligatures: normal;font-variant-caps: normal;orphans: 2;
text-align:start;widows: 2;-webkit-text-stroke-width: 0px;text-decoration-thickness: initial;
text-decoration-style: initial;text-decoration-color: initial;word-spacing:
0px'>General Purpose I/O pins&nbsp;</b><span style='font-variant-ligatures: normal;
font-variant-caps: normal;orphans: 2;text-align:start;widows: 2;-webkit-text-stroke-width: 0px;
text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;
float:none;word-spacing:0px'>because each is a single wire which can be used as&nbsp;</span><b
style='font-variant-ligatures: normal;font-variant-caps: normal;orphans: 2;
text-align:start;widows: 2;-webkit-text-stroke-width: 0px;text-decoration-thickness: initial;
text-decoration-style: initial;text-decoration-color: initial;word-spacing:
0px'><u>digital</u></b><span style='font-variant-ligatures: normal;font-variant-caps: normal;
orphans: 2;text-align:start;widows: 2;-webkit-text-stroke-width: 0px;
text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;
float:none;word-spacing:0px'>&nbsp;input or output. Under program control we
can either read the logical level at each of those wires (i.e., whether the
voltage on that wire is a logical 1 or a logical 0) or set their voltage to
logical 0 or logical 1. <o:p></o:p></p>

</span>

<p class=MsoPlainText><span style='color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='color:black'>Physically the GPIO pins appear
on the JP1 and JP2 connectors on the boards. Here’s a diagram of how the pins <span
class=GramE>are</span> connected (the gray boxes correspond to pins that are
not used by the port – they are connected to the power supply rails):</span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="Picture_x0020_7" o:spid="_x0000_i1030" type="#_x0000_t75" alt="http://www-ug.eecg.utoronto.ca/desl/nios_devices_SoC/default_gpio_pins.jpg"
 style='width:274.5pt;height:341.25pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="l15.1-introduction-to-IO-the-PIT_files/image007.jpg"
  o:title="default_gpio_pins"/>
</v:shape><![endif]--><![if !vml]><img width=366 height=455
src="l15.1-introduction-to-IO-the-PIT_files/image007.jpg"
alt="http://www-ug.eecg.utoronto.ca/desl/nios_devices_SoC/default_gpio_pins.jpg"
v:shapes="Picture_x0020_7"><![endif]></span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>As an <span class=GramE>example</span> we will consider
an application where the PIT is used to control the fan of a heating system.
The PIT will be used to read the status of a thermostat and then it will be
used to turn on or off the heating system’s fan. We will assume that the
thermostat provides a single output which is 0 if the temperature is less than
a preset level and 1 otherwise. We want to turn <span class=GramE>of</span> the
fan is the thermostat’s output is 0 and turn it off otherwise (you may observe
that a computer is probably an overkill for this application, however, please
recall this is an example). So, one of eight PIT connections will be used as
input to read the thermostat <span class=GramE>status</span> and another will
be used as output to control the fan motor.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>The PIT interface presents a programming interface that
consists of two bytes <span class=GramE>in</span> memory (there are more
registers which we will describe <span class=GramE>later on</span>). For port
GPIO 1 the two registers are:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in'>The DATA
register (DR) at address 0xFF200060 (read or write)</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in'>The DATA
DIRECTION register (DIR) at address 0xFF200060 + 4 = 0xFF200064 (read or write)</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none;mso-border-alt:solid windowtext .5pt;
 mso-yfti-tbllook:1184;mso-padding-alt:0in 5.4pt 0in 5.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes'>
  <td width=327 valign=top style='width:245.45pt;border:none;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText align=right style='text-align:right'><b>Address<o:p></o:p></b></p>
  </td>
  <td width=213 valign=top style='width:159.55pt;border:none;border-bottom:
  solid windowtext 1.0pt;mso-border-bottom-alt:solid windowtext .5pt;
  padding:0in 5.4pt 0in 5.4pt;border-color:-moz-use-text-color -moz-use-text-color windowtext'>
  <p class=MsoPlainText>WORD</p>
  </td>
  <td width=213 valign=top style='width:159.55pt;border:none;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText><o:p>&nbsp;</o:p></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1'>
  <td width=327 valign=top style='width:245.45pt;border:none;border-right:solid windowtext 1.0pt;
  mso-border-right-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt;
  border-color:-moz-use-text-color windowtext -moz-use-text-color -moz-use-text-color'>
  <p class=MsoPlainText align=right style='text-align:right'>0xFF200060<o:p></o:p></p>
  </td>
  <td width=213 valign=top style='width:159.55pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt;border-color:
  -moz-use-text-color windowtext windowtext -moz-use-text-color'>
  <p class=MsoPlainText align=center style='text-align:center'><b>DR<o:p></o:p></b></p>
  </td>
  <td width=213 valign=top style='width:159.55pt;border:none;mso-border-left-alt:
  solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText align=center style='text-align:center'>Data Register</p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2;mso-yfti-lastrow:yes'>
  <td width=327 valign=top style='width:245.45pt;border:none;border-right:solid windowtext 1.0pt;
  mso-border-right-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt;
  border-color:-moz-use-text-color windowtext -moz-use-text-color -moz-use-text-color'>
  <p class=MsoPlainText align=right style='text-align:right'>0xFF200064<o:p></o:p></p>
  </td>
  <td width=213 valign=top style='width:159.55pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt;border-color:
  -moz-use-text-color windowtext windowtext -moz-use-text-color'>
  <p class=MsoPlainText align=center style='text-align:center'><b>DIR<o:p></o:p></b></p>
  </td>
  <td width=213 valign=top style='width:159.55pt;border:none;mso-border-left-alt:
  solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText align=center style='text-align:center'>Direction
  Register</p>
  </td>
 </tr>
</table>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>We can view the device as having a <b>base address </b>of
0xFF200060, and the two registers at offsets (distances) +0 for DR and +4 for
DIR. The other PIT is identical using only a different base address. Here’s the
complete list:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1. PIT
1:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0xFF200060</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2. PIT
2:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0xFF200070</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>In addition to the two <span class=GramE>registers</span>
we just described each PIT has two more registers which are used to control the
port’s <span class=GramE>interrupt</span> behavior. More on this when we start
discussing interrupts.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><st1:city w:st="on">While we will be using loads and
stores to communicate with I/O devices the semantics of these operations can be
very different than that of regular memory reads and writes. The CPU is
oblivious of these differences. Only you, the programmer, based on the
information about the device’s behavior will know what to expect. To the CPU
these loads and stores will appear as normal memory reads and writes.
Specifically, reading</st1:city> or writing from/to these memory addresses is
not the same as reading or writing to other memory addresses. These locations
do not map to memory storage elements. They instead map to the PIT device and
allow the program to control it, read from it or write to it. Notice that while
we use the term <b>register </b>to refer to the locations used by the PIT,
these are different from the registers used by the CPU. We are not supposed to
use them to store data for later manipulation. Moreover, in the implementation
it may be that there isn’t a register there at all. <span class=GramE>So</span>
the term register is used loosely to refer to all the locations that exist
within a device and that can be accessed to communicate with it.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>As we noted earlier the PIT provides 32 external single
“bit” (wire) connections to the outside world. </p>

<p class=MsoPlainText>Each of these connections can be configured as an input
or an output independently. This can be done by writing a value into the DDR
register. The DIR register has 32 bits which we can change by storing a word
into the address where DIR is mapped at. Each of these bits controls the
direction of the corresponding external connection. For example, if bit 0 of
DIR is set to 1, then D0 becomes an output otherwise it becomes an input.<span
style='mso-spacerun:yes'>  </span>When we access <span class=SpellE>an</span>
I/O device we <b style='mso-bidi-font-weight:normal'>*have*</b> to use the IO
variants of loads and stores, e.g., <span class=SpellE><b style='mso-bidi-font-weight:
normal'><u>ldwio</u></b></span> or <span class=SpellE><b style='mso-bidi-font-weight:
normal'><u>stwio</u></b></span>. These instructions bypass any temporary
buffering that the CPU may be performing and send the memory requests
immediately.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Here are a couple of <span class=GramE>example</span> of
configuring the PIT ports for input or output:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Configure all pins as <span
class=GramE>outputs</span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE><span
class=GramE>addi</span></span><span class=GramE>&nbsp; r</span>8, r0,
0xFFFFFFFF</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>movia</span>
r9, 0xFF200064</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>stwio</span>
r8, 0(r9)</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Configure all pins as <span
class=GramE>inputs</span></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE><span
class=GramE>addi</span></span><span class=GramE>&nbsp; r</span>8, r0, <span
style='color:red'>0</span></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>movia</span>
r9, 0xFF200064</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>stwio</span>
r8, 0(r9)</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Configure pins D0 through
D3 as outputs, and pins D4 through D31 as <span class=GramE>inputs</span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE><span
class=GramE>addi</span></span><span class=GramE>&nbsp; r</span>8, r0, 0x000000F</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>movia</span>
r9, 0xFF200064</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>stwio</span>
r8, 0(r9)</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><br>
To set the value of a PIT bit to a specific level we <span class=GramE>have to</span>
write the corresponding bit of the DR register. Thus, <span class=GramE>assuming
that</span> DIR=0xFFFFFFFF, then writing 0x0000000F into DR forces D0-D3 to
logical 1 and D4-D31 to logical 0. If a pin is configured as an input, writing
the corresponding DR bit does not change the pin’s value. Such <span
class=GramE>writes</span> are silently ignored.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>At any <span class=GramE>time</span> we can read the DR
register and read the logical values of the 32 external connections. If a
connection has been configured as an <span class=GramE>output</span> we are
effectively reading the value we have written in the corresponding DR bit. If a
connection has been configured as an <span class=GramE>input</span> then we are
directly reading whatever value has been placed on the connection from the
outside world (for example from the thermostat).</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Example: <span class=GramE>Let’s us</span> now write the
program that reads the thermostat and controls the heating fan. We will assume
that the thermostat is connected to <span class=SpellE>bit</span> 0 of PIT 1
(which should be configured as an input) whereas the fan is connected to bit 2
(which should be configured as an output). The thermostat outputs 0 when it’s
cold and we need to turn the fan on, otherwise it outputs 0. </p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>So:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D0 is connected to the
thermostat’s <span class=GramE>output</span></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D3 is connected to the
heat fan <span class=GramE>motor</span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><a name="OLE_LINK2"></a><a name="OLE_LINK1"></a><span
style='mso-bookmark:OLE_LINK2'>PIT1_BASE&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>    </span><span class=SpellE><span class=GramE>equ</span></span><span
class=GramE>,&nbsp; 0</span>xFF200060</p>

<p class=MsoPlainText>PIT_DR_OFFSET&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE><span
class=GramE>equ</span></span><span class=GramE>,&nbsp; 0</span>x0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
# So, DR is at PIT1_BASE + PIT_DR_OFFSET</p>

<p class=MsoPlainText>PIT_DIR_OFFSET&nbsp;&nbsp;&nbsp; <span class=SpellE><span
class=GramE>equ</span></span><span class=GramE>,&nbsp; 0</span>x4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
# and, DIR at PIT1_BASE + PIT_DIR_OFFSET</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .text </p>

<p class=MsoPlainText>heat:</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>movia</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
r9, PIT1_BASE</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>addi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
r8, r0, 4</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>stwio</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
r8, PIT_DIR_OFFSET(r9<span class=GramE>)&nbsp; #</span> configure all pins but
D3 as inputs</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>stwio</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
r0, PIT_DR_OFFSET(r9)&nbsp;&nbsp; # turn off the <span class=GramE>motor</span></p>

<p class=MsoPlainText>fever:</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>ldwio</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
PIT_DR_OFFSET(r9), r8&nbsp;&nbsp; # read all <span class=GramE>pins</span></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>andi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
r8, r8,
0x1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #
mask out all but D0</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>beq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
r8, r8, fanon&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # if
zero, then it’s cold turn the fan on</p>

<p class=MsoPlainText><span class=SpellE>fanoff</span>:</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>stwio</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
r0, PIT_DR_OFFSET(r9)&nbsp;&nbsp; # turn fan off or keep it <span class=GramE>off</span></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>br</span>
fever</p>

<p class=MsoPlainText>fanon:</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>addi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
r8, 4</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>stwio</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
r8, PIT_DR_OFFSET(r9)&nbsp;&nbsp; # turn fan on or keep it on</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>br</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
fever</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>In order not to forget that C provides us with most of
the functionality that assembly does, here’s how the <span class=GramE>aforementioned
code</span> can also be written directly in C:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>#define&nbsp;&nbsp;&nbsp;&nbsp; DR&nbsp;<span
class=GramE>&nbsp;&nbsp; (</span>(volatile unsigned int *) 0xFF200060)</p>

<p class=MsoPlainText>#define&nbsp;&nbsp;&nbsp;&nbsp; DIR<span class=GramE>&nbsp;&nbsp;
(</span>(volatile unsigned int *) 0xFF200064)</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>void</p>

<p class=MsoPlainText>heat (void)</p>

<p class=MsoPlainText>{</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; unsigned int <span
class=GramE>t;</span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *DIR = <span class=GramE>0x4;</span></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *DR = <span class=GramE>0x0;</span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while (1)</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span lang=FR
style='mso-ansi-language:FR'>{<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=FR style='mso-ansi-language:FR'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span class=GramE>t</span> = *DIR;<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=FR style='mso-ansi-language:FR'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span class=GramE>if</span> (t &amp; 0x1) <o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in;text-indent:.5in'><span lang=FR
style='mso-ansi-language:FR'>*DR = 0x<span class=GramE>0;</span><o:p></o:p></span></p>

<p class=MsoPlainText><span lang=FR style='mso-ansi-language:FR'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>else *DR = <span class=GramE>0x4;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>

<p class=MsoPlainText>}</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>So, while programming <span class=GramE>try</span> to
avoid using assembly as much as possible. In most cases this will be possible.
However, there are cases where using assembly will be important and necessary
(for example, you have little control of how the compiler translates a piece of
C code, hence it may use inefficient instruction sequences, moreover, since the
compiler does not have an understanding of device semantics – programming model
– it may use instruction sequences that have unexpected behavior such as
accessing the same device register multiple times).</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>A cleaner/easier to read way of implementing the code in
C uses a structure declaration for the device:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>struct <span class=SpellE>PIT_t</span> {</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; volatile unsigned
int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=GramE>DR;</span></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; volatile unsigned
int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=GramE>DIR;</span></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>struct <span class=SpellE>PIT_t</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
*<span class=SpellE>pitp</span> = ((struct <span class=SpellE>PIT_t</span> *) <span
style='color:red'>0xFF200060</span>)</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>void </p>

<p class=MsoPlainText>heat (void)</p>

<p class=MsoPlainText>{</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; unsigned int <span
class=GramE>t;</span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>pitp</span>-&gt;DIR
= <span class=GramE>0x4;</span></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>pitp</span>-&gt;DR
= <span class=GramE>0x0;</span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while (1)</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
t = <span class=SpellE>pitp</span>-&gt;<span class=GramE><b style='mso-bidi-font-weight:
normal'><span style='color:red'>DR</span></b>;</span></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
if (t &amp; 0x1)</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span class=SpellE>pitp</span>-&gt;DR = <span class=GramE>0x0;</span></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span class=GramE>else&nbsp; <span class=SpellE>pitp</span></span>-&gt;DR =
0x4;</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>

<p class=MsoPlainText>}</p>

<p class=MsoPlainText>In this code we exploit the fact that the structure
elements are laid out in memory one after the one. So, the DR element appears
first, occupying four bytes. Immediately, after it is DIR. This style is easier
to maintain and exposes the true structure of the device. We can now use the
structure to refer to the other PIT devices easily. Otherwise, we would have to
write the addresses of each register explicitly every time. With the structures
we only need to write the base address of each device. This style is easier to
maintain also. In the documentation for the NIOS II system we use, you will see
that the PIT has a couple more registers. We can expand the structure
definition once to include these registers without having to change the code
much.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b><span style='font-size:12.0pt'>Another Example –
Debouncing<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><o:p>&nbsp;</o:p></b></p>

<p class=MsoPlainText>As an additional example let us consider what happens
when the thermostat uses a mechanical arrangement where metal contacts touch to
report a logical 1. Whenever metal contacts are used there is a short period of
time where they bounce repeatedly whenever the switch changes state. <span
class=GramE>So</span> for a short period of time what we will observe at
thermostat’s output will be a series of alternating 0’s and 1’s. The NIOS II is
much faster in processing instructions hence the above code will turn on and
off the fan several times while the thermostat changes state.&nbsp; We can
revise our program to reduce this or even avoid it completely. This is
typically called debouncing. Here’s one way of achieving this: Rather than
reading the DR once (taking a single sample of the input’s state) we read it
several times counting how many times it was 1. If we took N samples and the
number of those samples <span class=GramE>that</span> was one is greater than
N/2 then we can assume that the value read is 1 otherwise we can assume it is a
zero. Here’s the code:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>PIT1_BASE&nbsp;&nbsp;&nbsp;&nbsp; <span style='mso-tab-count:
1'>    </span><span class=SpellE><span class=GramE>equ</span></span><span
class=GramE>,&nbsp; 0</span>xFF200064</p>

<p class=MsoPlainText>PIT_DR_OFFSET&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE><span
class=GramE>equ</span></span><span class=GramE>,&nbsp; 0</span>x0&nbsp;&nbsp;</p>

<p class=MsoPlainText>PIT_DIR_OFFSET&nbsp;&nbsp;&nbsp; <span class=SpellE><span
class=GramE>equ</span></span><span class=GramE>,&nbsp; 0</span>x4&nbsp;</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .text </p>

<p class=MsoPlainText>heat:</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>movia</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
r9, PIT1_BASE</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>addi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
r8, r0, 4</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>stwio</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
r8, PIT_DIR_OFFSET(r9<span class=GramE>)&nbsp; #</span> configure all pins but
D3 as inputs, D3 controls the fan motor</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>stwio</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
r0, PIT_DR_OFFSET(r9)&nbsp;&nbsp; # turn off the <span class=GramE>motor</span></p>

<p class=MsoPlainText>fever:</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>addi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
r10, r0, 1000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #
we’ll be taking <span class=GramE>a 1000 samples</span> in r11</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
add&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; r11, r0,
r0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #
r11 = 0</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>sampling:</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>ldwio</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='color:red'>r8, PIT_DR_OFFSET(r9)&nbsp;</span>&nbsp; # read all <span
class=GramE>pins</span></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>andi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
r8, r8,
0x1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #
mask out all but D0, DO is the <span class=GramE>thermostat</span></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
add&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; r11, r11,
r8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # r11 =
r11 + bit 0 of DR, or <span class=SpellE>equivalenty</span> if (D0 == 1) r11 =
r11 +1</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>subi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
r10, r10,
1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # r10
= r10 – 1, one fewer sample needed</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>bne</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
r10, r0, sampling&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # more samples <span
class=GramE>needed</span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>addi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
r10, r10, 500&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # 500
is the <span class=GramE>threshold</span></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>bgt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
r11, r10, fanon&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # if more than <span
class=GramE>a 500 ones</span> turn the fan on</p>

<p class=MsoPlainText><span class=SpellE>fanoff</span>:</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>stwio</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
r0, PIT_DR_OFFSET(r9)&nbsp;&nbsp; # turn fan off or keep it <span class=GramE>off</span></p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>br</span>
fever</p>

<p class=MsoPlainText>fanon:</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>addi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
r8, 4</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>stwio</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
r8, PIT_DR_OFFSET(r9)&nbsp;&nbsp; # turn fan on or keep it on\</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class=SpellE>br</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
fever</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><br>
Please note that I have not tested this code on the DE2 so, using 1000 may not
be the best possible choice or even a good one.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b><span style='font-size:12.0pt'>The PIT Implementation<o:p></o:p></span></b></p>

<p class=MsoPlainText><b><o:p>&nbsp;</o:p></b></p>

<p class=MsoPlainText><b>The example in this section shows a PIT with 8
external connections. Its DR register appears at location </b><b
style='mso-bidi-font-weight:normal'>0xFF1110 and its DIR register at location
0xFF1114. From this description you should be able to make the necessary
changes to create a 32-bit PIT at the addresses used on our system.<o:p></o:p></b></p>

<p class=MsoPlainText><b><o:p>&nbsp;</o:p></b></p>

<p class=MsoPlainText>Having seen how to program the PIT we can now discuss one
implementation. This is not necessarily how it is implemented on the DE2. At
the physical level the PIT presents the following signals:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in'>Data: a set
of 8 wires that are used for supplying the value to written to registers DIR or
DR, or to read the value from the DR. These signals can be used as input or as
output as explained subsequently.</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in'>A DIR write
signal: When this is 1 the value in the Data is written into the <span
class=GramE>DDR</span><o:p></o:p></p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in'><st1:street w:st="on"><st1:address
w:st="on">A DR</st1:address></st1:street> write signal: When this is 1 the
value in the Data is written into the <span class=GramE>DR</span><o:p></o:p></p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in'><st1:street w:st="on"><st1:address
w:st="on">A DR</st1:address></st1:street> read signal: When this is 1 the Data
signals are placed in output mode and their take the values that currently
appear on the external port connections<o:p></o:p></p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in'><st1:placename w:st="on"><st1:place
w:st="on">External</st1:place></st1:placename> <st1:placetype w:st="on">Port</st1:placetype>:
a set of 8 wires that provide the external connections.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>What appears to software as a single register DR is
implemented using separate elements for input and output. The DRO latch
implements the output portion, while a tri-state buffer is used for the input
portion. Here’s the diagram of one PIT bit:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="Picture_x0020_2" o:spid="_x0000_i1029" type="#_x0000_t75" alt="image004"
 style='width:5in;height:270pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="l15.1-introduction-to-IO-the-PIT_files/image008.gif"
  o:title="image004"/>
</v:shape><![endif]--><![if !vml]><img width=480 height=360
src="l15.1-introduction-to-IO-the-PIT_files/image008.gif" alt=image004 v:shapes="Picture_x0020_2"><![endif]></span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>The DRO and DIR boxes are latches. We can change their
value using the Data and Write signals. The DIR latch output drives a tri-state
driver whose output is connected to the external connection. If DIR is 1 then
the tri-state buffer behaves like a buffer and passes the value of the DRO
latch to the external connection. If DIR is 0 then the tri-state buffer is
placed in the off state which can be thought as an open switch (no connection).
In this case, an external source will determine what the value is on the
external connection wire. The resistor is there to help when DRO wants to drive
a 1 (high voltage) since the technology used is not very “strong” when driving
a one. The <span class=SpellE>registor</span> also sets the external connection
to 1 when no one is driving it.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>If DR Read becomes 1 then the upper tri-state buffer is
activated and passes the value on the external connection to the data wire.
What we have described is just one of the 8 slices used by the PIT. The 8
slices are connected together so that they share the Write and Read lines and
so that their data lines collectively form the 8-bit data interface of the PIT.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>To connect the PIT to the NIOS II processor we need to
first explain what is the physical memory interface. This discussion follows.
We do not discuss the exact implementation of NIOS II. Instead we present an
interface that is simple enough to allow us to focus on the fundamentals.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b>Memory<o:p></o:p></b></p>

<p class=MsoPlainText><b><o:p>&nbsp;</o:p></b></p>

<p class=MsoPlainText>------------------------------------------------------------------------------------</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>And in order to not forget that we eventually we will be
talking about actual implementations let’s see how a typical memory interface
will look at the physical level. This exercise will allow us to see how we can
use the binary system to encode quantities other than numbers.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>So, let’s start first with the vocabulary we need to be
able to talk. This includes the operations and their arguments. Our goal is
here to determine how many signals (i.e., bits) we will need to be able to
specific these operations. We have the following operations:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in'><span
class=SpellE>Load.DataType</span> Address</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in'><span
class=SpellE>Store.DataType</span> Data, Address</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Where <span class=SpellE>DataType</span> can be any of
the following three: byte, word or long-word. Address is 24 bits for 64k. And
Data can be 8, 16 or 32 bits.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>These requirements can be stated as follows:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in'>Two
operations: load or store</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in'>Three data
types: byte, half-word or word</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in'>One address
of 32 bits</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in'>One data
value of at *most* 32 bits for specifying the value to write for stores</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in'>One data
value of at *most* 32 bits for memory to returns the value for loads</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in'>We also need
to be able to say that we do not want to read or write from/to memory, i.e., do
nothing</p>

<p class=MsoPlainText style='margin-left:.25in'><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>For 1 it’s enough to use a single signal which we will
call R/W’. When R/W’ = 1 then we want to perform a load, while when R/W’ = 0.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>For 2, it’s enough to use two signals. Let’s call them
collectively DW and use the following encoding (others possible):</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DW | Data Type</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp; ----------------</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 00 | byte</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 01 | half-word</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10 | not used</p>

<p class=MsoPlainText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 11 | long-word</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>For 3 and 4 we need 32 signals for each (or we could
multiplex the same wires).</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Finally for 5 we need a master-enable signal ME. When ME
= 0 memory ignores all other signals. When ME = 1 then memory looks at the
other signals and responds accordingly.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Besides being able to say to memory “do noting” ME plays
another important role. In the physical world it takes time for us to setup
coherent values on all signals. For example, assume we want to perform in
sequence a STORE.BYTE 0x10, 0X000000 and a STORE.BYTE 0x01, 0xffffff. It is
practically impossible to change all signals instantaneously. So, in going from
address 0x000000 to 0xffffff all possible binary numbers may temporarily appear
(because different signals may change at different rates). Without the ME, the
memory could get confused and misinterpret the second store. With ME, we can <span
class=SpellE>se</span> ME to zero in between the two stores, wait sufficient
time for the second store values to appear on the data and address signals and
then set ME=1. This way memory remains oblivious to temporarily inconsistent
values. </p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b>Connecting the PIT to the Memory Interface<o:p></o:p></b></p>

<p class=MsoPlainText><b>----------------------------------------------------------------------------------------------------<o:p></o:p></b></p>

<p class=MsoPlainText><b><o:p>&nbsp;</o:p></b></p>

<p class=MsoPlainText>To connect the PIT to the memory interface described
previously, we first connect the PIT Data lines to the lower byte (8 bits) of
the memory data lines. This will allow us to access the three PIT elements
(DIR, DRO and DRI) by using load and store memory accesses. Then we need to
activate the corresponding PIT elements depending on the address accessed. We
need to detect the following combinations on the address lines: 0xFF1110, and
0xFF1114 <b style='mso-bidi-font-weight:normal'>(this assumes that the PIT is
at these addresses – it’s from an older version of the hardware – please
substitute the new addresses for these 0xFF200060 and 0xFF200064)</b>. In the
simplest to describe implementation we use a 32 input AND gate for each of
those. Let’s see how we decode the address 0x00FF1110. Using a 32-bit input
here’s how we can detect this combination on the address lines: write the
number in binary. For every digit that is 1 connect the corresponding wire
directly to the AND gate. For every digit that is 0, connect the corresponding
wire first to inverter and then connect the output of the inverted to the AND
gate.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Here’s the ADDRESS DECODING part for DR, it generate the
signal <span class=SpellE>DRenable</span> that tells us that the processor is
either reading or writing DR:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="Picture_x0020_8" o:spid="_x0000_i1028" type="#_x0000_t75" style='width:300pt;
 height:225pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="l15.1-introduction-to-IO-the-PIT_files/image009.png"
  o:title=""/>
</v:shape><![endif]--><![if !vml]><img width=400 height=300
src="l15.1-introduction-to-IO-the-PIT_files/image012.jpg" v:shapes="Picture_x0020_8"><![endif]></span></p>

<p class=MsoPlainText><span class=SpellE>DRenable</span> can now be combined
with R/W’ and ME to generate the <span class=SpellE>DRread</span> and <span
class=SpellE>DRwrite</span> signals:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="Picture_x0020_18" o:spid="_x0000_i1027" type="#_x0000_t75" style='width:258pt;
 height:135pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="l15.1-introduction-to-IO-the-PIT_files/image011.png"
  o:title=""/>
</v:shape><![endif]--><![if !vml]><img width=344 height=180
src="l15.1-introduction-to-IO-the-PIT_files/image014.jpg" v:shapes="Picture_x0020_18"><![endif]></span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Here’s the address decoding and signal generation circuit
for <span class=SpellE>DIRwrite</span>:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="Picture_x0020_22" o:spid="_x0000_i1026" type="#_x0000_t75" style='width:300pt;
 height:225pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="l15.1-introduction-to-IO-the-PIT_files/image013.png"
  o:title=""/>
</v:shape><![endif]--><![if !vml]><img width=400 height=300
src="l15.1-introduction-to-IO-the-PIT_files/image016.jpg" v:shapes="Picture_x0020_22"><![endif]></span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>In total we used two three 32-input AND gates and three
3-input AND gates. Each of the two 32-input AND gates is connected to all 32
address signals. By using inverters appropriately we can detect that the
address being accessed is one of those mapped to DR, and DIR. We start by
looking at the binary representation of these addresses and put an inverter for
those address bits that are zero in the pattern we are interested in. After
detecting the address, we then used a 3-input AND gate to detect accordingly
whether an access is being made (ME == 1 – ME is Master Enable), and whether it
is a read or a write. </p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>This implementation is easy to understand, however, it’s
not necessarily the most efficient. This topic is beyond the scope of this
lecture, however, you are encouraged to think of ways of reducing the number of
components needed to do address decoding.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>&nbsp;</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Here’s the complete design:</p>

<p class=MsoPlainText><span style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="Picture_x0020_26" o:spid="_x0000_i1025" type="#_x0000_t75" style='width:734.25pt;
 height:545.25pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="l15.1-introduction-to-IO-the-PIT_files/image015.png"
  o:title=""/>
</v:shape><![endif]--><![if !vml]><img width=979 height=727
src="l15.1-introduction-to-IO-the-PIT_files/image024.jpg" v:shapes="Picture_x0020_26"><![endif]></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'>Each
bit cell (there are eight of them) is as shown earlier). The boxes labeled
“match some hex value” are the 32-bit input AND gates we described earlier.<o:p></o:p></span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

</div>

</body>

</html>
