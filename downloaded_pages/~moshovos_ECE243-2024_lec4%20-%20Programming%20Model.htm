<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 14">
<meta name=Originator content="Microsoft Word 14">
<link rel=File-List href="lec4%20-%20Programming%20Model_files/filelist.xml">
<link rel=Edit-Time-Data
href="lec4%20-%20Programming%20Model_files/editdata.mso">
<!--[if !mso]>
<style>
v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style>
<![endif]-->
<title>Lecture 2</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Name</o:Author>
  <o:Template>Normal</o:Template>
  <o:LastAuthor>bongo</o:LastAuthor>
  <o:Revision>39</o:Revision>
  <o:TotalTime>468</o:TotalTime>
  <o:LastPrinted>2006-01-16T14:43:00Z</o:LastPrinted>
  <o:Created>2007-11-17T17:56:00Z</o:Created>
  <o:LastSaved>2013-02-04T14:31:00Z</o:LastSaved>
  <o:Pages>6</o:Pages>
  <o:Words>3469</o:Words>
  <o:Characters>19779</o:Characters>
  <o:Company>Organization</o:Company>
  <o:Lines>164</o:Lines>
  <o:Paragraphs>46</o:Paragraphs>
  <o:CharactersWithSpaces>23202</o:CharactersWithSpaces>
  <o:Version>14.00</o:Version>
 </o:DocumentProperties>
</xml><![endif]-->
<link rel=dataStoreItem href="lec4%20-%20Programming%20Model_files/item0011.xml"
target="lec4%20-%20Programming%20Model_files/props012.xml">
<link rel=themeData href="lec4%20-%20Programming%20Model_files/themedata.thmx">
<link rel=colorSchemeMapping
href="lec4%20-%20Programming%20Model_files/colorschememapping.xml">
<!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:Zoom>BestFit</w:Zoom>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:TrackMoves>false</w:TrackMoves>
  <w:TrackFormatting/>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:DoNotPromoteQF/>
  <w:LidThemeOther>EN-US</w:LidThemeOther>
  <w:LidThemeAsian>X-NONE</w:LidThemeAsian>
  <w:LidThemeComplexScript>X-NONE</w:LidThemeComplexScript>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
   <w:SplitPgBreakAndParaMark/>
   <w:DontVertAlignCellWithSp/>
   <w:DontBreakConstrainedForcedTables/>
   <w:DontVertAlignInTxbx/>
   <w:Word11KerningPairs/>
   <w:CachedColBalance/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
  <m:mathPr>
   <m:mathFont m:val="Cambria Math"/>
   <m:brkBin m:val="before"/>
   <m:brkBinSub m:val="&#45;-"/>
   <m:smallFrac m:val="off"/>
   <m:dispDef/>
   <m:lMargin m:val="0"/>
   <m:rMargin m:val="0"/>
   <m:defJc m:val="centerGroup"/>
   <m:wrapIndent m:val="1440"/>
   <m:intLim m:val="subSup"/>
   <m:naryLim m:val="undOvr"/>
  </m:mathPr></w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" DefUnhideWhenUsed="false"
  DefSemiHidden="false" DefQFormat="false" LatentStyleCount="267">
  <w:LsdException Locked="false" QFormat="true" Name="Normal"/>
  <w:LsdException Locked="false" QFormat="true" Name="heading 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 4"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 5"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 6"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 7"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 8"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="heading 9"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   QFormat="true" Name="caption"/>
  <w:LsdException Locked="false" QFormat="true" Name="Title"/>
  <w:LsdException Locked="false" Priority="1" Name="Default Paragraph Font"/>
  <w:LsdException Locked="false" QFormat="true" Name="Subtitle"/>
  <w:LsdException Locked="false" QFormat="true" Name="Strong"/>
  <w:LsdException Locked="false" QFormat="true" Name="Emphasis"/>
  <w:LsdException Locked="false" Priority="99" Name="No List"/>
  <w:LsdException Locked="false" Priority="99" SemiHidden="true"
   Name="Placeholder Text"/>
  <w:LsdException Locked="false" Priority="1" QFormat="true" Name="No Spacing"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 1"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="99" SemiHidden="true" Name="Revision"/>
  <w:LsdException Locked="false" Priority="34" QFormat="true"
   Name="List Paragraph"/>
  <w:LsdException Locked="false" Priority="29" QFormat="true" Name="Quote"/>
  <w:LsdException Locked="false" Priority="30" QFormat="true"
   Name="Intense Quote"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 1"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 1"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 1"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 2"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 2"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 2"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 2"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 3"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 3"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 3"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 3"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 4"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 4"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 4"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 4"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 5"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 5"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 5"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 5"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 6"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 6"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 6"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 6"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="19" QFormat="true"
   Name="Subtle Emphasis"/>
  <w:LsdException Locked="false" Priority="21" QFormat="true"
   Name="Intense Emphasis"/>
  <w:LsdException Locked="false" Priority="31" QFormat="true"
   Name="Subtle Reference"/>
  <w:LsdException Locked="false" Priority="32" QFormat="true"
   Name="Intense Reference"/>
  <w:LsdException Locked="false" Priority="33" QFormat="true" Name="Book Title"/>
  <w:LsdException Locked="false" Priority="37" SemiHidden="true"
   UnhideWhenUsed="true" Name="Bibliography"/>
  <w:LsdException Locked="false" Priority="39" SemiHidden="true"
   UnhideWhenUsed="true" QFormat="true" Name="TOC Heading"/>
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;
	mso-font-charset:2;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:0 268435456 0 0 -2147483648 0;}
@font-face
	{font-family:Batang;
	panose-1:2 3 6 0 0 1 1 1 1 1;
	mso-font-alt:\BC14\D0D5;
	mso-font-charset:129;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:-1342176593 1775729915 48 0 524447 0;}
@font-face
	{font-family:Batang;
	panose-1:2 3 6 0 0 1 1 1 1 1;
	mso-font-alt:\BC14\D0D5;
	mso-font-charset:129;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:-1342176593 1775729915 48 0 524447 0;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:-520081665 -1073717157 41 0 66047 0;}
@font-face
	{font-family:"\@Batang";
	panose-1:2 3 6 0 0 1 1 1 1 1;
	mso-font-charset:129;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:-1342176593 1775729915 48 0 524447 0;}
@font-face
	{font-family:Consolas;
	panose-1:2 11 6 9 2 2 4 3 2 4;
	mso-font-charset:0;
	mso-generic-font-family:modern;
	mso-font-pitch:fixed;
	mso-font-signature:-520092929 1073806591 9 0 415 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";
	mso-fareast-font-family:Batang;}
p.MsoPlainText, li.MsoPlainText, div.MsoPlainText
	{mso-style-unhide:no;
	mso-style-link:"Plain Text Char";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:Batang;}
p.MsoAcetate, li.MsoAcetate, div.MsoAcetate
	{mso-style-unhide:no;
	mso-style-link:"Balloon Text Char";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:8.0pt;
	font-family:"Tahoma","sans-serif";
	mso-fareast-font-family:Batang;}
span.PlainTextChar
	{mso-style-name:"Plain Text Char";
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"Plain Text";
	mso-ansi-font-size:10.5pt;
	mso-bidi-font-size:10.5pt;
	font-family:Consolas;
	mso-ascii-font-family:Consolas;
	mso-fareast-font-family:Batang;
	mso-hansi-font-family:Consolas;
	mso-bidi-font-family:Consolas;}
span.BalloonTextChar
	{mso-style-name:"Balloon Text Char";
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"Balloon Text";
	mso-ansi-font-size:8.0pt;
	mso-bidi-font-size:8.0pt;
	font-family:"Tahoma","sans-serif";
	mso-ascii-font-family:Tahoma;
	mso-fareast-font-family:Batang;
	mso-hansi-font-family:Tahoma;
	mso-bidi-font-family:Tahoma;}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
.MsoChpDefault
	{mso-style-type:export-only;
	mso-default-props:yes;
	font-size:10.0pt;
	mso-ansi-font-size:10.0pt;
	mso-bidi-font-size:10.0pt;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 65.95pt 1.0in 65.95pt;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 @list l0
	{mso-list-id:240453154;
	mso-list-type:hybrid;
	mso-list-template-ids:768895694 805985876 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l0:level1
	{mso-level-tab-stop:1.25in;
	mso-level-number-position:left;
	margin-left:1.25in;
	text-indent:-.25in;}
@list l0:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1
	{mso-list-id:290092470;
	mso-list-type:hybrid;
	mso-list-template-ids:188360828 -1645321360 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l1:level1
	{mso-level-tab-stop:.75in;
	mso-level-number-position:left;
	margin-left:.75in;
	text-indent:-.25in;}
@list l1:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2
	{mso-list-id:395126269;
	mso-list-type:hybrid;
	mso-list-template-ids:-905660896 345000330 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l2:level1
	{mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3
	{mso-list-id:415178673;
	mso-list-type:hybrid;
	mso-list-template-ids:-1018284230 -1342683862 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l3:level1
	{mso-level-tab-stop:1.25in;
	mso-level-number-position:left;
	margin-left:1.25in;
	text-indent:-.25in;}
@list l3:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4
	{mso-list-id:1147942443;
	mso-list-type:hybrid;
	mso-list-template-ids:-1081823428 -1484462722 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l4:level1
	{mso-level-tab-stop:1.25in;
	mso-level-number-position:left;
	margin-left:1.25in;
	text-indent:-.25in;}
@list l4:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l5
	{mso-list-id:1375891089;
	mso-list-type:hybrid;
	mso-list-template-ids:-2033705158 1611315534 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l5:level1
	{mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l5:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l5:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l5:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l5:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l5:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l5:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l5:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l5:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l6
	{mso-list-id:1753502991;
	mso-list-type:hybrid;
	mso-list-template-ids:1462771924 -1645321360 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l6:level1
	{mso-level-tab-stop:.75in;
	mso-level-number-position:left;
	margin-left:.75in;
	text-indent:-.25in;}
@list l6:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l6:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l6:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l6:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l6:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l6:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l6:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l6:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman","serif";}
table.MsoTableGrid
	{mso-style-name:"Table Grid";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-unhide:no;
	border:solid windowtext 1.0pt;
	mso-border-alt:solid windowtext .5pt;
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-border-insideh:.5pt solid windowtext;
	mso-border-insidev:.5pt solid windowtext;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman","serif";}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="1026"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body lang=EN-US style='tab-interval:.5in'>

<div class=WordSection1>

<p class=MsoPlainText>Andreas <span class=SpellE>Moshovos</span></p>

<p class=MsoPlainText>Fall 2007, Updated Fall 2008, <span class=GramE>Winter</span>
2010, Winter 2012</p>

<p class=MsoPlainText><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:12.0pt'>Introduction to the NIOS II programming model<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoPlainText>As noted in the previous lecture we will be talking about
how NIOS II is supposed to behave. This is the <b style='mso-bidi-font-weight:
normal'>programming model</b>, or in other words the information provided here
is a set of rules that should be used to interpret the machine’s behavior. A
correctly implemented NIOS II must abide by all these rules. That is, a
programmer can view this model as a contract between them and the designer. If
the programmer follows these rules then their program must behave as expected
on any implementation of NIOS II. From the designer’s point of view this is the
minimum set of guarantees that they should provide. They are free to deviate on
anything else but an implementation that breaks the programming model is not a
correct implementation and should not be called NIOS II. This model is also
typically called the <b style='mso-bidi-font-weight:normal'>Instruction Set
Architecture. </b>We will return to this term later on.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:12.0pt'>General Notes about Computer Structure and Operation:<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoPlainText>As we discussed earlier, a simplified computer in general
comprises three major parts:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;tab-stops:
list .5in'><span style='mso-fareast-font-family:"Courier New"'>1.</span><span
style='font-size:7.0pt;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Courier New"'>&nbsp;&nbsp;&nbsp; </span>The central processing unit or CPU or
processor</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;tab-stops:
list .5in'><span style='mso-fareast-font-family:"Courier New"'>2.</span><span
style='font-size:7.0pt;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Courier New"'>&nbsp;&nbsp;&nbsp; </span>Memory</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;tab-stops:
list .5in'><span style='mso-fareast-font-family:"Courier New"'>3.</span><span
style='font-size:7.0pt;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Courier New"'>&nbsp;&nbsp;&nbsp; </span>Set of I/O devices</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>We have presented the memory behavior model in the
previous lecture. We will discuss I/O devices later on. In this section of the
lectures we will be concentrating on the CPU.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>The CPU comprises two parts:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='margin-left:24.0pt;text-indent:-.25in;tab-stops:
list 24.0pt'><span style='mso-fareast-font-family:"Courier New"'>1.</span><span
style='font-size:7.0pt;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Courier New"'>&nbsp;&nbsp;&nbsp; </span>The <span class=SpellE>datapath</span></p>

<p class=MsoPlainText style='margin-left:24.0pt;text-indent:-.25in;tab-stops:
list 24.0pt'><span style='mso-fareast-font-family:"Courier New"'>2.</span><span
style='font-size:7.0pt;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Courier New"'>&nbsp;&nbsp;&nbsp; </span>The control</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>For the time being suffices to say that <span
class=SpellE><b style='mso-bidi-font-weight:normal'>datapath</b></span> is
where data is stored and manipulated whereas the <b style='mso-bidi-font-weight:
normal'>control</b> is what orchestrates the <span class=SpellE>datapath</span>
to perform all necessary actions. This information is provided just for
reference for the time being, we will return to this issue when we discuss how to
design a CPU that works.</p>

<p class=MsoPlainText><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:12.0pt'>What a CPU does:<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoPlainText>In general terms a CPU goes through a series of steps
repeatedly. These steps are:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;tab-stops:
list .5in'><span style='mso-fareast-font-family:"Courier New"'>1.</span><span
style='font-size:7.0pt;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Courier New"'>&nbsp;&nbsp;&nbsp; </span>Get next instruction</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;tab-stops:
list .5in'><span style='mso-fareast-font-family:"Courier New"'>2.</span><span
style='font-size:7.0pt;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Courier New"'>&nbsp;&nbsp;&nbsp; </span>Decode (i.e., interpret its meaning)
the instruction</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;tab-stops:
list .5in'><span style='mso-fareast-font-family:"Courier New"'>3.</span><span
style='font-size:7.0pt;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Courier New"'>&nbsp;&nbsp;&nbsp; </span>Read Source Operands</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;tab-stops:
list .5in'><span style='mso-fareast-font-family:"Courier New"'>4.</span><span
style='font-size:7.0pt;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Courier New"'>&nbsp;&nbsp;&nbsp; </span>Perform Operation (e.g., add two
numbers)</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;tab-stops:
list .5in'><span style='mso-fareast-font-family:"Courier New"'>5.</span><span
style='font-size:7.0pt;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Courier New"'>&nbsp;&nbsp;&nbsp; </span>Write Result</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;tab-stops:
list .5in'><span style='mso-fareast-font-family:"Courier New"'>6.</span><span
style='font-size:7.0pt;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Courier New"'>&nbsp;&nbsp;&nbsp; </span>Determine which is the next
instruction</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>All aforementioned steps together are called <i
style='mso-bidi-font-style:normal'>instruction execution. </i>Depending on the
instruction some steps may be optional (i.e., writing a result). We will see
examples as we move along.</p>

<p class=MsoPlainText><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:12.0pt'>What is an instruction?<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoPlainText>In the previous discussion we have used the term <b
style='mso-bidi-font-weight:normal'>instruction. </b>An instruction defines an
operation that the CPU knows how to perform. For example, an instruction can be
something like “add two numbers”. Each processor has a predefined set of
instructions that it understands. The set of these instructions is part of the
programming model so it is part of the <b style='mso-bidi-font-weight:normal'><i
style='mso-bidi-font-style:normal'>instruction set architecture</i></b><i
style='mso-bidi-font-style:normal'>. <o:p></o:p></i></p>

<p class=MsoPlainText><i style='mso-bidi-font-style:normal'><o:p>&nbsp;</o:p></i></p>

<p class=MsoPlainText>In addition to the instructions the programming model includes
additional information such as where the operands of an instruction can be,
what is the address space of memory, what <span class=SpellE>datatypes</span>
are supported, etc. </p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>There is no clear rule on what should be part of the
programming model. A good design principle, however, is to include the minimum
possible set of rules that allows a programmer to reason about the machine.
Note that anything you put into the programming model becomes part of a
contract and has to be supported in <i style='mso-bidi-font-style:normal'>all </i>implementations.</p>

<p class=MsoPlainText><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:12.0pt'>The NIOS II Programming Model<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoPlainText>So, now we are ready to talk specifics and introduce the
NIOS II programming model. We are not going to be able to exhaust this topic in
a single or even in two lectures since the instructions are part of the model
and there quite a few of them. We will gradually introduce additional
instructions over a set of lectures. Much of the information we will be
discussing is also described in the “NIOS II Processor Reference Handbook”
which is available on the course website. The relevant chapter is “Chapter 3:
Programming Model”.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Let’s first describe the<b style='mso-bidi-font-weight:
normal'> memory model </b>NIOS II assumes. It comprises 2^32=4G addresses where
each address is capable of holding a single byte. Each byte is addressable,
i.e., it can be accessed separately.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Memory supports three data types: </p>

<p class=MsoPlainText style='text-indent:.5in'>1. A Byte = 8 bits.</p>

<p class=MsoPlainText style='text-indent:.5in'>2. A Half Word = 2 bytes = 16
bits. </p>

<p class=MsoPlainText style='text-indent:.5in'>3. A Word = 32-bits.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>All half-word and word accesses must be aligned, i.e.,
their starting address is divisible by two and four respectively. NIOS II will
signal an error on unaligned accesses (will discuss what happens then later
on).</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Besides memory, NIOS II and pretty much all modern
processors have another set of storage locations that hold binary information.
These are called <b style='mso-bidi-font-weight:normal'>registers</b>. They are
much fewer registers (e.g., less than 64 are typical) than memory locations and
for this they are much faster to access. In semiconductors, the larger a memory
structure, the slower it becomes. At the time of this writing common memory
devices have a latency of 50ns whereas a high-end register file with 32
registers has a latency of 300-500ps – of course, the implementation of NIOS II
we are using is slower. Registers use different names than memory locations. In
NIOS II there is no such thing as the “address of a register”. There is only
the “name of a register”. Recall that everything inside the computer will be
represented in binary. Register names are just a convenient way for us to refer
to specific storage elements inside NIOS II. You cannot take the address of a <span
class=GramE>register, that</span> is there is no way to calculate a result
using an instruction and then use that result to select directly which register
another instruction should use. </p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>NIOS II has the following registers:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l5 level1 lfo2;
tab-stops:list .5in'><![if !supportLists]><span style='mso-fareast-font-family:
"Courier New"'><span style='mso-list:Ignore'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>32 general purpose registers. Each holds 32
bits. These are used for data manipulation.</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l5 level1 lfo2;
tab-stops:list .5in'><![if !supportLists]><span style='mso-fareast-font-family:
"Courier New"'><span style='mso-list:Ignore'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>Six control registers. Each holds 32 bits. These
are used to control how NIOS II reacts to exceptions (e.g., unaligned memory
access) and external requests for service (e.g., a button is pressed on the
board). We will be explaining these issues in detail when we talk about
interrupt handling.</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l5 level1 lfo2;
tab-stops:list .5in'><![if !supportLists]><span style='mso-fareast-font-family:
"Courier New"'><span style='mso-list:Ignore'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>A Program Counter register. It holds the
address, or “points to”, of the instruction under execution. “Instruction
Pointer” would have been a much better name for this register.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>For the time being suffices to say that:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;tab-stops:
list .5in'><span style='mso-fareast-font-family:"Courier New"'>1.</span><span
style='font-size:7.0pt;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Courier New"'>&nbsp;&nbsp;&nbsp; </span>The PC is used for <b
style='mso-bidi-font-weight:normal'>instruction sequencing</b>. That it is used
to identify the location (i.e., address in memory) of the instruction being
execute and to perform step 6 of the CPU loop (determine next instruction).</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;tab-stops:
list .5in'><span style='mso-fareast-font-family:"Courier New"'>3.</span><span
style='font-size:7.0pt;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Courier New"'>&nbsp;&nbsp;&nbsp; </span>The control registers control I/O
device interactions. We will explain this later on.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>The names of the general purpose registers are r0 through
r31. Register r0 is special in that is always holds the value 0. You can use it
as source and as a destination. If used as a destination it will silently
ignore any attempt to change its value from 0. There are two reasons why r0 is
set to zero. First, it turns out from experience that often enough many
operations are done with zero being one of the operands. Second, having zero as
<span class=GramE>an operand allow</span> us to synthesize operations using
others. For example, A = B can be implemented as A = B + 0. This way we do not
need two operations one for simple assignment (often called a MOVE) and one for
addition. Just addition is good enough.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>By convention some registers have pre-specified uses.
This means that while anyone is free to use them any way they like (there are
no restrictions imposed by the hardware), if you want your software to
inter-operate with software written by others it is important to abide by these
conventions. </p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>The following table lists these uses (you are not
expected to understand every description at this point – most will be
understood later on when we talk about how function calls are implemented):</p>

<p class=MsoPlainText><span style='mso-no-proof:yes'><!--[if gte vml 1]><v:shapetype
 id="_x0000_t75" coordsize="21600,21600" o:spt="75" o:preferrelative="t"
 path="m@4@5l@4@11@9@11@9@5xe" filled="f" stroked="f">
 <v:stroke joinstyle="miter"/>
 <v:formulas>
  <v:f eqn="if lineDrawn pixelLineWidth 0"/>
  <v:f eqn="sum @0 1 0"/>
  <v:f eqn="sum 0 0 @1"/>
  <v:f eqn="prod @2 1 2"/>
  <v:f eqn="prod @3 21600 pixelWidth"/>
  <v:f eqn="prod @3 21600 pixelHeight"/>
  <v:f eqn="sum @0 0 1"/>
  <v:f eqn="prod @6 1 2"/>
  <v:f eqn="prod @7 21600 pixelWidth"/>
  <v:f eqn="sum @8 21600 0"/>
  <v:f eqn="prod @7 21600 pixelHeight"/>
  <v:f eqn="sum @10 21600 0"/>
 </v:formulas>
 <v:path o:extrusionok="f" gradientshapeok="t" o:connecttype="rect"/>
 <o:lock v:ext="edit" aspectratio="t"/>
</v:shapetype><v:shape id="Picture_x0020_1" o:spid="_x0000_i1027" type="#_x0000_t75"
 style='width:488.25pt;height:345pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="lec4%20-%20Programming%20Model_files/image002.wmz" o:title=""/>
</v:shape><![endif]--><![if !vml]><img width=651 height=460
src="lec4%20-%20Programming%20Model_files/image006.gif" v:shapes="Picture_x0020_1"><![endif]></span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'>For your assembly
programs it is safe to use registers r8 through r23. </b>As shown on the table
some register have aliases. For example, register “r0” and register “zero”
refer to the same register. For the time being avoid using all but registers r8
through r23. </p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Note that there is nothing inside the registers that
signifies what the binary quantify they are holding is used for. For example:
Are the contents of register r9 a number used for addition or an address used to
access memory? It is us that decide what these quantities mean. To the computer
they are just binary quantities that can be manipulated in specific ways using
instructions. Along the same lines, there is nothing that differentiates the
contents of register as an address. Only if those contents are sent to memory
for reading or writing then they are *used* as an address.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>There is <b style='mso-bidi-font-weight:normal'>no such
thing</b> as a <b style='mso-bidi-font-weight:normal'>register address</b>.
Registers have names. They are represented as digital numbers internally, but
there is no way to take the result of an instruction and use that as the name
of a register. This is in contrast to memory where, as we will see shortly, we
can take the result of an addition or any other instruction and use that as an
address to access memory. (We talked about this earlier in the notes, but it is
a source of common confusion, hence we repeat.)</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>We will be describing how NIOS II encodes instructions
later on. For the time being, suffices to say that a NIOS II instruction is
represented as a word value in memory. That is, all NIOS II instructions are
encoded using 32-bit values. </p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'>Our first NIOS II
program<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoPlainText>As we saw before, the CPU loop amounts to executing
instructions continuously. Before explaining how this is done let’s look at a
simple program. For the time being we will not be concerned with how the
program gets represented inside the machine or how it is executed. We will
write a set of instructions and explain what the expected outcome should be.
Once this is understood we will then explain where these instructions are
stored, how they are sequenced and finally how they are represented.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Our first program will be the equivalent of the following
pseudo-C code:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='text-indent:.5in'><span class=GramE>unsigned</span>
<span class=SpellE>int</span> a = 0x00000000;</p>

<p class=MsoPlainText style='text-indent:.5in'><span class=GramE>unsigned</span>
<span class=SpellE>int</span> b = 0x00000001;</p>

<p class=MsoPlainText style='text-indent:.5in'><span class=GramE>unsigned</span>
<span class=SpellE>int</span> c = 0x00000002;</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='text-indent:.5in'>a = b + c;</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>This code adds two 32-bit variables (b and c) and places
the result into a third variable a.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>While in C there is no indication of where the values are
stored (C does not care) in a real machine the variables will have to be stored
either in memory or in registers (there is nowhere else to store them). The
compiler makes the decision on where to <i style='mso-bidi-font-style:normal'>allocate
</i>each variable (if you want to force the compiler to allocate the variables
in memory you can use the keyword “volatile” before each declaration). </p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:12.0pt'>Register Only Version<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoPlainText>Let’s first see how we can implement our simple program
assuming that the variables are in registers: <span class=GramE>a is</span> in
r9, b in r10 and c in r11.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>If we want to add the contents of r10 and r11 and place
the result into r9 we can use the following instruction:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=GramE>add</span> r9, r10, r11</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Note that this does not affect the contents of r10 or
r11. It reads the contents of r10 and r11, adds these up and then stores the
result in r9.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>In general, most NIOS II instructions take the following symbolic
form:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=GramE><b style='mso-bidi-font-weight:normal'>operation</b></span><b
style='mso-bidi-font-weight:normal'> destination, source1, source2<o:p></o:p></b></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>They instruct <span class=SpellE>nios</span> to perform:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=GramE>destination</span> = source1 <b style='mso-bidi-font-weight:normal'><u>operation</u></b>
source2</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>To complete our program we must first initialize b and c
to 0x1 and 0x2 respectively. Here’s the complete code to do that:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
lang=PT-BR style='mso-ansi-language:PT-BR'>addi<span style='mso-tab-count:1'>  </span>r9,
r0, 0x1<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><span
style='mso-tab-count:1'>      </span>addi<span style='mso-tab-count:1'>  </span>r10,
r0, 0x2<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><span
style='mso-tab-count:1'>      </span></span><span class=GramE>add</span><span
style='mso-tab-count:1'>   </span>r8, r9, r10</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>“<span class=SpellE><span class=GramE>addi</span></span>”
stands for “add immediate”. It’s the same as “add” with the only difference
that the second operand is a number.</p>

<p class=MsoPlainText>Here’s what this sequence of instructions does:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>The first instruction adds r0 and the value 0x1 and
places the result (which is 0x1) in r9.</p>

<p class=MsoPlainText>The second adds r0 and the value 0x2 and places the
result in r10.</p>

<p class=MsoPlainText>The third instruction adds r9 and r10 and places the
result (0x3) into r8.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>For the time being it is convenient to think that the
instructions perform the following actions (semantically this is what they do,
an implementation may choose to use a different, equivalent set of actions):</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><span class=GramE><b style='mso-bidi-font-weight:normal'><u>addi</u></b></span></span><b
style='mso-bidi-font-weight:normal'><u> r9, r0, 0x1<o:p></o:p></u></b></p>

<p class=MsoPlainText style='margin-left:1.25in;text-indent:-.25in;mso-list:
l4 level1 lfo4;tab-stops:list 1.25in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Read
r0</p>

<p class=MsoPlainText style='margin-left:1.25in;text-indent:-.25in;mso-list:
l4 level1 lfo4;tab-stops:list 1.25in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Add
the value read in step 1 with 0x1</p>

<p class=MsoPlainText style='margin-left:1.25in;text-indent:-.25in;mso-list:
l4 level1 lfo4;tab-stops:list 1.25in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Write
the value produced in step 2 in r9</p>

<p class=MsoPlainText style='margin-left:1.25in;text-indent:-.25in;mso-list:
l4 level1 lfo4;tab-stops:list 1.25in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>4.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Increment
the PC to the next instruction</p>

<p class=MsoPlainText style='margin-left:1.25in'><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='margin-left:.5in'><span class=SpellE><span
class=GramE><b style='mso-bidi-font-weight:normal'><u>addi</u></b></span></span><b
style='mso-bidi-font-weight:normal'><u> r10, r0, 0x2<o:p></o:p></u></b></p>

<p class=MsoPlainText style='margin-left:1.25in;text-indent:-.25in;mso-list:
l3 level1 lfo6;tab-stops:list 1.25in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Read
r0</p>

<p class=MsoPlainText style='margin-left:1.25in;text-indent:-.25in;mso-list:
l3 level1 lfo6;tab-stops:list 1.25in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Add
the value read in step 1 with 0x2</p>

<p class=MsoPlainText style='margin-left:1.25in;text-indent:-.25in;mso-list:
l3 level1 lfo6;tab-stops:list 1.25in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Write
the value produced in step 2 in r10</p>

<p class=MsoPlainText style='margin-left:1.25in;text-indent:-.25in;mso-list:
l3 level1 lfo6;tab-stops:list 1.25in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>4.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Increment
the PC to the next instruction</p>

<p class=MsoPlainText style='margin-left:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='margin-left:.5in'><span class=GramE><b
style='mso-bidi-font-weight:normal'><u>add</u></b></span><b style='mso-bidi-font-weight:
normal'><u><span style='mso-tab-count:1'>   </span>r8, r9, r10<o:p></o:p></u></b></p>

<p class=MsoPlainText style='margin-left:1.25in;text-indent:-.25in;mso-list:
l0 level1 lfo8;tab-stops:list 1.25in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Read
<span style='color:red'>r9</span></p>

<p class=MsoPlainText style='margin-left:1.25in;text-indent:-.25in;mso-list:
l0 level1 lfo8;tab-stops:list 1.25in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Read
<span style='color:red'>r10</span></p>

<p class=MsoPlainText style='margin-left:1.25in;text-indent:-.25in;mso-list:
l0 level1 lfo8;tab-stops:list 1.25in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Add
the values read in steps 1 and 2</p>

<p class=MsoPlainText style='margin-left:1.25in;text-indent:-.25in;mso-list:
l0 level1 lfo8;tab-stops:list 1.25in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>4.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Write
the value produced in step 3 in r8</p>

<p class=MsoPlainText style='margin-left:1.25in;text-indent:-.25in;mso-list:
l0 level1 lfo8;tab-stops:list 1.25in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>5.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Increment
the PC to the next instruction</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span class=GramE><b style='mso-bidi-font-weight:normal'><span
style='font-size:12.0pt'>32-bit Constants?</span></b></span><b
style='mso-bidi-font-weight:normal'><span style='font-size:12.0pt'><o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoPlainText>What if we wanted to implement the following <span
class=GramE>addition:</span></p>

<p class=MsoPlainText style='text-indent:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='text-indent:.5in'><span class=GramE>unsigned</span>
<span class=SpellE>int</span> a = 0x00000000;</p>

<p class=MsoPlainText style='text-indent:.5in'><span class=GramE>unsigned</span>
<span class=SpellE>int</span> b = 0x11223344;</p>

<p class=MsoPlainText style='text-indent:.5in'><span class=GramE>unsigned</span>
<span class=SpellE>int</span> c = 0x55667788;</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='text-indent:.5in'>a = b + c;</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Unfortunately, the number operand in “<span class=SpellE>addi</span>”
can only be 16-bits. NIOS-II first sign-extends this number to 32-bits and then
performs the addition. So, “<span class=SpellE>addi</span> r8, r9, 0x8000” is equivalent
to “r8 = r9 + 0xFFFF8000”, whereas “<span class=SpellE>addi</span> r8, r9,
0x7000” is equivalent to “r8 = r9 + 0x00007000”. The encoding of <span
class=SpellE>addi</span> in memory is as follows:<span style='color:red'><o:p></o:p></span></p>

<p class=MsoPlainText><span style='color:red;mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="Picture_x0020_2" o:spid="_x0000_i1026" type="#_x0000_t75" style='width:593.25pt;
 height:60pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="lec4%20-%20Programming%20Model_files/image008.wmz" o:title=""/>
</v:shape><![endif]--><![if !vml]><img width=791 height=80
src="lec4%20-%20Programming%20Model_files/image009.gif" v:shapes="Picture_x0020_2"><![endif]></span><span
style='color:red'><o:p></o:p></span></p>

<p class=MsoPlainText><span style='color:red'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span class=GramE>where</span> A and B are the two
register operands; B is the destination register and A is the source. Imm16
holds the 16-bit immediate field. The last 6 bits are <span class=GramE>0x04</span>
which tells NIOS II that this is an <span class=SpellE>addi</span> instruction.
</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>So, how do we go about implementing the addition in this
case? We’ll need two instructions to construct the 32-bit numbers.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Here’s how we write 0x11223344 into r9:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><span class=GramE><span lang=FR style='mso-ansi-language:FR'>movhi</span></span></span><span
lang=FR style='mso-ansi-language:FR'> r9, 0x1122<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=FR style='mso-ansi-language:FR'><span
style='mso-tab-count:1'>      </span><span class=SpellE><span class=GramE>ori</span></span><span
style='mso-spacerun:yes'>   </span>r9, r9, 0x3344<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=FR style='mso-ansi-language:FR'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'>“movhi
r9, 0x1122” does r9 = 0x11220000. </span>In general “<span class=SpellE>movhi</span>
r9, 0xYYYY” does r9 = 0xYYYY0000, where YYYY can be any 16-bit number expressed
in hexadecimal. In more words, <span class=SpellE>movhi</span> sets the lower
16-bits of the destination to zero and the upper 16-bits to the 16-bit source
operand. For example, “<span class=SpellE>movhi</span> r10, 0xABCD1234” does
“r10 = 0xABCD0000”.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'>“ori r9,
r9, 0x3344” does r9 = r9 bitwise-OR 0x00003344. </span>Bitwise OR works at the
bit level by <span class=SpellE>ORing</span> (in the Boolean-<span
class=SpellE>algerba</span> sense) the corresponding bits of r9 and of the
immediate in pairs. So bit 0 of r9 will be <span class=SpellE>ORed</span> with
bit 0 of the immediate and the result will be written to <span class=SpellE>bit</span>
0 of the output. This is done for bits 0 through bit 15 since the immediate is
16 bits. The upper 16 bits (bits 16 through 31) are copied as-is from r9 to the
output, or, equivalently, the Imm16 is first zero-extended to 32-bits and then <span
class=SpellE>ORing</span> proceeds in parallel for all 32 bit pairs..</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Here’s the calculation that takes place when we execute <span
class=SpellE>ori</span> r9, r9, 0xcccc when initially r9 holds the value
0xaaaaaaaaaa. Note that 0xcccc = 1100 1100 1100 1100 in binary and 0xa<span
class=GramE>..</span>a = 1010 ... 1010 in binary.</p>

<p class=MsoPlainText><span style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="Picture_x0020_3" o:spid="_x0000_i1025" type="#_x0000_t75" alt="ORI"
 style='width:614.25pt;height:161.25pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="lec4%20-%20Programming%20Model_files/image004.gif" o:title="ORI"/>
</v:shape><![endif]--><![if !vml]><img width=819 height=215
src="lec4%20-%20Programming%20Model_files/image004.gif" alt=ORI v:shapes="Picture_x0020_3"><![endif]></span><b
style='mso-bidi-font-weight:normal'><span style='color:red'><o:p></o:p></span></b></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Here’s the complete code for our example:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
lang=PT-BR style='mso-ansi-language:PT-BR'>movhi r9, 0x1122<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><span
style='mso-tab-count:1'>      </span></span><span class=SpellE><span
class=GramE><span lang=FR style='mso-ansi-language:FR'>ori</span></span></span><span
lang=FR style='mso-ansi-language:FR'><span style='mso-tab-count:1'>   </span>r9,
r9, 0x3344<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=FR style='mso-ansi-language:FR'><span
style='mso-tab-count:1'>      </span><span class=SpellE><span class=GramE>movhi</span></span>
r10, 0x5566<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=FR style='mso-ansi-language:FR'><span
style='mso-tab-count:1'>      </span></span><span lang=PT-BR style='mso-ansi-language:
PT-BR'>ori<span style='mso-tab-count:1'>   </span>r10, 0x7788<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><span
style='mso-tab-count:1'>      </span></span><span class=GramE>add</span><span
style='mso-tab-count:1'>   </span>r8, r9, r10</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>“<span class=SpellE><span class=GramE>movhi</span></span>
<span class=SpellE>rX</span>, Imm16” is an pseudo-instruction. It gets
translated into “<span class=SpellE>orhi</span> <span class=SpellE><span
class=GramE>rX</span></span>, r0, Imm16”. “<span class=SpellE>Orhi</span> <span
class=SpellE>rX</span>, <span class=SpellE>rY</span>, Imm16” bitwise ORs the 16
bit immediate with the upper 16 bits of <span class=SpellE>rY</span> and stores
the result in <span class=SpellE><span class=GramE>rX</span></span>. By using <span
class=SpellE>rY</span>=r0 we effectively store the Imm16 in the upper 16 bits
of <span class=SpellE>rX</span> while zeroing out the lower 16 bits of <span
class=SpellE>rX</span>.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Instead of using the <span class=SpellE>orhi</span> and <span
class=SpellE>ori</span> sequence to create a 32-bit constant we can instead use
the <span class=SpellE>movia</span> <b style='mso-bidi-font-weight:normal'><u>pseudo</u></b>-instruction.
So, “<span class=SpellE>movia</span> r9, Imm32” stores the 32-bit immediate
Imm32 in register r9. The sequence of instructions <span class=SpellE>movia</span>
translates to <span class=GramE>is</span> slightly different than what we
described here. It uses an addition instead of <span class=GramE>an or</span>
as the second step. At some point we will explain it.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>The NIOS II assembly includes several pseudo-instructions
for creating numbers:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>1. <span class=SpellE><span class=GramE>movi</span></span>
<span class=SpellE>rX</span>, Imm16 --&gt; <span class=SpellE>rx</span> =
sign-extended(Imm16) where Imm16 is a 16-bit immediate</p>

<p class=MsoPlainText>2. <span class=SpellE><span class=GramE>movui</span></span>
<span class=SpellE>rX</span>, Imm17 --&gt; <span class=SpellE>rx</span> =
zero-extended(Imm16)</p>

<p class=MsoPlainText>3. <span class=SpellE><span class=GramE>movia</span></span>
<span class=SpellE>rX</span>, Imm32 --&gt; <span class=SpellE>rx</span> = Imm32</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Footnote1: <span class=SpellE>Movia</span> does not use
the <span class=SpellE>movhi</span> and <span class=SpellE>ori</span>
instruction pair to create a 32-bit immediate. Instead it uses a <span
class=SpellE>movhi</span> and an <span class=SpellE>addi</span>. <span
class=SpellE>Addi</span> sign extents <span class=GramE>it’s</span> 16-bit
field, so some adjustment may be required for the immediate used in <span
class=SpellE>movhi</span>.</p>

<p class=MsoPlainText>Footnote2: <span class=SpellE>movhi</span> r9, %<span
class=GramE>hi(</span>0x11223344) is equivalent to <span class=SpellE>movhi</span>
r9, 0x1122. <span class=SpellE>Ori</span> r9, %<span class=GramE>lo(</span>0x11223344)
is equivalent to <span class=SpellE>ori</span> 9, 0x3344. That is, %<span
class=GramE>hi(</span>Imm32) returns the upper 16-bits of Imm32 and %lo(Imm32)
the lower 16 bits.</p>

<p class=MsoPlainText>Footnote3: <span class=SpellE>movhi</span> r9, %<span
class=SpellE><span class=GramE>hiadj</span></span><span class=GramE>(</span>0x11223344)
followed by <span class=SpellE>addi</span> r1, %lo(0x11223344) is the correct
way of creating a 32-bit immediate using <span class=SpellE>movhi</span> and <span
class=SpellE>addi</span>. %<span class=SpellE><span class=GramE>hiadj</span></span><span
class=GramE>(</span>Imm32) returns the upper 16 bits of the immediate<span
style='mso-spacerun:yes'>  </span>as-is or incremented by 1 if bit 15 is 1.
Think why this is necessary based on footnote 1.</p>

<p class=MsoPlainText>Footnote4: %<span class=GramE>hi(</span>), %lo(), and %<span
class=SpellE>hiadj</span>() are macros supported by the assembler. They are not
NIOS II instructions. They get parsed during compile time. </p>

<p class=MsoPlainText>Footnote5: If you found this footnote discussion
confusing, you can ignore for the time being.</p>

<p class=MsoPlainText>Footnote6: No more footnotes.<br style='mso-special-character:
line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:12.0pt'>Memory Version<o:p></o:p></span></b></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>What if we wanted the variables a, b, and c to be stored
in memory? Eventually, we will run out of registers. There are only 32 of them.
So, inevitably we will have to use memory at some sooner than later.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>NIOS II is <span class=GramE>a load</span>/store
architecture. That is, all data manipulation happens in registers. To add b to
c we must first read the values into <span class=GramE>registers,</span> do the
addition in those registers and then write the result back to memory.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Let’s assume that we allocated a through c in consecutive
memory locations starting from address 0x00200000 (this address range is valid
on the DE-2).</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>So the relevant part of memory will look as follows:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none;mso-border-alt:solid windowtext .5pt;
 mso-yfti-tbllook:480;mso-padding-alt:0in 5.4pt 0in 5.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes'>
  <td width=131 valign=top style='width:98.15pt;border:none;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText>Address</p>
  </td>
  <td width=131 valign=top style='width:98.15pt;border:none;border-bottom:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText>+0</p>
  </td>
  <td width=131 valign=top style='width:98.2pt;border:none;border-bottom:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText>+1</p>
  </td>
  <td width=131 valign=top style='width:98.2pt;border:none;border-bottom:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText>+2</p>
  </td>
  <td width=131 valign=top style='width:98.2pt;border:none;border-bottom:solid windowtext 1.0pt;
  mso-border-bottom-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText>+3</p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1'>
  <td width=131 valign=top style='width:98.15pt;border:none;border-right:solid windowtext 1.0pt;
  mso-border-right-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText>0x00200000</p>
  </td>
  <td width=131 valign=top style='width:98.15pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText>0x00</p>
  </td>
  <td width=131 valign=top style='width:98.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText>0x00</p>
  </td>
  <td width=131 valign=top style='width:98.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText>0x00</p>
  </td>
  <td width=131 valign=top style='width:98.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText>0x00</p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2'>
  <td width=131 valign=top style='width:98.15pt;border:none;border-right:solid windowtext 1.0pt;
  mso-border-right-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText>0x00200004</p>
  </td>
  <td width=131 valign=top style='width:98.15pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText>0x44</p>
  </td>
  <td width=131 valign=top style='width:98.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText>0x33</p>
  </td>
  <td width=131 valign=top style='width:98.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText>0x22</p>
  </td>
  <td width=131 valign=top style='width:98.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText>0x11</p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:3;mso-yfti-lastrow:yes'>
  <td width=131 valign=top style='width:98.15pt;border:none;border-right:solid windowtext 1.0pt;
  mso-border-right-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText>0x00200008</p>
  </td>
  <td width=131 valign=top style='width:98.15pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText>0x88</p>
  </td>
  <td width=131 valign=top style='width:98.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText>0x77</p>
  </td>
  <td width=131 valign=top style='width:98.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText>0x66</p>
  </td>
  <td width=131 valign=top style='width:98.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoPlainText>0x55</p>
  </td>
 </tr>
</table>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>“<span class=GramE>a</span>” is in memory locations
0x00200000 through 0x00200003, “b” is in 0x00200004 through 0x0020007, and “c”
is in 0x00200008 through 0x0020000b.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Here’s the full program. This is not the shortest possible
program. We will soon see how we can eliminate some of the instructions.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><span class=GramE><span lang=FR style='mso-ansi-language:FR'>movhi</span></span></span><span
lang=FR style='mso-ansi-language:FR'> r11, 0x0020 <o:p></o:p></span></p>

<p class=MsoPlainText><span lang=FR style='mso-ansi-language:FR'><span
style='mso-tab-count:1'>      </span><span class=SpellE><span class=GramE>ori</span></span><span
style='mso-tab-count:1'>   </span>r11, r11, 0x0004<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=FR style='mso-ansi-language:FR'><span
style='mso-tab-count:1'>      </span></span><span lang=PT-BR style='mso-ansi-language:
PT-BR'>ldw<span style='mso-tab-count:1'>   </span>r9, 0x0(r11)<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><span
style='mso-tab-count:1'>      </span>movhi r11, 0x0020<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><span
style='mso-tab-count:1'>      </span>ori<span style='mso-tab-count:1'>   </span>r11,
0x0008<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><span
style='mso-tab-count:1'>      </span>ldw<span style='mso-tab-count:1'>   </span>r10,
0x0(r11)<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><span
style='mso-tab-count:1'>      </span>add<span style='mso-tab-count:1'>   </span>r8,
r9, r10<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><span
style='mso-tab-count:1'>      </span></span><span class=SpellE><span
class=GramE><span lang=FR style='mso-ansi-language:FR'>movhi</span></span></span><span
lang=FR style='mso-ansi-language:FR'><span style='mso-tab-count:1'> </span>r11,
0x0020<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=FR style='mso-ansi-language:FR'><span
style='mso-tab-count:1'>      </span><span class=SpellE><span class=GramE>ori</span></span><span
style='mso-tab-count:1'>   </span>r11, r11, 0x0000<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=FR style='mso-ansi-language:FR'><span
style='mso-tab-count:1'>      </span></span><span lang=PT-BR style='mso-ansi-language:
PT-BR'>stw <span style='mso-tab-count:1'>  </span>r8, 0x0(r11)<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'>The
first three instructions read b from memory i</span><span class=SpellE>nto</span>
r9, the next three read c from memory into r10, the next instruction adds r9
and r10 into r8, and the last three instructions write r8 to memory. The new
instructions here are <span class=SpellE><b style='mso-bidi-font-weight:normal'>ldw</b></span>
and <span class=SpellE><b style='mso-bidi-font-weight:normal'>stw</b></span>.
They take the following form:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><span class=GramE>ldw</span></span><span style='mso-tab-count:
1'>   </span><span class=SpellE>rX</span>, Imm16(<span class=SpellE>rY</span>)</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><span class=GramE>stw</span></span> <span style='mso-tab-count:
1'>  </span><span class=SpellE>rX</span>, Imm16(<span class=SpellE>rY</span>)</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Where <span class=SpellE><span class=GramE>rX</span></span>
and <span class=SpellE>rY</span> are registers and Imm16 is a 16-bit constant.
Let’s look at the <span class=SpellE>ldw</span>. It does the following:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='margin-left:.75in;text-indent:-.25in;mso-list:
l6 level1 lfo10;tab-stops:list .75in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Read
<span class=SpellE>rY</span></p>

<p class=MsoPlainText style='margin-left:.75in;text-indent:-.25in;mso-list:
l6 level1 lfo10;tab-stops:list .75in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Sign-extend
Imm16 to 32 bits</p>

<p class=MsoPlainText style='margin-left:.75in;text-indent:-.25in;mso-list:
l6 level1 lfo10;tab-stops:list .75in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Add
the values of step 1 and 2</p>

<p class=MsoPlainText style='margin-left:.75in;text-indent:-.25in;mso-list:
l6 level1 lfo10;tab-stops:list .75in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>4.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Read
from memory a word (32 bits) using the value produced in step 3 as the address</p>

<p class=MsoPlainText style='margin-left:.75in;text-indent:-.25in;mso-list:
l6 level1 lfo10;tab-stops:list .75in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>5.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Write
the value read in step 4 into register <span class=SpellE>rX</span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>So, the first three instructions read from memory
location 0x002000004 a word into register r9. The first two form the value
0x00200000 into r9 and the <span class=SpellE>ldw</span> uses r9 to read from
memory.</p>

<p class=MsoPlainText><br>
In shorthand notation “<span class=SpellE>ldw</span> <span class=SpellE>rX</span>,
<span class=GramE>Imm16(</span><span class=SpellE>rY</span>)” does:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span>Rx = <span
class=SpellE><span class=GramE>mem</span></span><span class=GramE>[</span><span
class=SpellE>rY</span> + sign-extended(Imm16)]</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>“<span class=SpellE>Stw</span>” is similar to “<span
class=SpellE>ldw</span>” and differs only in that it performs a memory write. “<span
class=SpellE><span class=GramE>stw</span></span> <span class=SpellE>rX</span>,
Imm16(<span class=SpellE>rY</span>)” does the following:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='margin-left:.75in;text-indent:-.25in;mso-list:
l1 level1 lfo12;tab-stops:list .75in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Read
<span class=SpellE>rY</span></p>

<p class=MsoPlainText style='margin-left:.75in;text-indent:-.25in;mso-list:
l1 level1 lfo12;tab-stops:list .75in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Sign-extend
Imm16 to 32 bits</p>

<p class=MsoPlainText style='margin-left:.75in;text-indent:-.25in;mso-list:
l1 level1 lfo12;tab-stops:list .75in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Add
the values of step 1 and 2</p>

<p class=MsoPlainText style='margin-left:.75in;text-indent:-.25in;mso-list:
l1 level1 lfo12;tab-stops:list .75in'><![if !supportLists]><span
style='mso-fareast-font-family:"Courier New"'><span style='mso-list:Ignore'>4.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>Write
from memory the value of register <span class=SpellE>rX</span> using the value
produced in step 3 as the address</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>In short hand notation “<span class=SpellE><b
style='mso-bidi-font-weight:normal'><u><span style='color:red'>stw</span></u></b></span>
<span class=GramE>Imm16(</span><span class=SpellE>rY</span>)” does:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><span class=GramE>mem</span></span><span class=GramE>[</span><span
class=SpellE>rY</span> + sign-extended(Imm16)] = Rx</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Let’s now look at our program and understand what each
instruction does:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
lang=PT-BR style='mso-ansi-language:PT-BR'>movhi r11, 0x0020<span
style='mso-tab-count:3'>             </span></span><span style='font-family:
Wingdings;mso-ascii-font-family:"Courier New";mso-hansi-font-family:"Courier New";
mso-char-type:symbol;mso-symbol-font-family:Wingdings'><span style='mso-char-type:
symbol;mso-symbol-font-family:Wingdings'>à</span></span><span lang=PT-BR
style='mso-ansi-language:PT-BR'> r11 = 0x00200000 <o:p></o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><span
style='mso-tab-count:1'>      </span>ori<span style='mso-tab-count:1'>   </span>r11,
r11, 0x0004<span style='mso-tab-count:2'>        </span></span><span
style='font-family:Wingdings;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";mso-char-type:symbol;mso-symbol-font-family:Wingdings'><span
style='mso-char-type:symbol;mso-symbol-font-family:Wingdings'>à</span></span><span
lang=PT-BR style='mso-ansi-language:PT-BR'> r11 = 0x00200000 OR 0x0000004 =
0x00200004<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><span
style='mso-tab-count:1'>      </span>ldw<span style='mso-tab-count:1'>   </span>r9,
0x0(r11)<span style='mso-tab-count:2'>            </span></span><span
style='font-family:Wingdings;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";mso-char-type:symbol;mso-symbol-font-family:Wingdings'><span
style='mso-char-type:symbol;mso-symbol-font-family:Wingdings'>à</span></span><span
lang=PT-BR style='mso-ansi-language:PT-BR'> r9 = mem[r11 + sign-extend(0x0)] =
mem[0x00200004] = 0x11223344<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><span
style='mso-tab-count:1'>      </span>movhi r11, 0x0020<span style='mso-tab-count:
3'>             </span></span><span style='font-family:Wingdings;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";mso-char-type:symbol;
mso-symbol-font-family:Wingdings'><span style='mso-char-type:symbol;mso-symbol-font-family:
Wingdings'>à</span></span><span lang=PT-BR style='mso-ansi-language:PT-BR'> r11
= 0x00200000<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><span
style='mso-tab-count:1'>      </span>ori<span style='mso-tab-count:1'>   </span>r11,
0x0008<span style='mso-tab-count:3'>             </span></span><span
style='font-family:Wingdings;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";mso-char-type:symbol;mso-symbol-font-family:Wingdings'><span
style='mso-char-type:symbol;mso-symbol-font-family:Wingdings'>à</span></span><span
lang=PT-BR style='mso-ansi-language:PT-BR'> r11 = 0x00200000 OR 0x00000008 =
0x00200008<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><span
style='mso-tab-count:1'>      </span>ldw <span style='mso-tab-count:1'>  </span>r10,
0x0(r11)<span style='mso-tab-count:2'>           </span></span><span
style='font-family:Wingdings;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";mso-char-type:symbol;mso-symbol-font-family:Wingdings'><span
style='mso-char-type:symbol;mso-symbol-font-family:Wingdings'>à</span></span><span
lang=PT-BR style='mso-ansi-language:PT-BR'> r10 = mem[r11 + sign-extend(0x0)] =
mem[0x00200008] = 0x55667788<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><span
style='mso-tab-count:1'>      </span>add<span style='mso-tab-count:1'>   </span>r8,
r9, r10<span style='mso-tab-count:3'>             </span></span><span
style='font-family:Wingdings;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";mso-char-type:symbol;mso-symbol-font-family:Wingdings'><span
style='mso-char-type:symbol;mso-symbol-font-family:Wingdings'>à</span></span><span
style='mso-ansi-language:PT-BR'> <span lang=PT-BR>r8 = r9 + r10 = 0x11223344 +
0x55667788 = 0x6688aacc<o:p></o:p></span></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><span
style='mso-tab-count:1'>      </span>movhi<span style='mso-tab-count:1'> </span>r11,
0x0020<span style='mso-tab-count:3'>             </span></span><span lang=FR
style='font-family:Wingdings;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";mso-ansi-language:FR;mso-char-type:symbol;mso-symbol-font-family:
Wingdings'><span style='mso-char-type:symbol;mso-symbol-font-family:Wingdings'>à</span></span><span
lang=PT-BR style='mso-ansi-language:PT-BR'> r11 = 0x00200000<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><span
style='mso-tab-count:1'>      </span>ori<span style='mso-tab-count:1'>   </span>r11,
r11, 0x0000<span style='mso-tab-count:2'>        </span></span><span lang=FR
style='font-family:Wingdings;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";mso-ansi-language:FR;mso-char-type:symbol;mso-symbol-font-family:
Wingdings'><span style='mso-char-type:symbol;mso-symbol-font-family:Wingdings'>à</span></span><span
lang=PT-BR style='mso-ansi-language:PT-BR'> r11 = r11 OR 0x00000000 =
0x00200000<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><span
style='mso-tab-count:1'>      </span></span><span class=SpellE><span
class=GramE>stw</span></span> <span style='mso-tab-count:1'>  </span>r8,
0x0(r11)<span style='mso-tab-count:2'>            </span><span
style='font-family:Wingdings;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";mso-char-type:symbol;mso-symbol-font-family:Wingdings'><span
style='mso-char-type:symbol;mso-symbol-font-family:Wingdings'>à</span></span> <span
class=SpellE>mem</span>[r11 + sign-extend(0) = r8, that is <span class=SpellE>mem</span>[0x00200000]
= 0x00200000</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:12.0pt;mso-bidi-font-size:10.0pt'>Using the MOVIA macro<o:p></o:p></span></b></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>We can rewrite the preceding code using the “<span
class=SpellE>movia</span>” macro:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><span class=GramE>movia</span></span> r11, 0x200004</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><span class=GramE>ldw</span></span><span style='mso-tab-count:
1'>   </span>r9, 0x0(r11)</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><span class=GramE>movia</span></span> r11, 0x200008</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><span class=GramE>ldw</span></span><span style='mso-tab-count:
1'>   </span>r10, 0x0(r11)</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=GramE>add</span><span style='mso-tab-count:1'>   </span>r8, r9, r10</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><span class=GramE>movia</span></span> r11, 0x200000</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><span class=GramE>stw</span></span><span style='mso-tab-count:
1'>   </span>r8, 0x0(r11)</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>While this code appears to have seven instructions in
reality it will have 7+3 = 10. This is because every <span class=SpellE>movia</span>
gets translated into a sequence of two real instructions. <span class=SpellE>Movia</span>
is a pseudo-instruction.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:12.0pt'>Addressing Modes</span></b><span style='font-size:
12.0pt'><o:p></o:p></span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Some general terminology now: the term <b
style='mso-bidi-font-weight:normal'>addressing mode </b>describes a way of
specifying an input or output operand for instructions. In this lecture we have
seen three addressing modes.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l2 level1 lfo14;
tab-stops:list .5in'><![if !supportLists]><span style='mso-fareast-font-family:
"Courier New"'><span style='mso-list:Ignore'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]><span lang=PT-BR style='mso-ansi-language:PT-BR'>“Register”,
as in add r10, r9, r2. </span>All three operands are registers.</p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l2 level1 lfo14;
tab-stops:list .5in'><![if !supportLists]><span style='mso-fareast-font-family:
"Courier New"'><span style='mso-list:Ignore'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>“Immediate”, as in the last operand of <span
class=SpellE>addi</span> r8, r9, 10. </p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:-.25in;mso-list:l2 level1 lfo14;
tab-stops:list .5in'><![if !supportLists]><span style='mso-fareast-font-family:
"Courier New"'><span style='mso-list:Ignore'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>“Register Indirect with Displacement” as in the
second operand of <span class=SpellE>ldw</span> r10, 0x4(r9). The name is a bit
unfortunate as it fails to explicitly state that we are referring to memory.
The name describes how we calculate the memory address referenced. It’s “register
indirect” because we are using a register’s value to refer to memory. This is
akin to a pointer in C. The “displacement” implies that we add a displacement,
i.e., a constant to the register value prior to using it to access memory.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Another addressing mode is “register indirect” which in
NIOS II is simply “register indirect with displacement” where we use a
displacement of zero. In other architectures there are other addressing modes.
We will talk about some of these much later.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:12.0pt'>Memory Version – Take 2<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoPlainText>We will cover this later on in the course:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>We can replace the first three instructions:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><span class=GramE><span lang=FR style='mso-ansi-language:FR'>movhi</span></span></span><span
lang=FR style='mso-ansi-language:FR'> r11, 0x0020 <o:p></o:p></span></p>

<p class=MsoPlainText><span lang=FR style='mso-ansi-language:FR'><span
style='mso-tab-count:1'>      </span><span class=SpellE><span class=GramE>ori</span></span><span
style='mso-tab-count:1'>   </span>r11, r11, 0x0004<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=FR style='mso-ansi-language:FR'><span
style='mso-tab-count:1'>      </span></span><span lang=PT-BR style='mso-ansi-language:
PT-BR'>ldw<span style='mso-tab-count:1'>   </span>r9, 0x0(r11)<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'>with:<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><span
style='mso-tab-count:1'>      </span>movhi<span style='mso-tab-count:1'> </span>r11,
0x0020<span style='mso-tab-count:2'>       </span></span><span
style='font-family:Wingdings;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";mso-char-type:symbol;mso-symbol-font-family:Wingdings'><span
style='mso-char-type:symbol;mso-symbol-font-family:Wingdings'>à</span></span><span
lang=PT-BR style='mso-ansi-language:PT-BR'> r11 = 0x00200000<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><span
style='mso-tab-count:1'>      </span>ldw r9, 0x4(r11)<span style='mso-tab-count:
2'>        </span></span><span style='font-family:Wingdings;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";mso-char-type:symbol;
mso-symbol-font-family:Wingdings'><span style='mso-char-type:symbol;mso-symbol-font-family:
Wingdings'>à</span></span><span lang=PT-BR style='mso-ansi-language:PT-BR'> r9
= mem[r11 + sign-extend(0x4)] = mem[0x00200000 + 0x00000004] = mem[0x00200004]
= 0x11223344<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText>Here’s a new shorter version:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
lang=PT-BR style='mso-ansi-language:PT-BR'>movhi<span style='mso-tab-count:
1'> </span>r11, 0x0020<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=PT-BR style='mso-ansi-language:PT-BR'><span
style='mso-tab-count:1'>      </span></span><span class=SpellE><span
class=GramE>ldw</span></span> <span style='mso-tab-count:1'>  </span>r9,
0x4(r11)</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><span class=GramE>ldw</span></span><span style='mso-tab-count:
1'>   </span>r10, 0x8(r11)</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=GramE>add</span><span style='mso-tab-count:1'>   </span>r8, r9, r10</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><span class=GramE>stw</span></span><span style='mso-tab-count:
1'>   </span>r8, 0x0(r11)</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Note that the value of r11 remains constant as 0x00200000
after the first instruction and subsequent loads uses their immediate operand
as an <b style='mso-bidi-font-weight:normal'>offset </b>from that value.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Note that in the previous example we exploited the
addition that <span class=SpellE>ldw</span> and <span class=SpellE>stw</span>
perform as part of their address calculation. In general, when we want to
access from memory location <span class=GramE>A</span> we can use the following
sequence:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><span class=GramE>movhi</span></span> r11, Upper 16 bits of A</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><span class=GramE>ldw</span></span><span style='mso-tab-count:
1'>   </span>r9, Lower 16 bits of A(r11)</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Care must be taken when bit 15 (the 16 bit of A) is 1.
This is for example the case with A=0x208000. The following sequence does not
access address 0x208000:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><span class=GramE>movhi</span></span> r11, 0x0020</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><span class=GramE>ldw</span></span><span style='mso-tab-count:
1'>   </span>r9, 0x8000(r11)<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-spacerun:yes'> </span>The problem is
that in this case, the lower 16 bits of <span class=GramE>A</span> are 0x8000.
The addition which <span class=SpellE>ldw</span> performs as part of the
address calculation will sign <span class=GramE>extend</span> this to
0xFFFF8000. Adding that to 0x00200000 (the result of <span class=SpellE>movhi</span>)
produces 0x001F8000. In this case, the constant used by <span class=SpellE>movhi</span>
must be adjusted by adding 1 to it. So the correct sequence is:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><span class=GramE>movhi</span></span> r11, 0x0021</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><span class=GramE>ldw</span></span><span style='mso-tab-count:
1'>   </span>r9, 0x8000(r11)</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Fortunately, you do not have to do these conversions by
hand. You can instead use the macros %<span class=SpellE><span class=GramE>hiadj</span></span><span
class=GramE>(</span>Imm32) and %lo(Imm32) where Imm32 is a 32-bit immediate. %<span
class=GramE>lo(</span>Imm32) returns the lower 16 bits of Imm32. %<span
class=SpellE><span class=GramE>hiadj</span></span><span class=GramE>(</span>Imm32)
returns the upper 32 bits of Imm32. It adds 1 to those if bit 15 of Imm32 is 1.
So the code becomes:</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><span class=GramE>movhi</span></span> r11, %<span class=SpellE>hiadj</span>(0x208000)</p>

<p class=MsoPlainText><span style='mso-tab-count:1'>      </span><span
class=SpellE><span class=GramE>ldw</span></span><span
style='mso-spacerun:yes'>   </span>r9, %lo(0x208000)(r11)</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText>Granted not as readable but it does what it supposed to
do and we don’t have to think about the effects of sign-extension from the
lower 16 bits.</p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

</div>

</body>

</html>
